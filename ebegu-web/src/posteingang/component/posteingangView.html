<!--
  ~ Ki-Tax: System for the management of external childcare subsidies
  ~ Copyright (C) 2017 City of Bern Switzerland
  ~ This program is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU Affero General Public License as
  ~ published by the Free Software Foundation, either version 3 of the
  ~ License, or (at your option) any later version.
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  ~ GNU Affero General Public License for more details.
  ~ You should have received a copy of the GNU Affero General Public License
  ~ along with this program. If not, see <http://www.gnu.org/licenses/>.
  -->

<div class="posteingangView">
    <div class="col-md-12">
        <div class="row">
            <div class="col-md-8 col-md-offset-1">
                <h3 data-translate="POSTEINGANG"></h3>
            </div>
            <div class="col-md-2 text-right">
                <h3 ng-bind="vm.getMitteilungen() ? vm.getMitteilungen().length : 0"></h3>
            </div>
        </div>
        <div class="row">
            <div class="col-md-2 col-md-offset-9 text-right closedMitteilungen">
                <md-checkbox ng-model="vm.includeClosed" name="includeClosed" id="includeClosed"
                             aria-label="{{'POSTEINGANG_INCLUDE_CLOSED'|translate}}" ng-change="vm.clickedIncludeClosed()">
                    <span data-translate="POSTEINGANG_INCLUDE_CLOSED"></span>
                </md-checkbox>
            </div>
        </div>
        <div class="row">
            <div class="col-md-10 col-md-offset-1 table-responsive">

                <table st-table="displayedCollection" st-set-filter="posteingangFilter" st-safe-src="vm.getMitteilungen()"
                       st-delay="20"
                       class="table fixedtable table-striped">
                    <thead>
                    <tr>
                        <!-- Von -->
                        <th st-sort="sender.getFullName()" class="sortable row-sender" data-translate="POSTEINGANG_VON_UPPER"></th>
                        <!-- Fall-Nummer -->
                        <th st-sort="fall.fallNummer" class="sortable row-fallNummer" data-translate="POSTEINGANG_FALL_UPPER"></th>
                        <!-- Familie -->
                        <th st-sort="fall.besitzer.getFullName()" class="sortable row-besitzer" data-translate="POSTEINGANG_FAMILIE_UPPER"></th>
                        <!-- Betreff -->
                        <th st-sort="subject" class="sortable row-subject" data-translate="POSTEINGANG_BETREFF_UPPER"></th>
                        <!-- Datum -->
                        <th st-sort="sentDatum" class="sortable row-sentDatum" data-translate="POSTEINGANG_DATUM_UPPER"></th>
                        <!-- Verantwortliche Person -->
                        <th st-sort="empfaenger.getFullName()" class="sortable row-empfaenger" data-translate="POSTEINGANG_VERANTWORTLICH_UPPER"></th>
                        <!-- Amt -->
                        <th st-sort="empfaenger.amt" class="sortable row-amt" data-translate="POSTEINGANG_AMT"></th>
                    </tr>
                    <tr>
                        <!-- Von -->
                        <th><input st-search="sender" class="form-control" type="text"/></th>
                        <!-- Fall-Nummer -->
                        <th><input st-search="fall.fallNummer" class="form-control" type="text"/></th>
                        <!-- Familie -->
                        <th><input st-search="fall.besitzer" class="form-control" type="text"/></th>
                        <!-- Betreff -->
                        <th><input st-search="subject" class="form-control" type="text"/></th>
                        <!-- Datum -->
                        <th><input st-search="sentDatum" class="form-control" type="text"/></th>
                        <!-- Verantwortliche Person -->
                        <th>
                            <dv-userselect input-id="empfaenger" dv-usersearch="empfaenger" initial-all="false" show-selection-all="true"
                                           schulamt="vm.isCurrentUserSchulamt()"></dv-userselect>
                        </th>
                        <!-- Amt -->
                        <th>
                            <div class="dv-select-style">
                                <select st-input-event="change" name="empfaenger.amt" id="empfaenger.amt" st-search="empfaenger.amt" class="form-control"
                                        ng-options="a | translate for a in vm.getAemter() track by a" ng-model="vm.selectedAmt">
                                    <option value="">{{"ALLE" | translate}}</option>
                                </select>
                            </div>
                        </th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr ng-repeat="row in displayedCollection" st-select-row="row" st-select-mode="single" ng-click="vm.gotoMitteilung(row)" ng-class="{'mitteilung_neu': ('NEU' === row.mitteilungStatus.toString()),'mitteilung_alt': ('NEU' !== row.mitteilungStatus.toString())}">
                        <!-- Von -->
                        <td ellipsis-tooltip="{{row.sender.getFullName()}}"
                            ng-bind="row.sender.getFullName()"></td>
                        <!-- Fall-Nummer -->
                        <td class="ellipsis" ellipsis-tooltip="{{vm.addZerosToFallNummer(row.fall.fallNummer)}}"
                            ng-bind="vm.addZerosToFallNummer(row.fall.fallNummer)"></td>
                        <!-- Familie -->
                        <td class="ellipsis" ellipsis-tooltip="{{row.fall.besitzer.getFullName()}}"
                            ng-bind="row.fall.besitzer.getFullName()"></td>
                        <!-- Betreff -->
                        <td class="ellipsis" ellipsis-tooltip="{{row.subject}}"
                            ng-bind="row.subject"></td>
                        <!-- Datum -->
                        <td class="ellipsis" ellipsis-tooltip="{{row.sentDatum | amDateFormat : 'DD.MM.YYYY'}}"
                            ng-bind="row.sentDatum | amDateFormat : 'DD.MM.YYYY'"></td>
                        <!-- Verantwortliche Person -->
                        <td class="ellipsis" ellipsis-tooltip="{{row.empfaenger}}"
                            ng-bind="row.empfaenger.getFullName()"></td>
                        <!-- Amt -->
                        <td class="ellipsis" ellipsis-tooltip="{{row.empfaenger.amt}}"
                            ng-bind="row.empfaenger.amt | translate"></td>
                    </tr>
                    </tbody>
                    <tfoot>
                    <tr>
                        <td colspan="6" class="text-center">
                            <div st-pagination="" st-items-by-page="vm.itemsByPage" st-displayed-pages="5"></div>
                        </td>
                    </tr>
                    </tfoot>
                </table>

            </div>
        </div>
    </div>
</div>
