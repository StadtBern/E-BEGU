<div class="verfuegenListView gesuchModul">

    <form role="form" name="formMahnung" class="" novalidate unsaved-warning-form>

        <div class="row viewTitle">
        <div class="col-md-12">
            <h1 data-translate="VERFUEGUNGEN_UPPER"></h1>
            <hr class="header"/>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div class="row">
                <div class="col-md-12 table-responsive">

                <table st-table="displayedCollection" st-safe-src="vm.getKinderWithBetreuungList()"
                       class="table table-hover" st-delay="20">
                    <thead>
                    <tr>
                        <th data-translate="KIND_UPPER"></th>
                        <th data-translate="BETREUUNG_UPPER"></th>
                        <th data-translate="ID_UPPER"></th>
                        <th data-translate="STATUS_UPPER"></th>
                    </tr>
                    </thead>
                    <tbody ng-repeat="kindContainer in displayedCollection">
                    <tr ng-repeat="betreuung in kindContainer.betreuungen" st-select-row="betreuung"
                        st-select-mode="single"
                        ng-class="{'disabled-row': !vm.kannVerfuegungOeffnen(betreuung)}"
                        ng-click="vm.openVerfuegung(kindContainer, betreuung)">
                        <td ng-bind="kindContainer.kindJA.getFullName()"></td>
                        <td ng-bind="betreuung.institutionStammdaten.institution.name"></td>
                        <td ng-bind="vm.ebeguUtil.calculateBetreuungsId(vm.getGesuchsperiode(), vm.getFall(), kindContainer.kindNummer, betreuung.betreuungNummer)"></td>
                        <td class="betreuung-status ng-class:betreuung.betreuungsstatus;"
                            ng-bind="betreuung.betreuungsstatus | translate"></td>
                    </tr>
                    </tbody>
                    <tbody ng-if="vm.getKinderWithBetreuungList().length === 0">
                    <tr>
                        <td colspan="4" class="empty-table" data-translate="VERFUEGUNGEN_NOCH_KEINE"></td>
                    </tr>
                    </tbody>
                </table>

                </div>
            </div>

            <!--FinanzielleSituationPDF anzeigen-->
            <div class="row text-left" dv-show-element
                 dv-show-allowed-roles="vm.TSRoleUtil.getAllRolesButTraegerschaftInstitution()">
                <div class="col-md-12">
                    <i class="fa fa-file-text-o"></i>
                    <button type="button" class=" btn-link"
                            ng-click="vm.openFinanzielleSituationPDF()">
                        <span data-translate="PDF_FINSITUATION_ANZEIGEN"></span>
                    </button>
                </div>
            </div>
            <!--Begleitschreiben anzeigen-->
            <div class="row text-left">
                <div class="col-md-12">
                    <i class="fa fa-file-text-o"></i>
                    <button type="button" class=" btn-link"
                            ng-click="vm.openBegleitschreibenPDF()">
                        <span data-translate="PDF_BEGLEITSCHREIBEN_ANZEIGEN"></span>
                    </button>
                </div>
            </div>

            <br>

            <!-- Liste der bisherige Mahnungen -->
            <div class="row text-left" ng-if="vm.getMahnungList().length > 0">
                <div class="col-md-12">
                    <h1 data-translate="MAHNUNGEN_ZURUECKSTELLUNG"></h1>
                    <hr class="header"/>
                </div>
                <div class="col-md-12" ng-repeat="mahn in vm.getMahnungList()">
                    <i class="fa fa-file-text-o"></i>
                    <button type="button" class=" btn-link" ng-click="vm.openMahnungPDF(mahn)">
                        <span data-translate="MAHNUNG_DETAIL"
                              data-translate-value-mahnung-typ="{{mahn.mahnungTyp | translate}}"
                              data-translate-value-date="{{mahn.timestampErstellt | amDateFormat : 'DD.MM.YYYY'}}"></span>
                        <span ng-if="!mahn.active" data-translate="MAHNUNG_ABGESCHLOSSEN"></span>
                        <span ng-if="mahn.active && mahn.datumFristablauf.diff(moment.now) > 0"
                              data-translate="MAHNUNG_AKTIV"
                              data-translate-value-date="{{mahn.datumFristablauf | amDateFormat : 'DD.MM.YYYY'}}"></span>
                        <span ng-if="mahn.active && mahn.datumFristablauf.diff(moment.now) <= 0"
                              data-translate="MAHNUNG_NICHT_EINGETRETEN"></span>
                    </button>
                </div>
            </div>

            <!-- Mahnungsdetails, neue Mahnung erstellen -->
            <div class="row text-left" ng-if="vm.showErsteMahnungAusloesen() || vm.showZweiteMahnungAusloesen()">
                <div class="col-md-12">
                    <h1 data-translate="ERSTE_MAHNUNG" ng-if="vm.showErsteMahnungAusloesen()"></h1>
                    <h1 data-translate="ZWEITE_MAHNUNG" ng-if="vm.showZweiteMahnungAusloesen()"></h1>
                    <hr class="header"/>

                    <dv-input-container class="col-md-12 form-group kommentar-feld">
                        <label class="md-no-float" for="bemerkungenID" data-translate="MAHNUNG_FEHLENDE_DOKUMENTE"></label>
                        <textarea name="bemerkungen" md-no-autogrow class="form-control input-element" rows="4" id="bemerkungenID"
                            ng-model="vm.mahnung.bemerkungen" ng-required="true" maxlength="1000">
                        </textarea>
                        <dv-error-messages for="formMahnung.bemerkungen.$error" class="error"></dv-error-messages>
                    </dv-input-container>

                    <dv-input-container class="col-sm-12 form-group dv-input-container-small">
                        <label class="md-no-float" for="datumFristablaufID" data-translate="MAHNUNG_FRISTABLAUF"></label>
                        <dv-datepicker input-id="datumFristablaufID" name="datumFristablauf" class="input-element-small"
                                       ng-model="vm.mahnung.datumFristablauf" ng-required="true">
                        </dv-datepicker>
                        <dv-error-messages for="formMahnung.datumFristablauf.$error" class="error"></dv-error-messages>
                    </dv-input-container>

                    <div class="col-md-12">
                        <i class="fa fa-file-text-o"></i>
                        <button type="button" class=" btn-link" ng-click="vm.openMahnungPDF()">
                            <span data-translate="PDF_MAHNUNG_ANZEIGEN"></span>
                        </button>
                    </div>
                </div>
            </div>

        <div class="row" dv-show-element dv-show-allowed-roles="vm.TSRoleUtil.getAllRolesButTraegerschaftInstitution()">
            <div class="col-md-12 text-center row">
                <span class="col-md-4" ng-show="vm.showGeprueft()">
                    <dv-loading-button type="button" button-click="vm.setGesuchStatusGeprueft()"
                                       button-class="dv-btn-sm color-success" aria-label="{{GEPRUEFT_UPPER | translate}}">
                        <span data-translate="GEPRUEFT_UPPER"></span>
                    </dv-loading-button>
                </span>
                <span class="col-md-4" ng-show="vm.showVerfuegenStarten()">
                    <dv-loading-button button-click="vm.setGesuchStatusVerfuegen()"
                                       button-class="dv-btn-sm color-success"
                                       aria-label="{{VERFUEGUNG_STARTEN_UPPER | translate}}">
                        <span data-translate="VERFUEGUNG_STARTEN_UPPER"></span>
                    </dv-loading-button>
                </span>

                <span class="col-md-4" ng-show="vm.showErsteMahnungErstellen()">
                    <dv-loading-button button-click="vm.ersteMahnungErstellen()"
                                       button-class="dv-btn-sm"
                                       aria-label="{{ERSTE_MAHNUNG_UPPER | translate}}">
                        <span data-translate="ERSTE_MAHNUNG_UPPER"></span>
                    </dv-loading-button>
                </span>
                <span class="col-md-4" ng-show="vm.showErsteMahnungAusloesen()">
                    <dv-loading-button type="submit" button-click="vm.saveMahnung(formMahnung)"
                                       button-class="dv-btn-sm"
                                       aria-label="{{ERSTE_MAHNUNG_AUSLOESEN_UPPER | translate}}">
                        <span data-translate="ERSTE_MAHNUNG_AUSLOESEN_UPPER"></span>
                    </dv-loading-button>
                </span>
                <span class="col-md-4" ng-show="vm.showZweiteMahnungErstellen()">
                    <dv-loading-button button-click="vm.zweiteMahnungErstellen()"
                                       button-class="dv-btn-sm"
                                       aria-label="{{ZWEITE_MAHNUNG_UPPER | translate}}">
                        <span data-translate="ZWEITE_MAHNUNG_UPPER"></span>
                    </dv-loading-button>
                </span>
                <span class="col-md-4" ng-show="vm.showZweiteMahnungAusloesen()">
                    <dv-loading-button type="submit" button-click="vm.saveMahnung(formMahnung)"
                                       button-class="dv-btn-sm"
                                       aria-label="{{ZWEITE_MAHNUNG_AUSLOESEN_UPPER | translate}}">
                        <span data-translate="ZWEITE_MAHNUNG_AUSLOESEN_UPPER"></span>
                    </dv-loading-button>
                </span>
                 <span class="col-md-4" ng-show="vm.showMahnlaufBeenden()">
                    <dv-loading-button button-click="vm.mahnlaufBeenden()"
                                       button-class="dv-btn-sm"
                                       aria-label="{{DOKUMENTE_KOMPLETT_UPPER | translate}}">
                        <span data-translate="MAHNLAUF_BEENDEN"></span>
                    </dv-loading-button>
                </span>
                <span class="col-md-4" ng-show="vm.showDokumenteNichtKomplett()">
                    <dv-loading-button button-click="vm.dokumenteNichtKomplett()"
                                       button-class="dv-btn-sm"
                                       aria-label="{{DOKUMENTE_NICHT_KOMPLETT_UPPER | translate}}">
                        <span data-translate="DOKUMENTE_NICHT_KOMPLETT_UPPER"></span>
                    </dv-loading-button>
                </span>
                <span class="col-md-4" ng-show="vm.showZweiteMahnungNichtEingetreten()">
                    <dv-loading-button button-click="vm.zweiteMahnungNichtEingetreten()"
                                       button-class="dv-btn-sm"
                                       aria-label="{{ZWEITE_MAHNUNG_NCINT_EINGETRETEN | translate}}">
                        <span data-translate="ZWEITE_MAHNUNG_NCINT_EINGETRETEN"></span>
                    </dv-loading-button>
                </span>

                <span class="col-md-4" ng-show="vm.showGeprueft()">
                    <dv-loading-button button-class="dv-btn-sm"
                                       aria-label="{{ZURUECK_GESUCHSTELLER_UPPER | translate}}">
                        <span data-translate="ZURUECK_GESUCHSTELLER_UPPER"></span>
                    </dv-loading-button>
                </span>
            </div>
        </div>
    </div>
    </div>
    <div class="row marginTop20">
        <div class="col-md-12"><!--Buttons-->
            <dv-navigation dv-previous="true" dv-next="false" dv-sub-step="1">
            </dv-navigation>
        </div>
    </div>

    </form>
</div>
