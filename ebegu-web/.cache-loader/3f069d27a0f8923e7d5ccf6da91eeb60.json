{"remainingRequest":"/home/imanol/projects/ebegu/ebegu-web/node_modules/thread-loader/dist/cjs.js??ref--0-1!/home/imanol/projects/ebegu/ebegu-web/node_modules/ts-loader/index.js??ref--0-2!/home/imanol/projects/ebegu/ebegu-web/src/admin/component/testdatenView/testdatenView.ts","cacheIdentifier":"cache-loader:1.1.0 test","dependencies":[{"path":"/home/imanol/projects/ebegu/ebegu-web/src/admin/component/testdatenView/testdatenView.ts","mtime":1518612532786},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/cache-loader/dist/cjs.js","mtime":1507514019000},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/thread-loader/dist/cjs.js","mtime":1507523420000},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/ts-loader/index.js","mtime":1508488471000}],"contextDependencies":[],"result":["\"use strict\";\n/*\n * Ki-Tax: System for the management of external childcare subsidies\n * Copyright (C) 2017 City of Bern Switzerland\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar OkDialogController_1 = require(\"../../../gesuch/dialog/OkDialogController\");\nvar LinkDialogController_1 = require(\"../../../gesuch/dialog/LinkDialogController\");\nrequire('./testdatenView.less');\nvar template = require('./testdatenView.html');\nvar okDialogTempl = require('../../../gesuch/dialog/okDialogTemplate.html');\nvar linkDialogTempl = require('../../../gesuch/dialog/linkDialogTemplate.html');\nvar TestdatenViewComponentConfig = /** @class */ (function () {\n    function TestdatenViewComponentConfig() {\n        this.transclude = false;\n        this.template = template;\n        this.controller = TestdatenViewController;\n        this.controllerAs = 'vm';\n    }\n    return TestdatenViewComponentConfig;\n}());\nexports.TestdatenViewComponentConfig = TestdatenViewComponentConfig;\nvar TestdatenViewController = /** @class */ (function () {\n    /* @ngInject */\n    function TestdatenViewController(testFaelleRS, dvDialog, userRS, errorService, reindexRS, gesuchsperiodeRS, databaseMigrationRS, zahlungRS, applicationPropertyRS, gesuchRS, dailyBatchRS) {\n        this.dvDialog = dvDialog;\n        this.userRS = userRS;\n        this.errorService = errorService;\n        this.reindexRS = reindexRS;\n        this.gesuchsperiodeRS = gesuchsperiodeRS;\n        this.databaseMigrationRS = databaseMigrationRS;\n        this.zahlungRS = zahlungRS;\n        this.applicationPropertyRS = applicationPropertyRS;\n        this.gesuchRS = gesuchRS;\n        this.dailyBatchRS = dailyBatchRS;\n        this.creationType = 'verfuegt';\n        this.testFaelleRS = testFaelleRS;\n    }\n    TestdatenViewController.prototype.$onInit = function () {\n        var _this = this;\n        this.userRS.getAllGesuchsteller().then(function (result) {\n            _this.gesuchstellerList = result;\n        });\n        this.gesuchsperiodeRS.getAllGesuchsperioden().then(function (result) {\n            _this.gesuchsperiodeList = result;\n        });\n        this.applicationPropertyRS.isDevMode().then(function (response) {\n            _this.devMode = response;\n        });\n    };\n    TestdatenViewController.prototype.createTestFallType = function (testFall) {\n        var bestaetigt = false;\n        var verfuegen = false;\n        if (this.creationType === 'warten') {\n            bestaetigt = false;\n            verfuegen = false;\n        }\n        else if (this.creationType === 'bestaetigt') {\n            bestaetigt = true;\n            verfuegen = false;\n        }\n        else if (this.creationType === 'verfuegt') {\n            bestaetigt = true;\n            verfuegen = true;\n        }\n        if (this.selectedBesitzer) {\n            return this.createTestFallGS(testFall, this.selectedGesuchsperiode.id, bestaetigt, verfuegen, this.selectedBesitzer.username);\n        }\n        else {\n            return this.createTestFall(testFall, this.selectedGesuchsperiode.id, bestaetigt, verfuegen);\n        }\n    };\n    TestdatenViewController.prototype.createTestFall = function (testFall, gesuchsperiodeId, bestaetigt, verfuegen) {\n        var _this = this;\n        return this.testFaelleRS.createTestFall(testFall, gesuchsperiodeId, bestaetigt, verfuegen).then(function (response) {\n            //einfach die letzten 36 zeichen der response als uuid betrachten, hacky ist aber nur fuer uns intern\n            var uuidPartOfString = response.data ? response.data.slice(-36) : '';\n            return _this.dvDialog.showDialog(linkDialogTempl, LinkDialogController_1.LinkDialogController, {\n                title: response.data,\n                link: '#/gesuch/fall/false///' + uuidPartOfString + '/',\n            }).then(function () {\n                //do nothing\n            });\n        });\n    };\n    TestdatenViewController.prototype.createTestFallGS = function (testFall, gesuchsperiodeId, bestaetigt, verfuegen, username) {\n        var _this = this;\n        return this.testFaelleRS.createTestFallGS(testFall, gesuchsperiodeId, bestaetigt, verfuegen, username).then(function (response) {\n            //einfach die letzten 36 zeichen der response als uuid betrachten, hacky ist aber nur fuer uns intern\n            var uuidPartOfString = response.data ? response.data.slice(-36) : '';\n            return _this.dvDialog.showDialog(linkDialogTempl, LinkDialogController_1.LinkDialogController, {\n                title: response.data,\n                link: '#/gesuch/fall/false///' + uuidPartOfString + '/',\n            }).then(function () {\n                //do nothing\n            });\n        });\n    };\n    TestdatenViewController.prototype.removeGesucheGS = function () {\n        var _this = this;\n        this.testFaelleRS.removeFaelleOfGS(this.selectedBesitzer.username).then(function () {\n            _this.errorService.addMesageAsInfo('Gesuche entfernt fuer ' + _this.selectedBesitzer.username);\n        });\n    };\n    TestdatenViewController.prototype.removeGesuchsperiode = function () {\n        var _this = this;\n        this.gesuchsperiodeRS.removeGesuchsperiode(this.selectedGesuchsperiode.id).then(function () {\n            _this.errorService.addMesageAsInfo('Gesuchsperiode entfernt ' + _this.selectedGesuchsperiode.gesuchsperiodeString);\n        });\n    };\n    TestdatenViewController.prototype.mutiereFallHeirat = function () {\n        var _this = this;\n        return this.testFaelleRS.mutiereFallHeirat(this.fallId, '0621fb5d-a187-5a91-abaf-8a813c4d263a', this.mutationsdatum, this.aenderungperHeirat).then(function (response) {\n            return _this.dvDialog.showDialog(okDialogTempl, OkDialogController_1.OkDialogController, {\n                title: response.data\n            }).then(function () {\n                //do nothing\n            });\n        });\n    };\n    TestdatenViewController.prototype.mutiereFallScheidung = function () {\n        var _this = this;\n        return this.testFaelleRS.mutiereFallScheidung(this.fallId, '0621fb5d-a187-5a91-abaf-8a813c4d263a', this.mutationsdatum, this.aenderungperScheidung).then(function (respone) {\n            return _this.dvDialog.showDialog(okDialogTempl, OkDialogController_1.OkDialogController, {\n                title: respone.data\n            }).then(function () {\n                //do nothing\n            });\n        });\n    };\n    TestdatenViewController.prototype.resetSchulungsdaten = function () {\n        var _this = this;\n        return this.testFaelleRS.resetSchulungsdaten().then(function (response) {\n            return _this.dvDialog.showDialog(okDialogTempl, OkDialogController_1.OkDialogController, {\n                title: response.data\n            }).then(function () {\n                //do nothing\n            });\n        });\n    };\n    TestdatenViewController.prototype.deleteSchulungsdaten = function () {\n        var _this = this;\n        return this.testFaelleRS.deleteSchulungsdaten().then(function (response) {\n            return _this.dvDialog.showDialog(okDialogTempl, OkDialogController_1.OkDialogController, {\n                title: response.data\n            }).then(function () {\n                //do nothing\n            });\n        });\n    };\n    TestdatenViewController.prototype.startReindex = function () {\n        return this.reindexRS.reindex();\n    };\n    TestdatenViewController.prototype.processScript = function (script) {\n        this.databaseMigrationRS.processScript(script);\n    };\n    TestdatenViewController.prototype.zahlungenKontrollieren = function () {\n        this.zahlungRS.zahlungenKontrollieren();\n    };\n    TestdatenViewController.prototype.deleteAllZahlungsauftraege = function () {\n        var _this = this;\n        this.dvDialog.showDialog(okDialogTempl, OkDialogController_1.OkDialogController, {\n            deleteText: 'ZAHLUNG_LOESCHEN_DIALOG_TEXT',\n            title: 'ZAHLUNG_LOESCHEN_DIALOG_TITLE',\n            parentController: undefined,\n            elementID: undefined\n        })\n            .then(function () {\n            _this.zahlungRS.deleteAllZahlungsauftraege();\n        });\n    };\n    TestdatenViewController.prototype.gesuchVerfuegen = function () {\n        var _this = this;\n        this.dvDialog.showDialog(okDialogTempl, OkDialogController_1.OkDialogController, {\n            deleteText: 'GESUCH_VERFUEGEN_DIALOG_TEXT',\n            title: 'GESUCH_VERFUEGEN_DIALOG_TITLE',\n            parentController: undefined,\n            elementID: undefined\n        })\n            .then(function () {\n            _this.gesuchRS.gesuchVerfuegen(_this.verfuegenGesuchid);\n        });\n    };\n    TestdatenViewController.prototype.runBatchMahnungFristablauf = function () {\n        var _this = this;\n        this.dailyBatchRS.runBatchMahnungFristablauf().then(function (response) {\n            var text = '';\n            if (response) {\n                text = 'MAHNUNG_BATCH_EXECUTED_OK';\n            }\n            else {\n                text = 'MAHNUNG_BATCH_EXECUTED_ERROR';\n            }\n            _this.dvDialog.showDialog(okDialogTempl, OkDialogController_1.OkDialogController, {\n                title: text\n            }).then(function () {\n                //do nothing\n            });\n        });\n    };\n    TestdatenViewController.$inject = ['TestFaelleRS', 'DvDialog', 'UserRS', 'ErrorService', 'ReindexRS', 'GesuchsperiodeRS',\n        'DatabaseMigrationRS', 'ZahlungRS', 'ApplicationPropertyRS', 'GesuchRS', 'DailyBatchRS'];\n    return TestdatenViewController;\n}());\nexports.TestdatenViewController = TestdatenViewController;\n",{"version":3,"file":"/home/imanol/projects/ebegu/ebegu-web/src/admin/component/testdatenView/testdatenView.ts","sourceRoot":"","sources":["/home/imanol/projects/ebegu/ebegu-web/src/admin/component/testdatenView/testdatenView.ts"],"names":[],"mappings":";AAAA;;;;;;;;;;;;;GAaG;;AAMH,gFAA6E;AAC7E,oFAAiF;AAajF,OAAO,CAAC,sBAAsB,CAAC,CAAC;AAChC,IAAI,QAAQ,GAAG,OAAO,CAAC,sBAAsB,CAAC,CAAC;AAC/C,IAAI,aAAa,GAAG,OAAO,CAAC,8CAA8C,CAAC,CAAC;AAC5E,IAAI,eAAe,GAAG,OAAO,CAAC,gDAAgD,CAAC,CAAC;AAEhF;IAAA;QACI,eAAU,GAAY,KAAK,CAAC;QAC5B,aAAQ,GAAW,QAAQ,CAAC;QAC5B,eAAU,GAAQ,uBAAuB,CAAC;QAC1C,iBAAY,GAAW,IAAI,CAAC;IAChC,CAAC;IAAD,mCAAC;AAAD,CAAC,AALD,IAKC;AALY,oEAA4B;AAOzC;IAoBI,eAAe;IACf,iCAAY,YAA0B,EAAU,QAAkB,EAAU,MAAc,EACtE,YAA0B,EAAU,SAAoB,EACxD,gBAAkC,EAAU,mBAAwC,EACpF,SAAoB,EAAU,qBAA4C,EAC1E,QAAkB,EAAU,YAA0B;QAJ1B,aAAQ,GAAR,QAAQ,CAAU;QAAU,WAAM,GAAN,MAAM,CAAQ;QACtE,iBAAY,GAAZ,YAAY,CAAc;QAAU,cAAS,GAAT,SAAS,CAAW;QACxD,qBAAgB,GAAhB,gBAAgB,CAAkB;QAAU,wBAAmB,GAAnB,mBAAmB,CAAqB;QACpF,cAAS,GAAT,SAAS,CAAW;QAAU,0BAAqB,GAArB,qBAAqB,CAAuB;QAC1E,aAAQ,GAAR,QAAQ,CAAU;QAAU,iBAAY,GAAZ,YAAY,CAAc;QAd1E,iBAAY,GAAW,UAAU,CAAC;QAe9B,IAAI,CAAC,YAAY,GAAG,YAAY,CAAC;IACrC,CAAC;IAED,yCAAO,GAAP;QAAA,iBAUC;QATG,IAAI,CAAC,MAAM,CAAC,mBAAmB,EAAE,CAAC,IAAI,CAAC,UAAC,MAAqB;YACzD,KAAI,CAAC,iBAAiB,GAAG,MAAM,CAAC;QACpC,CAAC,CAAC,CAAC;QACH,IAAI,CAAC,gBAAgB,CAAC,qBAAqB,EAAE,CAAC,IAAI,CAAC,UAAC,MAA+B;YAC/E,KAAI,CAAC,kBAAkB,GAAG,MAAM,CAAC;QACrC,CAAC,CAAC,CAAC;QACH,IAAI,CAAC,qBAAqB,CAAC,SAAS,EAAE,CAAC,IAAI,CAAC,UAAC,QAAiB;YAC1D,KAAI,CAAC,OAAO,GAAG,QAAQ,CAAC;QAC5B,CAAC,CAAC,CAAC;IACP,CAAC;IAEM,oDAAkB,GAAzB,UAA0B,QAAgB;QACtC,IAAI,UAAU,GAAY,KAAK,CAAC;QAChC,IAAI,SAAS,GAAY,KAAK,CAAC;QAC/B,EAAE,CAAC,CAAC,IAAI,CAAC,YAAY,KAAK,QAAQ,CAAC,CAAC,CAAC;YACjC,UAAU,GAAG,KAAK,CAAC;YACnB,SAAS,GAAG,KAAK,CAAC;QAEtB,CAAC;QAAC,IAAI,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,YAAY,KAAK,YAAY,CAAC,CAAC,CAAC;YAC5C,UAAU,GAAG,IAAI,CAAC;YAClB,SAAS,GAAG,KAAK,CAAC;QAEtB,CAAC;QAAC,IAAI,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,YAAY,KAAK,UAAU,CAAC,CAAC,CAAC;YAC1C,UAAU,GAAG,IAAI,CAAC;YAClB,SAAS,GAAG,IAAI,CAAC;QACrB,CAAC;QACD,EAAE,CAAC,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC;YACxB,MAAM,CAAC,IAAI,CAAC,gBAAgB,CAAC,QAAQ,EAAE,IAAI,CAAC,sBAAsB,CAAC,EAAE,EAAE,UAAU,EAAE,SAAS,EAAE,IAAI,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CAAC;QAClI,CAAC;QAAC,IAAI,CAAC,CAAC;YACJ,MAAM,CAAC,IAAI,CAAC,cAAc,CAAC,QAAQ,EAAE,IAAI,CAAC,sBAAsB,CAAC,EAAE,EAAE,UAAU,EAAE,SAAS,CAAC,CAAC;QAChG,CAAC;IACL,CAAC;IAEO,gDAAc,GAAtB,UAAuB,QAAgB,EAAE,gBAAwB,EAAE,UAAmB,EAAE,SAAkB;QAA1G,iBAWC;QAVG,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,cAAc,CAAC,QAAQ,EAAE,gBAAgB,EAAE,UAAU,EAAE,SAAS,CAAC,CAAC,IAAI,CAAC,UAAC,QAAQ;YACrG,qGAAqG;YACrG,IAAI,gBAAgB,GAAG,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;YACrE,MAAM,CAAC,KAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,eAAe,EAAE,2CAAoB,EAAE;gBACnE,KAAK,EAAE,QAAQ,CAAC,IAAI;gBACpB,IAAI,EAAE,wBAAwB,GAAG,gBAAgB,GAAG,GAAG;aAC1D,CAAC,CAAC,IAAI,CAAC;gBACJ,YAAY;YAChB,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CAAC;IACP,CAAC;IAEO,kDAAgB,GAAxB,UAAyB,QAAgB,EAAE,gBAAwB,EAAE,UAAmB,EAAE,SAAkB,EAAE,QAAgB;QAA9H,iBAWC;QAVG,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,gBAAgB,CAAC,QAAQ,EAAE,gBAAgB,EAAE,UAAU,EAAE,SAAS,EAAE,QAAQ,CAAC,CAAC,IAAI,CAAC,UAAC,QAAQ;YACjH,qGAAqG;YACrG,IAAI,gBAAgB,GAAG,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;YACrE,MAAM,CAAC,KAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,eAAe,EAAE,2CAAoB,EAAE;gBACnE,KAAK,EAAE,QAAQ,CAAC,IAAI;gBACpB,IAAI,EAAE,wBAAwB,GAAG,gBAAgB,GAAG,GAAG;aAC1D,CAAC,CAAC,IAAI,CAAC;gBACJ,YAAY;YAChB,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CAAC;IACP,CAAC;IAEM,iDAAe,GAAtB;QAAA,iBAIC;QAHG,IAAI,CAAC,YAAY,CAAC,gBAAgB,CAAC,IAAI,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC;YACpE,KAAI,CAAC,YAAY,CAAC,eAAe,CAAC,wBAAwB,GAAG,KAAI,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CAAC;QACjG,CAAC,CAAC,CAAC;IACP,CAAC;IAEM,sDAAoB,GAA3B;QAAA,iBAIC;QAHG,IAAI,CAAC,gBAAgB,CAAC,oBAAoB,CAAC,IAAI,CAAC,sBAAsB,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC;YAC5E,KAAI,CAAC,YAAY,CAAC,eAAe,CAAC,0BAA0B,GAAG,KAAI,CAAC,sBAAsB,CAAC,oBAAoB,CAAC,CAAC;QACrH,CAAC,CAAC,CAAC;IACP,CAAC;IAEM,mDAAiB,GAAxB;QAAA,iBASC;QARG,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,iBAAiB,CAAC,IAAI,CAAC,MAAM,EAAE,sCAAsC,EAC1F,IAAI,CAAC,cAAc,EAAE,IAAI,CAAC,kBAAkB,CAAC,CAAC,IAAI,CAAC,UAAC,QAAQ;YAC5D,MAAM,CAAC,KAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,aAAa,EAAE,uCAAkB,EAAE;gBAC/D,KAAK,EAAE,QAAQ,CAAC,IAAI;aACvB,CAAC,CAAC,IAAI,CAAC;gBACJ,YAAY;YAChB,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CAAC;IACP,CAAC;IAEM,sDAAoB,GAA3B;QAAA,iBASC;QARG,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,oBAAoB,CAAC,IAAI,CAAC,MAAM,EAAE,sCAAsC,EAC7F,IAAI,CAAC,cAAc,EAAE,IAAI,CAAC,qBAAqB,CAAC,CAAC,IAAI,CAAC,UAAC,OAAO;YAC9D,MAAM,CAAC,KAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,aAAa,EAAE,uCAAkB,EAAE;gBAC/D,KAAK,EAAE,OAAO,CAAC,IAAI;aACtB,CAAC,CAAC,IAAI,CAAC;gBACJ,YAAY;YAChB,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CAAC;IACP,CAAC;IAEM,qDAAmB,GAA1B;QAAA,iBAQC;QAPG,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,mBAAmB,EAAE,CAAC,IAAI,CAAC,UAAC,QAAQ;YACzD,MAAM,CAAC,KAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,aAAa,EAAE,uCAAkB,EAAE;gBAC/D,KAAK,EAAE,QAAQ,CAAC,IAAI;aACvB,CAAC,CAAC,IAAI,CAAC;gBACJ,YAAY;YAChB,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CAAC;IACP,CAAC;IAEM,sDAAoB,GAA3B;QAAA,iBAQC;QAPG,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,oBAAoB,EAAE,CAAC,IAAI,CAAC,UAAC,QAAQ;YAC1D,MAAM,CAAC,KAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,aAAa,EAAE,uCAAkB,EAAE;gBAC/D,KAAK,EAAE,QAAQ,CAAC,IAAI;aACvB,CAAC,CAAC,IAAI,CAAC;gBACJ,YAAY;YAChB,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CAAC;IACP,CAAC;IAEM,8CAAY,GAAnB;QACI,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE,CAAC;IACpC,CAAC;IAEM,+CAAa,GAApB,UAAqB,MAAc;QAC/B,IAAI,CAAC,mBAAmB,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;IACnD,CAAC;IAEM,wDAAsB,GAA7B;QACI,IAAI,CAAC,SAAS,CAAC,sBAAsB,EAAE,CAAC;IAC5C,CAAC;IACM,4DAA0B,GAAjC;QAAA,iBAUC;QATG,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,aAAa,EAAE,uCAAkB,EAAE;YACxD,UAAU,EAAE,8BAA8B;YAC1C,KAAK,EAAE,+BAA+B;YACtC,gBAAgB,EAAE,SAAS;YAC3B,SAAS,EAAE,SAAS;SACvB,CAAC;aACG,IAAI,CAAC;YACF,KAAI,CAAC,SAAS,CAAC,0BAA0B,EAAE,CAAC;QAChD,CAAC,CAAC,CAAC;IACX,CAAC;IAEM,iDAAe,GAAtB;QAAA,iBAUC;QATG,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,aAAa,EAAE,uCAAkB,EAAE;YACxD,UAAU,EAAE,8BAA8B;YAC1C,KAAK,EAAE,+BAA+B;YACtC,gBAAgB,EAAE,SAAS;YAC3B,SAAS,EAAE,SAAS;SACvB,CAAC;aACG,IAAI,CAAC;YACF,KAAI,CAAC,QAAQ,CAAC,eAAe,CAAC,KAAI,CAAC,iBAAiB,CAAC,CAAC;QAC1D,CAAC,CAAC,CAAC;IACX,CAAC;IAEM,4DAA0B,GAAjC;QAAA,iBAcC;QAbG,IAAI,CAAC,YAAY,CAAC,0BAA0B,EAAE,CAAC,IAAI,CAAC,UAAC,QAAQ;YACzD,IAAI,IAAI,GAAW,EAAE,CAAC;YACtB,EAAE,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;gBACX,IAAI,GAAG,2BAA2B,CAAC;YACvC,CAAC;YAAC,IAAI,CAAC,CAAC;gBACJ,IAAI,GAAG,8BAA8B,CAAC;YAC1C,CAAC;YACD,KAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,aAAa,EAAE,uCAAkB,EAAE;gBACxD,KAAK,EAAE,IAAI;aACd,CAAC,CAAC,IAAI,CAAC;gBACJ,YAAY;YAChB,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CAAC;IACP,CAAC;IA/LM,+BAAO,GAAG,CAAC,cAAc,EAAE,UAAU,EAAE,QAAQ,EAAE,cAAc,EAAE,WAAW,EAAE,kBAAkB;QACnG,qBAAqB,EAAE,WAAW,EAAE,uBAAuB,EAAE,UAAU,EAAE,cAAc,CAAC,CAAC;IAgMjG,8BAAC;CAAA,AAlMD,IAkMC;AAlMY,0DAAuB","sourcesContent":["/*\n * Ki-Tax: System for the management of external childcare subsidies\n * Copyright (C) 2017 City of Bern Switzerland\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport {IComponentOptions, IPromise} from 'angular';\nimport {TestFaelleRS} from '../../service/testFaelleRS.rest';\nimport {DatabaseMigrationRS} from '../../service/databaseMigrationRS.rest';\nimport {DvDialog} from '../../../core/directive/dv-dialog/dv-dialog';\nimport {OkDialogController} from '../../../gesuch/dialog/OkDialogController';\nimport {LinkDialogController} from '../../../gesuch/dialog/LinkDialogController';\nimport TSUser from '../../../models/TSUser';\nimport UserRS from '../../../core/service/userRS.rest';\nimport ErrorService from '../../../core/errors/service/ErrorService';\nimport {ReindexRS} from '../../service/reindexRS.rest';\nimport * as moment from 'moment';\nimport TSGesuchsperiode from '../../../models/TSGesuchsperiode';\nimport GesuchsperiodeRS from '../../../core/service/gesuchsperiodeRS.rest';\nimport ZahlungRS from '../../../core/service/zahlungRS.rest';\nimport {ApplicationPropertyRS} from '../../service/applicationPropertyRS.rest';\nimport GesuchRS from '../../../gesuch/service/gesuchRS.rest';\nimport {DailyBatchRS} from '../../service/dailyBatchRS.rest';\n\nrequire('./testdatenView.less');\nlet template = require('./testdatenView.html');\nlet okDialogTempl = require('../../../gesuch/dialog/okDialogTemplate.html');\nlet linkDialogTempl = require('../../../gesuch/dialog/linkDialogTemplate.html');\n\nexport class TestdatenViewComponentConfig implements IComponentOptions {\n    transclude: boolean = false;\n    template: string = template;\n    controller: any = TestdatenViewController;\n    controllerAs: string = 'vm';\n}\n\nexport class TestdatenViewController {\n    static $inject = ['TestFaelleRS', 'DvDialog', 'UserRS', 'ErrorService', 'ReindexRS', 'GesuchsperiodeRS',\n        'DatabaseMigrationRS', 'ZahlungRS', 'ApplicationPropertyRS', 'GesuchRS', 'DailyBatchRS'];\n\n    testFaelleRS: TestFaelleRS;\n    fallId: number;\n    verfuegenGesuchid: string;\n    mutationsdatum: moment.Moment;\n    aenderungperHeirat: moment.Moment;\n    aenderungperScheidung: moment.Moment;\n\n    creationType: string = 'verfuegt';\n    selectedBesitzer: TSUser;\n    gesuchstellerList: Array<TSUser>;\n\n    selectedGesuchsperiode: TSGesuchsperiode;\n    gesuchsperiodeList: Array<TSGesuchsperiode>;\n\n    devMode: boolean;\n\n    /* @ngInject */\n    constructor(testFaelleRS: TestFaelleRS, private dvDialog: DvDialog, private userRS: UserRS,\n                private errorService: ErrorService, private reindexRS: ReindexRS,\n                private gesuchsperiodeRS: GesuchsperiodeRS, private databaseMigrationRS: DatabaseMigrationRS,\n                private zahlungRS: ZahlungRS, private applicationPropertyRS: ApplicationPropertyRS,\n                private gesuchRS: GesuchRS, private dailyBatchRS: DailyBatchRS) {\n        this.testFaelleRS = testFaelleRS;\n    }\n\n    $onInit() {\n        this.userRS.getAllGesuchsteller().then((result: Array<TSUser>) => {\n            this.gesuchstellerList = result;\n        });\n        this.gesuchsperiodeRS.getAllGesuchsperioden().then((result: Array<TSGesuchsperiode>) => {\n            this.gesuchsperiodeList = result;\n        });\n        this.applicationPropertyRS.isDevMode().then((response: boolean) => {\n            this.devMode = response;\n        });\n    }\n\n    public createTestFallType(testFall: string): IPromise<any> {\n        let bestaetigt: boolean = false;\n        let verfuegen: boolean = false;\n        if (this.creationType === 'warten') {\n            bestaetigt = false;\n            verfuegen = false;\n\n        } else if (this.creationType === 'bestaetigt') {\n            bestaetigt = true;\n            verfuegen = false;\n\n        } else if (this.creationType === 'verfuegt') {\n            bestaetigt = true;\n            verfuegen = true;\n        }\n        if (this.selectedBesitzer) {\n            return this.createTestFallGS(testFall, this.selectedGesuchsperiode.id, bestaetigt, verfuegen, this.selectedBesitzer.username);\n        } else {\n            return this.createTestFall(testFall, this.selectedGesuchsperiode.id, bestaetigt, verfuegen);\n        }\n    }\n\n    private createTestFall(testFall: string, gesuchsperiodeId: string, bestaetigt: boolean, verfuegen: boolean): IPromise<any> {\n        return this.testFaelleRS.createTestFall(testFall, gesuchsperiodeId, bestaetigt, verfuegen).then((response) => {\n            //einfach die letzten 36 zeichen der response als uuid betrachten, hacky ist aber nur fuer uns intern\n            let uuidPartOfString = response.data ? response.data.slice(-36) : '';\n            return this.dvDialog.showDialog(linkDialogTempl, LinkDialogController, {\n                title: response.data,\n                link: '#/gesuch/fall/false///' + uuidPartOfString + '/', //nicht alle Parameter werden benoetigt, deswegen sind sie leer\n            }).then(() => {\n                //do nothing\n            });\n        });\n    }\n\n    private createTestFallGS(testFall: string, gesuchsperiodeId: string, bestaetigt: boolean, verfuegen: boolean, username: string): IPromise<any> {\n        return this.testFaelleRS.createTestFallGS(testFall, gesuchsperiodeId, bestaetigt, verfuegen, username).then((response) => {\n            //einfach die letzten 36 zeichen der response als uuid betrachten, hacky ist aber nur fuer uns intern\n            let uuidPartOfString = response.data ? response.data.slice(-36) : '';\n            return this.dvDialog.showDialog(linkDialogTempl, LinkDialogController, {\n                title: response.data,\n                link: '#/gesuch/fall/false///' + uuidPartOfString + '/', //nicht alle Parameter werden benoetigt, deswegen sind sie leer\n            }).then(() => {\n                //do nothing\n            });\n        });\n    }\n\n    public removeGesucheGS() {\n        this.testFaelleRS.removeFaelleOfGS(this.selectedBesitzer.username).then(() => {\n            this.errorService.addMesageAsInfo('Gesuche entfernt fuer ' + this.selectedBesitzer.username);\n        });\n    }\n\n    public removeGesuchsperiode() {\n        this.gesuchsperiodeRS.removeGesuchsperiode(this.selectedGesuchsperiode.id).then(() => {\n            this.errorService.addMesageAsInfo('Gesuchsperiode entfernt ' + this.selectedGesuchsperiode.gesuchsperiodeString);\n        });\n    }\n\n    public mutiereFallHeirat(): IPromise<any> {\n        return this.testFaelleRS.mutiereFallHeirat(this.fallId, '0621fb5d-a187-5a91-abaf-8a813c4d263a',\n            this.mutationsdatum, this.aenderungperHeirat).then((response) => {\n            return this.dvDialog.showDialog(okDialogTempl, OkDialogController, {\n                title: response.data\n            }).then(() => {\n                //do nothing\n            });\n        });\n    }\n\n    public mutiereFallScheidung(): IPromise<any> {\n        return this.testFaelleRS.mutiereFallScheidung(this.fallId, '0621fb5d-a187-5a91-abaf-8a813c4d263a',\n            this.mutationsdatum, this.aenderungperScheidung).then((respone) => {\n            return this.dvDialog.showDialog(okDialogTempl, OkDialogController, {\n                title: respone.data\n            }).then(() => {\n                //do nothing\n            });\n        });\n    }\n\n    public resetSchulungsdaten(): IPromise<any> {\n        return this.testFaelleRS.resetSchulungsdaten().then((response) => {\n            return this.dvDialog.showDialog(okDialogTempl, OkDialogController, {\n                title: response.data\n            }).then(() => {\n                //do nothing\n            });\n        });\n    }\n\n    public deleteSchulungsdaten(): IPromise<any> {\n        return this.testFaelleRS.deleteSchulungsdaten().then((response) => {\n            return this.dvDialog.showDialog(okDialogTempl, OkDialogController, {\n                title: response.data\n            }).then(() => {\n                //do nothing\n            });\n        });\n    }\n\n    public startReindex() {\n        return this.reindexRS.reindex();\n    }\n\n    public processScript(script: string): void {\n        this.databaseMigrationRS.processScript(script);\n    }\n\n    public zahlungenKontrollieren(): void {\n        this.zahlungRS.zahlungenKontrollieren();\n    }\n    public deleteAllZahlungsauftraege(): void {\n        this.dvDialog.showDialog(okDialogTempl, OkDialogController, {\n            deleteText: 'ZAHLUNG_LOESCHEN_DIALOG_TEXT',\n            title: 'ZAHLUNG_LOESCHEN_DIALOG_TITLE',\n            parentController: undefined,\n            elementID: undefined\n        })\n            .then(() => {   //User confirmed removal\n                this.zahlungRS.deleteAllZahlungsauftraege();\n            });\n    }\n\n    public gesuchVerfuegen(): void {\n        this.dvDialog.showDialog(okDialogTempl, OkDialogController, {\n            deleteText: 'GESUCH_VERFUEGEN_DIALOG_TEXT',\n            title: 'GESUCH_VERFUEGEN_DIALOG_TITLE',\n            parentController: undefined,\n            elementID: undefined\n        })\n            .then(() => {   //User confirmed removal\n                this.gesuchRS.gesuchVerfuegen(this.verfuegenGesuchid);\n            });\n    }\n\n    public runBatchMahnungFristablauf(): void {\n        this.dailyBatchRS.runBatchMahnungFristablauf().then((response) => {\n            let text: string = '';\n            if (response) {\n                text = 'MAHNUNG_BATCH_EXECUTED_OK';\n            } else {\n                text = 'MAHNUNG_BATCH_EXECUTED_ERROR';\n            }\n            this.dvDialog.showDialog(okDialogTempl, OkDialogController, {\n                title: text\n            }).then(() => {\n                //do nothing\n            });\n        });\n    }\n\n}\n"]}]}