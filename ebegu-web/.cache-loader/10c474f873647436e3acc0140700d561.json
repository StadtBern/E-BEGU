{"remainingRequest":"/home/imanol/projects/ebegu/ebegu-web/node_modules/thread-loader/dist/cjs.js??ref--0-1!/home/imanol/projects/ebegu/ebegu-web/node_modules/ts-loader/index.js??ref--0-2!/home/imanol/projects/ebegu/ebegu-web/src/gesuch/dialog/FreigabeController.ts","cacheIdentifier":"cache-loader:1.1.0 test","dependencies":[{"path":"/home/imanol/projects/ebegu/ebegu-web/src/gesuch/dialog/FreigabeController.ts","mtime":1518535855228},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/cache-loader/dist/cjs.js","mtime":1507514019000},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/thread-loader/dist/cjs.js","mtime":1507523420000},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/ts-loader/index.js","mtime":1508488471000}],"contextDependencies":[],"result":["/*\n * Ki-Tax: System for the management of external childcare subsidies\n * Copyright (C) 2017 City of Bern Switzerland\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n */\ndefine([\"require\", \"exports\"], function (require, exports) {\n    \"use strict\";\n    Object.defineProperty(exports, \"__esModule\", { value: true });\n    /**\n     * Controller fuer das Freigabe Popup\n     */\n    var FreigabeController = /** @class */ (function () {\n        function FreigabeController(docID, $mdDialog, gesuchRS, userRS, authService, ebeguUtil, CONSTANTS, $translate) {\n            var _this = this;\n            this.docID = docID;\n            this.$mdDialog = $mdDialog;\n            this.gesuchRS = gesuchRS;\n            this.userRS = userRS;\n            this.authService = authService;\n            this.ebeguUtil = ebeguUtil;\n            this.$translate = $translate;\n            gesuchRS.findGesuchForFreigabe(this.docID).then(function (response) {\n                _this.errorMessage = undefined; // just for safety replace old value\n                if (response) {\n                    if (response.canBeFreigegeben()) {\n                        _this.gesuch = response;\n                        _this.fallNummer = ebeguUtil.addZerosToNumber(response.fallNummer, CONSTANTS.FALLNUMMER_LENGTH);\n                        _this.familie = response.familienName;\n                        _this.selectedUser = authService.getPrincipal().username;\n                    }\n                    else {\n                        _this.errorMessage = _this.$translate.instant('FREIGABE_GESUCH_ALREADY_FREIGEGEBEN');\n                    }\n                }\n                else {\n                    _this.errorMessage = _this.$translate.instant('FREIGABE_GESUCH_NOT_FOUND');\n                }\n            }).catch(function () {\n                _this.cancel(); // close popup\n            });\n            this.updateUserList();\n        }\n        FreigabeController.prototype.updateUserList = function () {\n            var _this = this;\n            this.userRS.getBenutzerJAorAdmin().then(function (response) {\n                _this.userList = angular.copy(response);\n            });\n        };\n        FreigabeController.prototype.isSchulamt = function () {\n            return this.gesuch ? this.gesuch.hasOnlySchulamtAngebote() : false;\n        };\n        FreigabeController.prototype.hasError = function () {\n            return this.errorMessage != null;\n        };\n        FreigabeController.prototype.hide = function () {\n            var _this = this;\n            return this.gesuchRS.antragFreigeben(this.docID, this.selectedUser)\n                .then(function () {\n                return _this.$mdDialog.hide();\n            });\n        };\n        FreigabeController.prototype.cancel = function () {\n            this.$mdDialog.cancel();\n        };\n        FreigabeController.$inject = ['docID', '$mdDialog', 'GesuchRS', 'UserRS', 'AuthServiceRS',\n            'EbeguUtil', 'CONSTANTS', '$translate'];\n        return FreigabeController;\n    }());\n    exports.FreigabeController = FreigabeController;\n});\n",{"version":3,"file":"/home/imanol/projects/ebegu/ebegu-web/src/gesuch/dialog/FreigabeController.ts","sourceRoot":"","sources":["/home/imanol/projects/ebegu/ebegu-web/src/gesuch/dialog/FreigabeController.ts"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;GAaG;;;;IAYH;;OAEG;IACH;QAYI,4BAAoB,KAAa,EAAU,SAAyB,EAAU,QAAkB,EAC5E,MAAc,EAAU,WAA0B,EAAU,SAAoB,EACxF,SAAc,EAAU,UAA6B;YAFjE,iBAwBC;YAxBmB,UAAK,GAAL,KAAK,CAAQ;YAAU,cAAS,GAAT,SAAS,CAAgB;YAAU,aAAQ,GAAR,QAAQ,CAAU;YAC5E,WAAM,GAAN,MAAM,CAAQ;YAAU,gBAAW,GAAX,WAAW,CAAe;YAAU,cAAS,GAAT,SAAS,CAAW;YAChE,eAAU,GAAV,UAAU,CAAmB;YAE7D,QAAQ,CAAC,qBAAqB,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,UAAC,QAAqB;gBAClE,KAAI,CAAC,YAAY,GAAG,SAAS,CAAC,CAAC,oCAAoC;gBACnE,EAAE,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;oBACX,EAAE,CAAC,CAAC,QAAQ,CAAC,gBAAgB,EAAE,CAAC,CAAC,CAAC;wBAC9B,KAAI,CAAC,MAAM,GAAG,QAAQ,CAAC;wBACvB,KAAI,CAAC,UAAU,GAAG,SAAS,CAAC,gBAAgB,CAAC,QAAQ,CAAC,UAAU,EAAE,SAAS,CAAC,iBAAiB,CAAC,CAAC;wBAC/F,KAAI,CAAC,OAAO,GAAG,QAAQ,CAAC,YAAY,CAAC;wBACrC,KAAI,CAAC,YAAY,GAAG,WAAW,CAAC,YAAY,EAAE,CAAC,QAAQ,CAAC;oBAC5D,CAAC;oBAAC,IAAI,CAAC,CAAC;wBACJ,KAAI,CAAC,YAAY,GAAG,KAAI,CAAC,UAAU,CAAC,OAAO,CAAC,qCAAqC,CAAC,CAAC;oBACvF,CAAC;gBACL,CAAC;gBAAC,IAAI,CAAC,CAAC;oBACJ,KAAI,CAAC,YAAY,GAAG,KAAI,CAAC,UAAU,CAAC,OAAO,CAAC,2BAA2B,CAAC,CAAC;gBAC7E,CAAC;YACL,CAAC,CAAC,CAAC,KAAK,CAAC;gBACL,KAAI,CAAC,MAAM,EAAE,CAAC,CAAC,cAAc;YACjC,CAAC,CAAC,CAAC;YAEH,IAAI,CAAC,cAAc,EAAE,CAAC;QAE1B,CAAC;QAGO,2CAAc,GAAtB;YAAA,iBAIC;YAHG,IAAI,CAAC,MAAM,CAAC,oBAAoB,EAAE,CAAC,IAAI,CAAC,UAAC,QAAa;gBAClD,KAAI,CAAC,QAAQ,GAAG,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YAC3C,CAAC,CAAC,CAAC;QACP,CAAC;QAEM,uCAAU,GAAjB;YACI,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,uBAAuB,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC;QACvE,CAAC;QAEM,qCAAQ,GAAf;YACI,MAAM,CAAC,IAAI,CAAC,YAAY,IAAI,IAAI,CAAC;QACrC,CAAC;QAEM,iCAAI,GAAX;YAAA,iBAKC;YAJG,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,eAAe,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,YAAY,CAAC;iBAC9D,IAAI,CAAC;gBACF,MAAM,CAAC,KAAI,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC;YACjC,CAAC,CAAC,CAAC;QACX,CAAC;QAEM,mCAAM,GAAb;YACI,IAAI,CAAC,SAAS,CAAC,MAAM,EAAE,CAAC;QAC5B,CAAC;QA5DM,0BAAO,GAAa,CAAC,OAAO,EAAE,WAAW,EAAE,UAAU,EAAE,QAAQ,EAAE,eAAe;YACnF,WAAW,EAAE,WAAW,EAAE,YAAY,CAAC,CAAC;QA6DhD,yBAAC;KAAA,AAhED,IAgEC;IAhEY,gDAAkB","sourcesContent":["/*\n * Ki-Tax: System for the management of external childcare subsidies\n * Copyright (C) 2017 City of Bern Switzerland\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport GesuchRS from '../service/gesuchRS.rest';\nimport TSUser from '../../models/TSUser';\nimport UserRS from '../../core/service/userRS.rest';\nimport EbeguUtil from '../../utils/EbeguUtil';\nimport AuthServiceRS from '../../authentication/service/AuthServiceRS.rest';\nimport TSAntragDTO from '../../models/TSAntragDTO';\nimport IPromise = angular.IPromise;\nimport IDialogService = angular.material.IDialogService;\nimport ITranslateService = angular.translate.ITranslateService;\n\n/**\n * Controller fuer das Freigabe Popup\n */\nexport class FreigabeController {\n\n    static $inject: string[] = ['docID', '$mdDialog', 'GesuchRS', 'UserRS', 'AuthServiceRS',\n        'EbeguUtil', 'CONSTANTS', '$translate'];\n\n    private gesuch: TSAntragDTO;\n    private selectedUser: string;\n    private userList: Array<TSUser>;\n    private fallNummer: string;\n    private familie: string;\n    private errorMessage: string;\n\n    constructor(private docID: string, private $mdDialog: IDialogService, private gesuchRS: GesuchRS,\n                private userRS: UserRS, private authService: AuthServiceRS, private ebeguUtil: EbeguUtil,\n                CONSTANTS: any, private $translate: ITranslateService) {\n\n        gesuchRS.findGesuchForFreigabe(this.docID).then((response: TSAntragDTO) => {\n            this.errorMessage = undefined; // just for safety replace old value\n            if (response) {\n                if (response.canBeFreigegeben()) {\n                    this.gesuch = response;\n                    this.fallNummer = ebeguUtil.addZerosToNumber(response.fallNummer, CONSTANTS.FALLNUMMER_LENGTH);\n                    this.familie = response.familienName;\n                    this.selectedUser = authService.getPrincipal().username;\n                } else {\n                    this.errorMessage = this.$translate.instant('FREIGABE_GESUCH_ALREADY_FREIGEGEBEN');\n                }\n            } else {\n                this.errorMessage = this.$translate.instant('FREIGABE_GESUCH_NOT_FOUND');\n            }\n        }).catch(() => {\n            this.cancel(); // close popup\n        });\n\n        this.updateUserList();\n\n    }\n\n\n    private updateUserList() {\n        this.userRS.getBenutzerJAorAdmin().then((response: any) => {\n            this.userList = angular.copy(response);\n        });\n    }\n\n    public isSchulamt(): boolean {\n        return this.gesuch ? this.gesuch.hasOnlySchulamtAngebote() : false;\n    }\n\n    public hasError(): boolean {\n        return this.errorMessage != null;\n    }\n\n    public hide(): IPromise<any> {\n        return this.gesuchRS.antragFreigeben(this.docID, this.selectedUser)\n            .then(() => {\n                return this.$mdDialog.hide();\n            });\n    }\n\n    public cancel(): void {\n        this.$mdDialog.cancel();\n    }\n\n}\n"]}]}