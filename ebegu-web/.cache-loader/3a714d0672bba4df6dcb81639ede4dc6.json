{"remainingRequest":"/home/imanol/projects/ebegu/ebegu-web/node_modules/thread-loader/dist/cjs.js??ref--0-1!/home/imanol/projects/ebegu/ebegu-web/node_modules/ts-loader/index.js??ref--0-2!/home/imanol/projects/ebegu/ebegu-web/src/gesuch/component/verfuegenView/verfuegenView.ts","cacheIdentifier":"cache-loader:1.1.0 test","dependencies":[{"path":"/home/imanol/projects/ebegu/ebegu-web/src/gesuch/component/verfuegenView/verfuegenView.ts","mtime":1515428423288},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/cache-loader/dist/cjs.js","mtime":1507514019000},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/thread-loader/dist/cjs.js","mtime":1507523420000},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/ts-loader/index.js","mtime":1508488471000}],"contextDependencies":[],"result":["\"use strict\";\n/*\n * Ki-Tax: System for the management of external childcare subsidies\n * Copyright (C) 2017 City of Bern Switzerland\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n */\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar abstractGesuchView_1 = require(\"../abstractGesuchView\");\nvar EbeguUtil_1 = require(\"../../../utils/EbeguUtil\");\nvar TSBetreuungsstatus_1 = require(\"../../../models/enums/TSBetreuungsstatus\");\nvar DateUtil_1 = require(\"../../../utils/DateUtil\");\nvar TSAntragStatus_1 = require(\"../../../models/enums/TSAntragStatus\");\nvar RemoveDialogController_1 = require(\"../../dialog/RemoveDialogController\");\nvar TSWizardStepName_1 = require(\"../../../models/enums/TSWizardStepName\");\nvar ThreeButtonsDialogController_1 = require(\"../../dialog/ThreeButtonsDialogController\");\nvar template = require('./verfuegenView.html');\nrequire('./verfuegenView.less');\nvar removeDialogTempl = require('../../dialog/removeDialogTemplate.html');\nvar threeButtonsDialogTempl = require('../../dialog/threeButtonsDialog.html');\nvar VerfuegenViewComponentConfig = /** @class */ (function () {\n    function VerfuegenViewComponentConfig() {\n        this.transclude = false;\n        this.template = template;\n        this.controller = VerfuegenViewController;\n        this.controllerAs = 'vm';\n    }\n    return VerfuegenViewComponentConfig;\n}());\nexports.VerfuegenViewComponentConfig = VerfuegenViewComponentConfig;\nvar VerfuegenViewController = /** @class */ (function (_super) {\n    __extends(VerfuegenViewController, _super);\n    /* @ngInject */\n    function VerfuegenViewController($state, gesuchModelManager, berechnungsManager, ebeguUtil, $scope, wizardStepManager, DvDialog, downloadRS, $log, $stateParams, $window, exportRS, applicationPropertyRS, $timeout) {\n        var _this = _super.call(this, gesuchModelManager, berechnungsManager, wizardStepManager, $scope, TSWizardStepName_1.TSWizardStepName.VERFUEGEN, $timeout) || this;\n        _this.$state = $state;\n        _this.ebeguUtil = ebeguUtil;\n        _this.DvDialog = DvDialog;\n        _this.downloadRS = downloadRS;\n        _this.$log = $log;\n        _this.$window = $window;\n        _this.exportRS = exportRS;\n        _this.applicationPropertyRS = applicationPropertyRS;\n        _this.verfuegungen = [];\n        var kindIndex = _this.gesuchModelManager.convertKindNumberToKindIndex(parseInt($stateParams.kindNumber, 10));\n        if (kindIndex === -1) {\n            _this.$log.error('Kind konnte nicht gefunden werden');\n        }\n        _this.gesuchModelManager.setKindIndex(kindIndex);\n        var betreuungIndex = _this.gesuchModelManager.convertBetreuungNumberToBetreuungIndex(parseInt($stateParams.betreuungNumber, 10));\n        if (betreuungIndex === -1) {\n            _this.$log.error('Betreuung konnte nicht gefunden werden');\n        }\n        _this.gesuchModelManager.setBetreuungIndex(betreuungIndex);\n        _this.wizardStepManager.setCurrentStep(TSWizardStepName_1.TSWizardStepName.VERFUEGEN);\n        _this.initView();\n        // EBEGE-741: Bemerkungen sollen automatisch zum Inhalt der Verfügung hinzugefügt werden\n        if ($scope) {\n            $scope.$watch(function () {\n                return _this.gesuchModelManager.getGesuch().bemerkungen;\n            }, function (newValue, oldValue) {\n                if ((newValue !== oldValue)) {\n                    _this.setBemerkungen();\n                }\n            });\n        }\n        return _this;\n    }\n    VerfuegenViewController.prototype.initView = function () {\n        var _this = this;\n        if (!this.gesuchModelManager.getVerfuegenToWorkWith()) {\n            this.gesuchModelManager.calculateVerfuegungen().then(function () {\n                _this.setBemerkungen();\n            });\n        }\n        else {\n            this.setBemerkungen();\n        }\n        //if finanzielleSituationResultate is undefined/empty (this may happen if user presses reloads this page) then we recalculate it\n        if (!this.berechnungsManager.finanzielleSituationResultate || angular.equals(this.berechnungsManager.finanzielleSituationResultate, {})) {\n            this.berechnungsManager.calculateFinanzielleSituation(this.gesuchModelManager.getGesuch());\n        }\n        if (this.gesuchModelManager.getGesuch() && this.gesuchModelManager.getGesuch().extractEinkommensverschlechterungInfo()\n            && this.gesuchModelManager.getGesuch().extractEinkommensverschlechterungInfo().ekvFuerBasisJahrPlus1\n            && (!this.berechnungsManager.einkommensverschlechterungResultateBjP1 || angular.equals(this.berechnungsManager.einkommensverschlechterungResultateBjP1, {}))) {\n            this.berechnungsManager.calculateEinkommensverschlechterung(this.gesuchModelManager.getGesuch(), 1); //.then(() => {});\n        }\n        if (this.gesuchModelManager.getGesuch() && this.gesuchModelManager.getGesuch().extractEinkommensverschlechterungInfo()\n            && this.gesuchModelManager.getGesuch().extractEinkommensverschlechterungInfo().ekvFuerBasisJahrPlus2\n            && (!this.berechnungsManager.einkommensverschlechterungResultateBjP2 || angular.equals(this.berechnungsManager.einkommensverschlechterungResultateBjP2, {}))) {\n            this.berechnungsManager.calculateEinkommensverschlechterung(this.gesuchModelManager.getGesuch(), 2); //.then(() => {});\n        }\n        this.initDevModeParameter();\n        // folgende Methoden werden hier aufgerufen, weil die Daten sich nicht aendern werden, waehrend man auf der Seite ist.\n        // Somit verbessern wir die Performance indem wir diese Daten ganz am Anfang berechnen und in einer Variable speichern\n        this.setSameVerfuegungsdaten();\n        this.setSameVerrechneteVerfuegungdaten();\n    };\n    VerfuegenViewController.prototype.initDevModeParameter = function () {\n        var _this = this;\n        this.applicationPropertyRS.isDevMode().then(function (response) {\n            // Schemas are only visible in devmode\n            _this.showSchemas = response;\n        });\n    };\n    VerfuegenViewController.prototype.cancel = function () {\n        this.form.$setPristine();\n    };\n    VerfuegenViewController.prototype.setSameVerfuegungsdaten = function () {\n        this.sameVerfuegungsdaten = false; // by default\n        if (this.getVerfuegenToWorkWith()) {\n            this.sameVerfuegungsdaten = this.getVerfuegenToWorkWith().areSameVerfuegungsdaten();\n        }\n    };\n    /**\n     * Checks whether all Abschnitte that are already paid, have the same value of the new abschnitte from\n     * the new verfuegung. Returns true if they are the same\n     */\n    VerfuegenViewController.prototype.setSameVerrechneteVerfuegungdaten = function () {\n        this.sameVerrechneteVerguenstigung = false; // by default\n        if (this.getVerfuegenToWorkWith()) {\n            this.sameVerrechneteVerguenstigung = this.getVerfuegenToWorkWith().isSameVerrechneteVerguenstigung();\n        }\n    };\n    VerfuegenViewController.prototype.isSameVerfuegungsdaten = function () {\n        return this.sameVerfuegungsdaten;\n    };\n    VerfuegenViewController.prototype.isSameVerrechneteVerguenstigung = function () {\n        return this.sameVerrechneteVerguenstigung;\n    };\n    VerfuegenViewController.prototype.save = function () {\n        var _this = this;\n        if (this.isGesuchValid()) {\n            // wenn Erstgesuch, not KITA oder die neue Verfuegung dieselben Daten hat, wird sie nur gespeichert\n            if (!this.getBetreuung().isAngebotKITA() || this.isSameVerrechneteVerguenstigung() || !this.isMutation()) {\n                this.saveVerfuegung().then(function () {\n                    _this.$state.go('gesuch.verfuegen', {\n                        gesuchId: _this.getGesuchId()\n                    });\n                });\n            }\n            else {\n                this.saveMutierteVerfuegung().then(function () {\n                    _this.$state.go('gesuch.verfuegen', {\n                        gesuchId: _this.getGesuchId()\n                    });\n                });\n            }\n        }\n    };\n    VerfuegenViewController.prototype.schliessenOhneVerfuegen = function () {\n        var _this = this;\n        if (this.isGesuchValid()) {\n            this.verfuegungSchliessenOhenVerfuegen().then(function () {\n                _this.$state.go('gesuch.verfuegen', {\n                    gesuchId: _this.getGesuchId()\n                });\n            });\n        }\n    };\n    VerfuegenViewController.prototype.nichtEintreten = function () {\n        var _this = this;\n        if (this.isGesuchValid()) {\n            this.verfuegungNichtEintreten().then(function () {\n                _this.$state.go('gesuch.verfuegen', {\n                    gesuchId: _this.getGesuchId()\n                });\n            });\n        }\n    };\n    VerfuegenViewController.prototype.getVerfuegenToWorkWith = function () {\n        if (this.gesuchModelManager) {\n            return this.gesuchModelManager.getVerfuegenToWorkWith();\n        }\n        return undefined;\n    };\n    VerfuegenViewController.prototype.getVerfuegungZeitabschnitte = function () {\n        if (this.getVerfuegenToWorkWith()) {\n            return this.getVerfuegenToWorkWith().zeitabschnitte;\n        }\n        return undefined;\n    };\n    VerfuegenViewController.prototype.getFall = function () {\n        if (this.gesuchModelManager && this.gesuchModelManager.getGesuch()) {\n            return this.gesuchModelManager.getGesuch().fall;\n        }\n        return undefined;\n    };\n    VerfuegenViewController.prototype.getGesuchsperiode = function () {\n        if (this.gesuchModelManager) {\n            return this.gesuchModelManager.getGesuchsperiode();\n        }\n        return undefined;\n    };\n    VerfuegenViewController.prototype.getBetreuung = function () {\n        return this.gesuchModelManager.getBetreuungToWorkWith();\n    };\n    VerfuegenViewController.prototype.getKindName = function () {\n        if (this.gesuchModelManager && this.gesuchModelManager.getKindToWorkWith() && this.gesuchModelManager.getKindToWorkWith().kindJA) {\n            return this.gesuchModelManager.getKindToWorkWith().kindJA.getFullName();\n        }\n        return undefined;\n    };\n    VerfuegenViewController.prototype.getInstitutionName = function () {\n        if (this.gesuchModelManager && this.getBetreuung() && this.getBetreuung().institutionStammdaten) {\n            return this.getBetreuung().institutionStammdaten.institution.name;\n        }\n        return undefined;\n    };\n    VerfuegenViewController.prototype.getBetreuungNumber = function () {\n        if (this.ebeguUtil && this.gesuchModelManager && this.gesuchModelManager.getKindToWorkWith() && this.gesuchModelManager.getBetreuungToWorkWith()) {\n            return this.ebeguUtil.calculateBetreuungsId(this.getGesuchsperiode(), this.getFall(), this.gesuchModelManager.getKindToWorkWith().kindNummer, this.getBetreuung().betreuungNummer);\n        }\n        return undefined;\n    };\n    VerfuegenViewController.prototype.getBetreuungsstatus = function () {\n        if (this.gesuchModelManager && this.gesuchModelManager.getBetreuungToWorkWith()) {\n            return this.getBetreuung().betreuungsstatus;\n        }\n        return undefined;\n    };\n    VerfuegenViewController.prototype.getAnfangsPeriode = function () {\n        if (this.ebeguUtil) {\n            return this.ebeguUtil.getFirstDayGesuchsperiodeAsString(this.gesuchModelManager.getGesuchsperiode());\n        }\n        return undefined;\n    };\n    VerfuegenViewController.prototype.getAnfangsVerschlechterung1 = function () {\n        if (this.gesuchModelManager && this.gesuchModelManager.getGesuch() && this.gesuchModelManager.getGesuch().extractEinkommensverschlechterungInfo()) {\n            return DateUtil_1.default.momentToLocalDateFormat(this.gesuchModelManager.getGesuch().extractEinkommensverschlechterungInfo().stichtagFuerBasisJahrPlus1, 'DD.MM.YYYY');\n        }\n        return undefined;\n    };\n    VerfuegenViewController.prototype.getAnfangsVerschlechterung2 = function () {\n        if (this.gesuchModelManager && this.gesuchModelManager.getGesuch() && this.gesuchModelManager.getGesuch().extractEinkommensverschlechterungInfo()) {\n            return DateUtil_1.default.momentToLocalDateFormat(this.gesuchModelManager.getGesuch().extractEinkommensverschlechterungInfo().stichtagFuerBasisJahrPlus2, 'DD.MM.YYYY');\n        }\n        return undefined;\n    };\n    /**\n     * Nur wenn das Gesuch im Status VERFUEGEN und die Betreuung im Status BESTAETIGT oder STORNIERT\n     * sind, kann der Benutzer das Angebot verfuegen. Sonst ist dieses nicht erlaubt.\n     * STORNIERT ist erlaubt weil die Kita verantwortlicher dafuer ist, die Betreuung in diesem Status zu setzen,\n     * d.h. die Betreuung hat bereits diesen Status wenn man auf den Step Verfuegung kommt\n     * @returns {boolean}\n     */\n    VerfuegenViewController.prototype.showVerfuegen = function () {\n        return this.gesuchModelManager.isGesuchStatus(TSAntragStatus_1.TSAntragStatus.VERFUEGEN)\n            && (TSBetreuungsstatus_1.TSBetreuungsstatus.BESTAETIGT === this.getBetreuungsstatus() || TSBetreuungsstatus_1.TSBetreuungsstatus.STORNIERT === this.getBetreuungsstatus());\n    };\n    VerfuegenViewController.prototype.saveVerfuegung = function () {\n        var _this = this;\n        return this.DvDialog.showDialog(removeDialogTempl, RemoveDialogController_1.RemoveDialogController, {\n            title: 'CONFIRM_SAVE_VERFUEGUNG',\n            deleteText: 'BESCHREIBUNG_SAVE_VERFUEGUNG',\n            parentController: undefined,\n            elementID: undefined\n        }).then(function () {\n            _this.getVerfuegenToWorkWith().manuelleBemerkungen = _this.bemerkungen;\n            return _this.gesuchModelManager.saveVerfuegung(false);\n        });\n    };\n    VerfuegenViewController.prototype.saveMutierteVerfuegung = function () {\n        var _this = this;\n        return this.DvDialog.showDialog(threeButtonsDialogTempl, ThreeButtonsDialogController_1.ThreeButtonsDialogController, {\n            title: 'CONFIRM_SAVE_MUTIERTE_VERFUEGUNG',\n            confirmationText: 'BESCHREIBUNG_SAVE_VERFUEGUNG',\n            cancelText: 'LABEL_NEIN',\n            firstOkText: 'CONFIRM_MUTIERTE_VERFUEGUNG_UEBERNEHMEN',\n            secondOkText: 'CONFIRM_MUTIERTE_VERFUEGUNG_IGNORIEREN'\n        }).then(function (response) {\n            _this.getVerfuegenToWorkWith().manuelleBemerkungen = _this.bemerkungen;\n            return _this.gesuchModelManager.saveVerfuegung(response === 2);\n        });\n    };\n    VerfuegenViewController.prototype.verfuegungSchliessenOhenVerfuegen = function () {\n        var _this = this;\n        return this.DvDialog.showDialog(removeDialogTempl, RemoveDialogController_1.RemoveDialogController, {\n            title: 'CONFIRM_CLOSE_VERFUEGUNG_OHNE_VERFUEGEN',\n            deleteText: 'BESCHREIBUNG_CLOSE_VERFUEGUNG_OHNE_VERFUEGEN',\n            parentController: undefined,\n            elementID: undefined\n        }).then(function () {\n            _this.getVerfuegenToWorkWith().manuelleBemerkungen = _this.bemerkungen;\n            _this.gesuchModelManager.verfuegungSchliessenOhenVerfuegen();\n        });\n    };\n    VerfuegenViewController.prototype.verfuegungNichtEintreten = function () {\n        var _this = this;\n        return this.DvDialog.showDialog(removeDialogTempl, RemoveDialogController_1.RemoveDialogController, {\n            title: 'CONFIRM_CLOSE_VERFUEGUNG_NICHT_EINTRETEN',\n            deleteText: 'BESCHREIBUNG_CLOSE_VERFUEGUNG_NICHT_EINTRETEN',\n            parentController: undefined,\n            elementID: undefined\n        }).then(function () {\n            _this.getVerfuegenToWorkWith().manuelleBemerkungen = _this.bemerkungen;\n            return _this.gesuchModelManager.verfuegungSchliessenNichtEintreten();\n        });\n    };\n    /**\n     * Die Bemerkungen sind immer die generierten, es sei denn das Angebot ist schon verfuegt\n     */\n    VerfuegenViewController.prototype.setBemerkungen = function () {\n        if (this.getBetreuung().betreuungsstatus === TSBetreuungsstatus_1.TSBetreuungsstatus.VERFUEGT ||\n            this.getBetreuung().betreuungsstatus === TSBetreuungsstatus_1.TSBetreuungsstatus.GESCHLOSSEN_OHNE_VERFUEGUNG) {\n            this.bemerkungen = this.getVerfuegenToWorkWith().manuelleBemerkungen;\n        }\n        else {\n            this.bemerkungen = '';\n            if (this.getVerfuegenToWorkWith().generatedBemerkungen && this.getVerfuegenToWorkWith().generatedBemerkungen.length > 0) {\n                this.bemerkungen = this.getVerfuegenToWorkWith().generatedBemerkungen + '\\n';\n            }\n            if (this.gesuchModelManager.getGesuch().bemerkungen) {\n                this.bemerkungen = this.bemerkungen + this.gesuchModelManager.getGesuch().bemerkungen;\n            }\n        }\n    };\n    VerfuegenViewController.prototype.isBemerkungenDisabled = function () {\n        return this.gesuchModelManager.getGesuch().status !== TSAntragStatus_1.TSAntragStatus.VERFUEGEN\n            || this.getBetreuung().betreuungsstatus === TSBetreuungsstatus_1.TSBetreuungsstatus.VERFUEGT\n            || this.getBetreuung().betreuungsstatus === TSBetreuungsstatus_1.TSBetreuungsstatus.GESCHLOSSEN_OHNE_VERFUEGUNG;\n    };\n    VerfuegenViewController.prototype.openVerfuegungPDF = function () {\n        var _this = this;\n        var win = this.downloadRS.prepareDownloadWindow();\n        this.downloadRS.getAccessTokenVerfuegungGeneratedDokument(this.gesuchModelManager.getGesuch().id, this.getBetreuung().id, false, this.bemerkungen)\n            .then(function (downloadFile) {\n            _this.$log.debug('accessToken: ' + downloadFile.accessToken);\n            _this.downloadRS.startDownload(downloadFile.accessToken, downloadFile.filename, false, win);\n        })\n            .catch(function (ex) {\n            win.close();\n            _this.$log.error('An error occurred downloading the document, closing download window.');\n        });\n    };\n    VerfuegenViewController.prototype.openExport = function () {\n        var _this = this;\n        var win = this.downloadRS.prepareDownloadWindow();\n        this.downloadRS.getDokumentAccessTokenVerfuegungExport(this.getBetreuung().id)\n            .then(function (downloadFile) {\n            _this.$log.debug('accessToken for export: ' + downloadFile.accessToken);\n            _this.downloadRS.startDownload(downloadFile.accessToken, downloadFile.filename, true, win);\n        })\n            .catch(function (ex) {\n            win.close();\n            _this.$log.error('An error occurred downloading the document, closing download window.');\n        });\n    };\n    VerfuegenViewController.prototype.openNichteintretenPDF = function () {\n        var _this = this;\n        var win = this.downloadRS.prepareDownloadWindow();\n        this.downloadRS.getAccessTokenNichteintretenGeneratedDokument(this.getBetreuung().id, false)\n            .then(function (downloadFile) {\n            _this.$log.debug('accessToken: ' + downloadFile.accessToken);\n            _this.downloadRS.startDownload(downloadFile.accessToken, downloadFile.filename, false, win);\n        })\n            .catch(function (ex) {\n            win.close();\n            _this.$log.error('An error occurred downloading the document, closing download window.');\n        });\n    };\n    VerfuegenViewController.prototype.showVerfuegungsDetails = function () {\n        return !this.isBetreuungInStatus(TSBetreuungsstatus_1.TSBetreuungsstatus.NICHT_EINGETRETEN);\n    };\n    VerfuegenViewController.prototype.showVerfuegungPdfLink = function () {\n        return !this.isBetreuungInStatus(TSBetreuungsstatus_1.TSBetreuungsstatus.NICHT_EINGETRETEN);\n    };\n    VerfuegenViewController.prototype.showExportLink = function () {\n        return this.isBetreuungInStatus(TSBetreuungsstatus_1.TSBetreuungsstatus.VERFUEGT);\n    };\n    VerfuegenViewController.prototype.exportJsonSchema = function () {\n        var win = this.$window.open('', EbeguUtil_1.default.generateRandomName(5));\n        this.exportRS.getJsonSchemaString().then(function (result) {\n            win.document.write('<body><pre>' + result + '</pre></body>');\n        });\n    };\n    VerfuegenViewController.prototype.exportXmlSchema = function () {\n        var _this = this;\n        // ACHTUNG popup blocker muss deaktiviert sein\n        this.exportRS.getXmlSchemaString().then(function (result) {\n            _this.$window.open('data:text/xml;charset=utf-8,' + result, '', '_blank');\n        });\n    };\n    VerfuegenViewController.prototype.showNichtEintretenPdfLink = function () {\n        var nichtVerfuegt = !this.isBetreuungInStatus(TSBetreuungsstatus_1.TSBetreuungsstatus.VERFUEGT);\n        var mutation = !this.gesuchModelManager.isGesuch();\n        var nichtNichteingetreten = !this.isBetreuungInStatus(TSBetreuungsstatus_1.TSBetreuungsstatus.NICHT_EINGETRETEN);\n        return nichtVerfuegt && !(mutation && nichtNichteingetreten);\n    };\n    VerfuegenViewController.prototype.disableAblehnen = function () {\n        // Der Button \"ABLEHNEN\" darf im Fall von \"STORNIERT\" nicht angezeigt werden\n        return this.isBetreuungInStatus(TSBetreuungsstatus_1.TSBetreuungsstatus.STORNIERT);\n    };\n    VerfuegenViewController.$inject = ['$state', 'GesuchModelManager', 'BerechnungsManager', 'EbeguUtil', '$scope', 'WizardStepManager',\n        'DvDialog', 'DownloadRS', '$log', '$stateParams', '$window', 'ExportRS', 'ApplicationPropertyRS', '$timeout'];\n    return VerfuegenViewController;\n}(abstractGesuchView_1.default));\nexports.VerfuegenViewController = VerfuegenViewController;\n",{"version":3,"file":"/home/imanol/projects/ebegu/ebegu-web/src/gesuch/component/verfuegenView/verfuegenView.ts","sourceRoot":"","sources":["/home/imanol/projects/ebegu/ebegu-web/src/gesuch/component/verfuegenView/verfuegenView.ts"],"names":[],"mappings":"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","sourcesContent":["/*\n * Ki-Tax: System for the management of external childcare subsidies\n * Copyright (C) 2017 City of Bern Switzerland\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport {IComponentOptions, ILogService, IPromise, IScope} from 'angular';\nimport AbstractGesuchViewController from '../abstractGesuchView';\nimport GesuchModelManager from '../../service/gesuchModelManager';\nimport {IStateService} from 'angular-ui-router';\nimport EbeguUtil from '../../../utils/EbeguUtil';\nimport {TSBetreuungsstatus} from '../../../models/enums/TSBetreuungsstatus';\nimport BerechnungsManager from '../../service/berechnungsManager';\nimport DateUtil from '../../../utils/DateUtil';\nimport TSVerfuegung from '../../../models/TSVerfuegung';\nimport TSVerfuegungZeitabschnitt from '../../../models/TSVerfuegungZeitabschnitt';\nimport WizardStepManager from '../../service/wizardStepManager';\nimport {TSAntragStatus} from '../../../models/enums/TSAntragStatus';\nimport {DvDialog} from '../../../core/directive/dv-dialog/dv-dialog';\nimport {RemoveDialogController} from '../../dialog/RemoveDialogController';\nimport {DownloadRS} from '../../../core/service/downloadRS.rest';\nimport TSDownloadFile from '../../../models/TSDownloadFile';\nimport TSBetreuung from '../../../models/TSBetreuung';\nimport {IBetreuungStateParams} from '../../gesuch.route';\nimport {TSWizardStepName} from '../../../models/enums/TSWizardStepName';\nimport ExportRS from '../../service/exportRS.rest';\nimport {ApplicationPropertyRS} from '../../../admin/service/applicationPropertyRS.rest';\nimport {ThreeButtonsDialogController} from '../../dialog/ThreeButtonsDialogController';\nimport ITimeoutService = angular.ITimeoutService;\n\nlet template = require('./verfuegenView.html');\nrequire('./verfuegenView.less');\nlet removeDialogTempl = require('../../dialog/removeDialogTemplate.html');\nlet threeButtonsDialogTempl = require('../../dialog/threeButtonsDialog.html');\n\nexport class VerfuegenViewComponentConfig implements IComponentOptions {\n    transclude = false;\n    template = template;\n    controller = VerfuegenViewController;\n    controllerAs = 'vm';\n}\n\nexport class VerfuegenViewController extends AbstractGesuchViewController<any> {\n\n    //this is the model...\n    public bemerkungen: string;\n\n    static $inject: string[] = ['$state', 'GesuchModelManager', 'BerechnungsManager', 'EbeguUtil', '$scope', 'WizardStepManager',\n        'DvDialog', 'DownloadRS', '$log', '$stateParams', '$window', 'ExportRS', 'ApplicationPropertyRS', '$timeout'];\n\n    private verfuegungen: TSVerfuegung[] = [];\n    private showSchemas: boolean;\n    private sameVerfuegungsdaten: boolean;\n    private sameVerrechneteVerguenstigung: boolean;\n\n    /* @ngInject */\n    constructor(private $state: IStateService, gesuchModelManager: GesuchModelManager, berechnungsManager: BerechnungsManager,\n                private ebeguUtil: EbeguUtil, $scope: IScope, wizardStepManager: WizardStepManager,\n                private DvDialog: DvDialog, private downloadRS: DownloadRS, private $log: ILogService, $stateParams: IBetreuungStateParams,\n                private $window: ng.IWindowService, private exportRS: ExportRS, private applicationPropertyRS: ApplicationPropertyRS,\n                $timeout: ITimeoutService) {\n\n        super(gesuchModelManager, berechnungsManager, wizardStepManager, $scope, TSWizardStepName.VERFUEGEN, $timeout);\n\n        let kindIndex: number = this.gesuchModelManager.convertKindNumberToKindIndex(parseInt($stateParams.kindNumber, 10));\n        if (kindIndex === -1) {\n            this.$log.error('Kind konnte nicht gefunden werden');\n        }\n        this.gesuchModelManager.setKindIndex(kindIndex);\n        let betreuungIndex: number = this.gesuchModelManager.convertBetreuungNumberToBetreuungIndex(parseInt($stateParams.betreuungNumber, 10));\n        if (betreuungIndex === -1) {\n            this.$log.error('Betreuung konnte nicht gefunden werden');\n        }\n        this.gesuchModelManager.setBetreuungIndex(betreuungIndex);\n        this.wizardStepManager.setCurrentStep(TSWizardStepName.VERFUEGEN);\n\n        this.initView();\n\n        // EBEGE-741: Bemerkungen sollen automatisch zum Inhalt der Verfügung hinzugefügt werden\n        if ($scope) {\n            $scope.$watch(() => {\n                return this.gesuchModelManager.getGesuch().bemerkungen;\n            }, (newValue, oldValue) => {\n                if ((newValue !== oldValue)) {\n                    this.setBemerkungen();\n                }\n            });\n        }\n    }\n\n    private initView() {\n        if (!this.gesuchModelManager.getVerfuegenToWorkWith()) {\n            this.gesuchModelManager.calculateVerfuegungen().then(() => {\n                this.setBemerkungen();\n            });\n        } else {\n            this.setBemerkungen();\n        }\n\n        //if finanzielleSituationResultate is undefined/empty (this may happen if user presses reloads this page) then we recalculate it\n        if (!this.berechnungsManager.finanzielleSituationResultate || angular.equals(this.berechnungsManager.finanzielleSituationResultate, {})) {\n            this.berechnungsManager.calculateFinanzielleSituation(this.gesuchModelManager.getGesuch());\n        }\n        if (this.gesuchModelManager.getGesuch() && this.gesuchModelManager.getGesuch().extractEinkommensverschlechterungInfo()\n            && this.gesuchModelManager.getGesuch().extractEinkommensverschlechterungInfo().ekvFuerBasisJahrPlus1\n            && (!this.berechnungsManager.einkommensverschlechterungResultateBjP1 || angular.equals(this.berechnungsManager.einkommensverschlechterungResultateBjP1, {}))) {\n\n            this.berechnungsManager.calculateEinkommensverschlechterung(this.gesuchModelManager.getGesuch(), 1); //.then(() => {});\n        }\n        if (this.gesuchModelManager.getGesuch() && this.gesuchModelManager.getGesuch().extractEinkommensverschlechterungInfo()\n            && this.gesuchModelManager.getGesuch().extractEinkommensverschlechterungInfo().ekvFuerBasisJahrPlus2\n            && (!this.berechnungsManager.einkommensverschlechterungResultateBjP2 || angular.equals(this.berechnungsManager.einkommensverschlechterungResultateBjP2, {}))) {\n\n            this.berechnungsManager.calculateEinkommensverschlechterung(this.gesuchModelManager.getGesuch(), 2); //.then(() => {});\n        }\n        this.initDevModeParameter();\n\n        // folgende Methoden werden hier aufgerufen, weil die Daten sich nicht aendern werden, waehrend man auf der Seite ist.\n        // Somit verbessern wir die Performance indem wir diese Daten ganz am Anfang berechnen und in einer Variable speichern\n        this.setSameVerfuegungsdaten();\n        this.setSameVerrechneteVerfuegungdaten();\n    }\n\n    private initDevModeParameter() {\n        this.applicationPropertyRS.isDevMode().then((response: boolean) => {\n            // Schemas are only visible in devmode\n            this.showSchemas = response;\n        });\n    }\n\n    public cancel(): void {\n        this.form.$setPristine();\n    }\n\n    private setSameVerfuegungsdaten(): void {\n        this.sameVerfuegungsdaten = false; // by default\n        if (this.getVerfuegenToWorkWith()) {\n            this.sameVerfuegungsdaten = this.getVerfuegenToWorkWith().areSameVerfuegungsdaten();\n        }\n    }\n\n    /**\n     * Checks whether all Abschnitte that are already paid, have the same value of the new abschnitte from\n     * the new verfuegung. Returns true if they are the same\n     */\n    private setSameVerrechneteVerfuegungdaten(): void {\n        this.sameVerrechneteVerguenstigung = false; // by default\n        if (this.getVerfuegenToWorkWith()) {\n            this.sameVerrechneteVerguenstigung = this.getVerfuegenToWorkWith().isSameVerrechneteVerguenstigung();\n        }\n    }\n\n    public isSameVerfuegungsdaten(): boolean {\n        return this.sameVerfuegungsdaten;\n    }\n\n    private isSameVerrechneteVerguenstigung(): boolean {\n        return this.sameVerrechneteVerguenstigung;\n    }\n\n    public save(): void {\n        if (this.isGesuchValid()) {\n            // wenn Erstgesuch, not KITA oder die neue Verfuegung dieselben Daten hat, wird sie nur gespeichert\n            if (!this.getBetreuung().isAngebotKITA() || this.isSameVerrechneteVerguenstigung() || !this.isMutation()) {\n                this.saveVerfuegung().then(() => {\n                    this.$state.go('gesuch.verfuegen', {\n                        gesuchId: this.getGesuchId()\n                    });\n                });\n            } else { // wenn Mutation, und die Verfuegung neue Daten hat, kann sie ignoriert oder uebernommen werden\n                this.saveMutierteVerfuegung().then(() => {\n                    this.$state.go('gesuch.verfuegen', {\n                        gesuchId: this.getGesuchId()\n                    });\n                });\n            }\n        }\n    }\n\n    public schliessenOhneVerfuegen() {\n        if (this.isGesuchValid()) {\n            this.verfuegungSchliessenOhenVerfuegen().then(() => {\n                this.$state.go('gesuch.verfuegen', {\n                    gesuchId: this.getGesuchId()\n                });\n            });\n        }\n    }\n\n    public nichtEintreten() {\n        if (this.isGesuchValid()) {\n            this.verfuegungNichtEintreten().then(() => {\n                this.$state.go('gesuch.verfuegen', {\n                    gesuchId: this.getGesuchId()\n                });\n            });\n        }\n    }\n\n    public getVerfuegenToWorkWith(): TSVerfuegung {\n        if (this.gesuchModelManager) {\n            return this.gesuchModelManager.getVerfuegenToWorkWith();\n        }\n        return undefined;\n    }\n\n    public getVerfuegungZeitabschnitte(): Array<TSVerfuegungZeitabschnitt> {\n        if (this.getVerfuegenToWorkWith()) {\n            return this.getVerfuegenToWorkWith().zeitabschnitte;\n        }\n        return undefined;\n    }\n\n    public getFall() {\n        if (this.gesuchModelManager && this.gesuchModelManager.getGesuch()) {\n            return this.gesuchModelManager.getGesuch().fall;\n        }\n        return undefined;\n    }\n\n    public getGesuchsperiode() {\n        if (this.gesuchModelManager) {\n            return this.gesuchModelManager.getGesuchsperiode();\n        }\n        return undefined;\n    }\n\n    public getBetreuung(): TSBetreuung {\n        return this.gesuchModelManager.getBetreuungToWorkWith();\n    }\n\n    public getKindName(): string {\n        if (this.gesuchModelManager && this.gesuchModelManager.getKindToWorkWith() && this.gesuchModelManager.getKindToWorkWith().kindJA) {\n            return this.gesuchModelManager.getKindToWorkWith().kindJA.getFullName();\n        }\n        return undefined;\n    }\n\n    public getInstitutionName(): string {\n        if (this.gesuchModelManager && this.getBetreuung() && this.getBetreuung().institutionStammdaten) {\n            return this.getBetreuung().institutionStammdaten.institution.name;\n        }\n        return undefined;\n    }\n\n    public getBetreuungNumber(): string {\n        if (this.ebeguUtil && this.gesuchModelManager && this.gesuchModelManager.getKindToWorkWith() && this.gesuchModelManager.getBetreuungToWorkWith()) {\n            return this.ebeguUtil.calculateBetreuungsId(this.getGesuchsperiode(), this.getFall(), this.gesuchModelManager.getKindToWorkWith().kindNummer,\n                this.getBetreuung().betreuungNummer);\n        }\n        return undefined;\n    }\n\n    public getBetreuungsstatus(): TSBetreuungsstatus {\n        if (this.gesuchModelManager && this.gesuchModelManager.getBetreuungToWorkWith()) {\n            return this.getBetreuung().betreuungsstatus;\n        }\n        return undefined;\n    }\n\n    public getAnfangsPeriode(): string {\n        if (this.ebeguUtil) {\n            return this.ebeguUtil.getFirstDayGesuchsperiodeAsString(this.gesuchModelManager.getGesuchsperiode());\n        }\n        return undefined;\n    }\n\n    public getAnfangsVerschlechterung1(): string {\n        if (this.gesuchModelManager && this.gesuchModelManager.getGesuch() && this.gesuchModelManager.getGesuch().extractEinkommensverschlechterungInfo()) {\n            return DateUtil.momentToLocalDateFormat(this.gesuchModelManager.getGesuch().extractEinkommensverschlechterungInfo().stichtagFuerBasisJahrPlus1, 'DD.MM.YYYY');\n        }\n        return undefined;\n    }\n\n    public getAnfangsVerschlechterung2(): string {\n        if (this.gesuchModelManager && this.gesuchModelManager.getGesuch() && this.gesuchModelManager.getGesuch().extractEinkommensverschlechterungInfo()) {\n            return DateUtil.momentToLocalDateFormat(this.gesuchModelManager.getGesuch().extractEinkommensverschlechterungInfo().stichtagFuerBasisJahrPlus2, 'DD.MM.YYYY');\n        }\n        return undefined;\n    }\n\n    /**\n     * Nur wenn das Gesuch im Status VERFUEGEN und die Betreuung im Status BESTAETIGT oder STORNIERT\n     * sind, kann der Benutzer das Angebot verfuegen. Sonst ist dieses nicht erlaubt.\n     * STORNIERT ist erlaubt weil die Kita verantwortlicher dafuer ist, die Betreuung in diesem Status zu setzen,\n     * d.h. die Betreuung hat bereits diesen Status wenn man auf den Step Verfuegung kommt\n     * @returns {boolean}\n     */\n    public showVerfuegen(): boolean {\n        return this.gesuchModelManager.isGesuchStatus(TSAntragStatus.VERFUEGEN)\n            && (TSBetreuungsstatus.BESTAETIGT === this.getBetreuungsstatus() || TSBetreuungsstatus.STORNIERT === this.getBetreuungsstatus());\n    }\n\n    public saveVerfuegung(): IPromise<TSVerfuegung> {\n        return this.DvDialog.showDialog(removeDialogTempl, RemoveDialogController, {\n            title: 'CONFIRM_SAVE_VERFUEGUNG',\n            deleteText: 'BESCHREIBUNG_SAVE_VERFUEGUNG',\n            parentController: undefined,\n            elementID: undefined\n        }).then(() => {\n            this.getVerfuegenToWorkWith().manuelleBemerkungen = this.bemerkungen;\n            return this.gesuchModelManager.saveVerfuegung(false);\n        });\n    }\n\n    public saveMutierteVerfuegung(): IPromise<TSVerfuegung> {\n        return this.DvDialog.showDialog(threeButtonsDialogTempl, ThreeButtonsDialogController, {\n            title: 'CONFIRM_SAVE_MUTIERTE_VERFUEGUNG',\n            confirmationText: 'BESCHREIBUNG_SAVE_VERFUEGUNG',\n            cancelText: 'LABEL_NEIN',\n            firstOkText: 'CONFIRM_MUTIERTE_VERFUEGUNG_UEBERNEHMEN',\n            secondOkText: 'CONFIRM_MUTIERTE_VERFUEGUNG_IGNORIEREN'\n        }).then((response) => {\n            this.getVerfuegenToWorkWith().manuelleBemerkungen = this.bemerkungen;\n            return this.gesuchModelManager.saveVerfuegung(response === 2);\n        });\n    }\n\n    public verfuegungSchliessenOhenVerfuegen(): IPromise<void> {\n        return this.DvDialog.showDialog(removeDialogTempl, RemoveDialogController, {\n            title: 'CONFIRM_CLOSE_VERFUEGUNG_OHNE_VERFUEGEN',\n            deleteText: 'BESCHREIBUNG_CLOSE_VERFUEGUNG_OHNE_VERFUEGEN',\n            parentController: undefined,\n            elementID: undefined\n        }).then(() => {\n            this.getVerfuegenToWorkWith().manuelleBemerkungen = this.bemerkungen;\n            this.gesuchModelManager.verfuegungSchliessenOhenVerfuegen();\n        });\n    }\n\n    public verfuegungNichtEintreten(): IPromise<TSVerfuegung> {\n        return this.DvDialog.showDialog(removeDialogTempl, RemoveDialogController, {\n            title: 'CONFIRM_CLOSE_VERFUEGUNG_NICHT_EINTRETEN',\n            deleteText: 'BESCHREIBUNG_CLOSE_VERFUEGUNG_NICHT_EINTRETEN',\n            parentController: undefined,\n            elementID: undefined\n        }).then(() => {\n            this.getVerfuegenToWorkWith().manuelleBemerkungen = this.bemerkungen;\n            return this.gesuchModelManager.verfuegungSchliessenNichtEintreten();\n        });\n    }\n\n    /**\n     * Die Bemerkungen sind immer die generierten, es sei denn das Angebot ist schon verfuegt\n     */\n    private setBemerkungen(): void {\n        if (this.getBetreuung().betreuungsstatus === TSBetreuungsstatus.VERFUEGT ||\n            this.getBetreuung().betreuungsstatus === TSBetreuungsstatus.GESCHLOSSEN_OHNE_VERFUEGUNG) {\n            this.bemerkungen = this.getVerfuegenToWorkWith().manuelleBemerkungen;\n        } else {\n            this.bemerkungen = '';\n            if (this.getVerfuegenToWorkWith().generatedBemerkungen && this.getVerfuegenToWorkWith().generatedBemerkungen.length > 0) {\n                this.bemerkungen = this.getVerfuegenToWorkWith().generatedBemerkungen + '\\n';\n            }\n            if (this.gesuchModelManager.getGesuch().bemerkungen) {\n                this.bemerkungen = this.bemerkungen + this.gesuchModelManager.getGesuch().bemerkungen;\n            }\n        }\n    }\n\n    public isBemerkungenDisabled(): boolean {\n        return this.gesuchModelManager.getGesuch().status !== TSAntragStatus.VERFUEGEN\n            || this.getBetreuung().betreuungsstatus === TSBetreuungsstatus.VERFUEGT\n            || this.getBetreuung().betreuungsstatus === TSBetreuungsstatus.GESCHLOSSEN_OHNE_VERFUEGUNG;\n    }\n\n    public openVerfuegungPDF(): void {\n        let win: Window = this.downloadRS.prepareDownloadWindow();\n        this.downloadRS.getAccessTokenVerfuegungGeneratedDokument(this.gesuchModelManager.getGesuch().id,\n            this.getBetreuung().id, false, this.bemerkungen)\n            .then((downloadFile: TSDownloadFile) => {\n                this.$log.debug('accessToken: ' + downloadFile.accessToken);\n                this.downloadRS.startDownload(downloadFile.accessToken, downloadFile.filename, false, win);\n            })\n            .catch((ex) => {\n                win.close();\n                this.$log.error('An error occurred downloading the document, closing download window.');\n            });\n    }\n\n    public openExport(): void {\n        let win: Window = this.downloadRS.prepareDownloadWindow();\n        this.downloadRS.getDokumentAccessTokenVerfuegungExport(this.getBetreuung().id)\n            .then((downloadFile: TSDownloadFile) => {\n                this.$log.debug('accessToken for export: ' + downloadFile.accessToken);\n                this.downloadRS.startDownload(downloadFile.accessToken, downloadFile.filename, true, win);\n            })\n            .catch((ex) => {\n                win.close();\n                this.$log.error('An error occurred downloading the document, closing download window.');\n            });\n    }\n\n    public openNichteintretenPDF(): void {\n        let win: Window = this.downloadRS.prepareDownloadWindow();\n        this.downloadRS.getAccessTokenNichteintretenGeneratedDokument(this.getBetreuung().id, false)\n            .then((downloadFile: TSDownloadFile) => {\n                this.$log.debug('accessToken: ' + downloadFile.accessToken);\n                this.downloadRS.startDownload(downloadFile.accessToken, downloadFile.filename, false, win);\n            })\n            .catch((ex) => {\n                win.close();\n                this.$log.error('An error occurred downloading the document, closing download window.');\n            });\n    }\n\n    public showVerfuegungsDetails(): boolean {\n        return !this.isBetreuungInStatus(TSBetreuungsstatus.NICHT_EINGETRETEN);\n    }\n\n    public showVerfuegungPdfLink(): boolean {\n        return !this.isBetreuungInStatus(TSBetreuungsstatus.NICHT_EINGETRETEN);\n    }\n\n    public showExportLink(): boolean {\n        return this.isBetreuungInStatus(TSBetreuungsstatus.VERFUEGT);\n    }\n\n    public exportJsonSchema() {\n        let win: Window = this.$window.open('', EbeguUtil.generateRandomName(5));\n        this.exportRS.getJsonSchemaString().then((result) => {\n            win.document.write('<body><pre>' + result + '</pre></body>');\n        });\n    }\n\n    public exportXmlSchema() {\n        // ACHTUNG popup blocker muss deaktiviert sein\n        this.exportRS.getXmlSchemaString().then((result) => {\n            this.$window.open('data:text/xml;charset=utf-8,' + result, '', '_blank');\n        });\n    }\n\n    public showNichtEintretenPdfLink(): boolean {\n        let nichtVerfuegt = !this.isBetreuungInStatus(TSBetreuungsstatus.VERFUEGT);\n        let mutation = !this.gesuchModelManager.isGesuch();\n        let nichtNichteingetreten = !this.isBetreuungInStatus(TSBetreuungsstatus.NICHT_EINGETRETEN);\n        return nichtVerfuegt && !(mutation && nichtNichteingetreten);\n    }\n\n    public disableAblehnen(): boolean {\n        // Der Button \"ABLEHNEN\" darf im Fall von \"STORNIERT\" nicht angezeigt werden\n        return this.isBetreuungInStatus(TSBetreuungsstatus.STORNIERT);\n    }\n}\n"]}]}