{"remainingRequest":"/home/imanol/projects/ebegu/ebegu-web/node_modules/thread-loader/dist/cjs.js??ref--0-1!/home/imanol/projects/ebegu/ebegu-web/node_modules/ts-loader/index.js??ref--0-2!/home/imanol/projects/ebegu/ebegu-web/src/alleVerfuegungen/component/alleVerfuegungenView/alleVerfuegungenView.ts","cacheIdentifier":"cache-loader:1.1.0 test","dependencies":[{"path":"/home/imanol/projects/ebegu/ebegu-web/src/alleVerfuegungen/component/alleVerfuegungenView/alleVerfuegungenView.ts","mtime":1512484411995},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/cache-loader/dist/cjs.js","mtime":1507514019000},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/thread-loader/dist/cjs.js","mtime":1507523420000},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/ts-loader/index.js","mtime":1508488471000}],"contextDependencies":[],"result":["\"use strict\";\n/*\n * Ki-Tax: System for the management of external childcare subsidies\n * Copyright (C) 2017 City of Bern Switzerland\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar TSRoleUtil_1 = require(\"../../../utils/TSRoleUtil\");\nvar TSBetreuungsstatus_1 = require(\"../../../models/enums/TSBetreuungsstatus\");\nvar EbeguUtil_1 = require(\"../../../utils/EbeguUtil\");\nvar template = require('./alleVerfuegungenView.html');\nrequire('./alleVerfuegungenView.less');\nvar AlleVerfuegungenViewComponentConfig = /** @class */ (function () {\n    function AlleVerfuegungenViewComponentConfig() {\n        this.transclude = false;\n        this.template = template;\n        this.controller = AlleVerfuegungenViewController;\n        this.controllerAs = 'vm';\n    }\n    return AlleVerfuegungenViewComponentConfig;\n}());\nexports.AlleVerfuegungenViewComponentConfig = AlleVerfuegungenViewComponentConfig;\nvar AlleVerfuegungenViewController = /** @class */ (function () {\n    /* @ngInject */\n    function AlleVerfuegungenViewController($state, $stateParams, authServiceRS, fallRS, ebeguUtil, betreuungRS, gesuchModelManager, downloadRS, $log, $timeout) {\n        this.$state = $state;\n        this.$stateParams = $stateParams;\n        this.authServiceRS = authServiceRS;\n        this.fallRS = fallRS;\n        this.ebeguUtil = ebeguUtil;\n        this.betreuungRS = betreuungRS;\n        this.gesuchModelManager = gesuchModelManager;\n        this.downloadRS = downloadRS;\n        this.$log = $log;\n        this.$timeout = $timeout;\n        this.alleVerfuegungen = [];\n        this.itemsByPage = 20;\n        this.TSRoleUtil = TSRoleUtil_1.TSRoleUtil;\n    }\n    AlleVerfuegungenViewController.prototype.$onInit = function () {\n        var _this = this;\n        if (this.$stateParams.fallId) {\n            this.fallRS.findFall(this.$stateParams.fallId).then(function (response) {\n                _this.fall = response;\n                if (_this.fall === undefined) {\n                    _this.cancel();\n                }\n                _this.betreuungRS.findAllBetreuungenWithVerfuegungFromFall(_this.fall.id).then(function (response) {\n                    response.forEach(function (item) {\n                        _this.alleVerfuegungen.push(item);\n                    });\n                    _this.alleVerfuegungen = response;\n                });\n            });\n        }\n        else {\n            this.cancel();\n        }\n    };\n    AlleVerfuegungenViewController.prototype.getAlleVerfuegungen = function () {\n        return this.alleVerfuegungen;\n    };\n    AlleVerfuegungenViewController.prototype.openVerfuegung = function (betreuungNummer, kindNummer, gesuchId) {\n        if (betreuungNummer && kindNummer && gesuchId) {\n            this.$state.go('gesuch.verfuegenView', {\n                betreuungNumber: betreuungNummer,\n                kindNumber: kindNummer,\n                gesuchId: gesuchId\n            });\n        }\n    };\n    AlleVerfuegungenViewController.prototype.cancel = function () {\n        if (this.authServiceRS.isOneOfRoles(this.TSRoleUtil.getGesuchstellerOnlyRoles())) {\n            this.$state.go('gesuchstellerDashboard');\n        }\n        else {\n            this.$state.go('pendenzen');\n        }\n    };\n    AlleVerfuegungenViewController.prototype.showVerfuegungPdfLink = function (betreuung) {\n        return !(TSBetreuungsstatus_1.TSBetreuungsstatus.NICHT_EINGETRETEN === betreuung.betreuungsstatus);\n    };\n    AlleVerfuegungenViewController.prototype.openVerfuegungPDF = function (betreuung) {\n        var _this = this;\n        var win = this.downloadRS.prepareDownloadWindow();\n        this.downloadRS.getAccessTokenVerfuegungGeneratedDokument(betreuung.gesuchId, betreuung.id, false, '')\n            .then(function (downloadFile) {\n            _this.$log.debug('accessToken: ' + downloadFile.accessToken);\n            _this.downloadRS.startDownload(downloadFile.accessToken, downloadFile.filename, false, win);\n        })\n            .catch(function (ex) {\n            win.close();\n            _this.$log.error('An error occurred downloading the document, closing download window.');\n        });\n    };\n    AlleVerfuegungenViewController.prototype.openNichteintretenPDF = function (betreuung) {\n        var _this = this;\n        var win = this.downloadRS.prepareDownloadWindow();\n        this.downloadRS.getAccessTokenNichteintretenGeneratedDokument(betreuung.id, false)\n            .then(function (downloadFile) {\n            _this.$log.debug('accessToken: ' + downloadFile.accessToken);\n            _this.downloadRS.startDownload(downloadFile.accessToken, downloadFile.filename, false, win);\n        })\n            .catch(function (ex) {\n            win.close();\n            _this.$log.error('An error occurred downloading the document, closing download window.');\n        });\n    };\n    AlleVerfuegungenViewController.prototype.$postLink = function () {\n        this.$timeout(function () {\n            EbeguUtil_1.default.selectFirst();\n        }, 500); // this is the only way because it needs a little until everything is loaded\n    };\n    AlleVerfuegungenViewController.$inject = ['$state', '$stateParams', 'AuthServiceRS', 'FallRS', 'EbeguUtil', 'BetreuungRS',\n        'GesuchModelManager', 'DownloadRS', '$log', '$timeout'];\n    return AlleVerfuegungenViewController;\n}());\nexports.AlleVerfuegungenViewController = AlleVerfuegungenViewController;\n",{"version":3,"file":"/home/imanol/projects/ebegu/ebegu-web/src/alleVerfuegungen/component/alleVerfuegungenView/alleVerfuegungenView.ts","sourceRoot":"","sources":["/home/imanol/projects/ebegu/ebegu-web/src/alleVerfuegungen/component/alleVerfuegungenView/alleVerfuegungenView.ts"],"names":[],"mappings":"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","sourcesContent":["/*\n * Ki-Tax: System for the management of external childcare subsidies\n * Copyright (C) 2017 City of Bern Switzerland\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport IComponentOptions = angular.IComponentOptions;\nimport IStateService = angular.ui.IStateService;\nimport ITimeoutService = angular.ITimeoutService;\nimport ILogService = angular.ILogService;\nimport TSFall from '../../../models/TSFall';\nimport AuthServiceRS from '../../../authentication/service/AuthServiceRS.rest';\nimport {TSRoleUtil} from '../../../utils/TSRoleUtil';\nimport TSAntragStatusHistory from '../../../models/TSAntragStatusHistory';\nimport {IAlleVerfuegungenStateParams} from '../../alleVerfuegungen.route';\nimport FallRS from '../../../gesuch/service/fallRS.rest';\nimport TSBetreuung from '../../../models/TSBetreuung';\nimport BetreuungRS from '../../../core/service/betreuungRS.rest';\nimport GesuchModelManager from '../../../gesuch/service/gesuchModelManager';\nimport {TSBetreuungsstatus} from '../../../models/enums/TSBetreuungsstatus';\nimport TSDownloadFile from '../../../models/TSDownloadFile';\nimport {DownloadRS} from '../../../core/service/downloadRS.rest';\nimport EbeguUtil from '../../../utils/EbeguUtil';\n\nlet template = require('./alleVerfuegungenView.html');\nrequire('./alleVerfuegungenView.less');\n\nexport class AlleVerfuegungenViewComponentConfig implements IComponentOptions {\n    transclude = false;\n    template = template;\n    controller = AlleVerfuegungenViewController;\n    controllerAs = 'vm';\n}\n\nexport class AlleVerfuegungenViewController {\n\n    fall: TSFall;\n    alleVerfuegungen: Array<any> = [];\n    itemsByPage: number = 20;\n    TSRoleUtil = TSRoleUtil;\n\n    static $inject: string[] = ['$state', '$stateParams', 'AuthServiceRS', 'FallRS', 'EbeguUtil', 'BetreuungRS',\n        'GesuchModelManager', 'DownloadRS', '$log', '$timeout'];\n\n    /* @ngInject */\n    constructor(private $state: IStateService, private $stateParams: IAlleVerfuegungenStateParams,\n                private authServiceRS: AuthServiceRS, private fallRS: FallRS, private ebeguUtil: EbeguUtil,\n                private betreuungRS: BetreuungRS, private gesuchModelManager: GesuchModelManager,\n                private downloadRS: DownloadRS, private $log: ILogService, private $timeout: ITimeoutService) {\n    }\n\n    $onInit() {\n        if (this.$stateParams.fallId) {\n            this.fallRS.findFall(this.$stateParams.fallId).then((response) => {\n                this.fall = response;\n                if (this.fall === undefined) {\n                    this.cancel();\n                }\n\n                this.betreuungRS.findAllBetreuungenWithVerfuegungFromFall(this.fall.id).then((response) => {\n                    response.forEach((item) => {\n                        this.alleVerfuegungen.push(item);\n                    });\n                    this.alleVerfuegungen = response;\n                });\n            });\n        } else {\n            this.cancel();\n        }\n    }\n\n    public getAlleVerfuegungen(): Array<TSAntragStatusHistory> {\n        return this.alleVerfuegungen;\n    }\n\n    public openVerfuegung(betreuungNummer: string, kindNummer: number, gesuchId: string): void {\n        if (betreuungNummer && kindNummer && gesuchId) {\n            this.$state.go('gesuch.verfuegenView', {\n                betreuungNumber: betreuungNummer,\n                kindNumber: kindNummer,\n                gesuchId: gesuchId\n            });\n        }\n    }\n\n    public cancel(): void {\n        if (this.authServiceRS.isOneOfRoles(this.TSRoleUtil.getGesuchstellerOnlyRoles())) {\n            this.$state.go('gesuchstellerDashboard');\n        } else {\n            this.$state.go('pendenzen');\n        }\n    }\n\n    public showVerfuegungPdfLink(betreuung: TSBetreuung): boolean {\n        return !(TSBetreuungsstatus.NICHT_EINGETRETEN === betreuung.betreuungsstatus);\n    }\n\n    public openVerfuegungPDF(betreuung: TSBetreuung): void {\n        let win: Window = this.downloadRS.prepareDownloadWindow();\n        this.downloadRS.getAccessTokenVerfuegungGeneratedDokument(betreuung.gesuchId,\n            betreuung.id, false, '')\n            .then((downloadFile: TSDownloadFile) => {\n                this.$log.debug('accessToken: ' + downloadFile.accessToken);\n                this.downloadRS.startDownload(downloadFile.accessToken, downloadFile.filename, false, win);\n            })\n            .catch((ex) => {\n                win.close();\n                this.$log.error('An error occurred downloading the document, closing download window.');\n            });\n    }\n\n    public openNichteintretenPDF(betreuung: TSBetreuung): void {\n        let win: Window = this.downloadRS.prepareDownloadWindow();\n        this.downloadRS.getAccessTokenNichteintretenGeneratedDokument(betreuung.id, false)\n            .then((downloadFile: TSDownloadFile) => {\n                this.$log.debug('accessToken: ' + downloadFile.accessToken);\n                this.downloadRS.startDownload(downloadFile.accessToken, downloadFile.filename, false, win);\n            })\n            .catch((ex) => {\n                win.close();\n                this.$log.error('An error occurred downloading the document, closing download window.');\n            });\n    }\n\n    $postLink() {\n        this.$timeout(() => {\n            EbeguUtil.selectFirst();\n        }, 500); // this is the only way because it needs a little until everything is loaded\n    }\n}\n"]}]}