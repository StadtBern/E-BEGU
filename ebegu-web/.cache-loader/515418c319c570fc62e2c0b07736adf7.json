{"remainingRequest":"/home/imanol/projects/ebegu/ebegu-web/node_modules/thread-loader/dist/cjs.js??ref--0-1!/home/imanol/projects/ebegu/ebegu-web/node_modules/ts-loader/index.js??ref--0-2!/home/imanol/projects/ebegu/ebegu-web/src/pendenzenInstitution/component/pendenzenInstitutionListView/pendenzenInstitutionListView.ts","cacheIdentifier":"cache-loader:1.1.0 test","dependencies":[{"path":"/home/imanol/projects/ebegu/ebegu-web/src/pendenzenInstitution/component/pendenzenInstitutionListView/pendenzenInstitutionListView.ts","mtime":1518535855236},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/cache-loader/dist/cjs.js","mtime":1507514019000},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/thread-loader/dist/cjs.js","mtime":1507523420000},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/ts-loader/index.js","mtime":1508488471000}],"contextDependencies":[],"result":["/*\n * Ki-Tax: System for the management of external childcare subsidies\n * Copyright (C) 2017 City of Bern Switzerland\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n */\ndefine([\"require\", \"exports\"], function (require, exports) {\n    \"use strict\";\n    Object.defineProperty(exports, \"__esModule\", { value: true });\n    var template = require('./pendenzenInstitutionListView.html');\n    require('./pendenzenInstitutionListView.less');\n    var PendenzenInstitutionListViewComponentConfig = /** @class */ (function () {\n        function PendenzenInstitutionListViewComponentConfig() {\n            this.transclude = false;\n            this.template = template;\n            this.controller = PendenzenInstitutionListViewController;\n            this.controllerAs = 'vm';\n        }\n        return PendenzenInstitutionListViewComponentConfig;\n    }());\n    exports.PendenzenInstitutionListViewComponentConfig = PendenzenInstitutionListViewComponentConfig;\n    var PendenzenInstitutionListViewController = /** @class */ (function () {\n        function PendenzenInstitutionListViewController(pendenzInstitutionRS, ebeguUtil, institutionRS, institutionStammdatenRS, gesuchsperiodeRS, gesuchModelManager, berechnungsManager, $state) {\n            this.pendenzInstitutionRS = pendenzInstitutionRS;\n            this.ebeguUtil = ebeguUtil;\n            this.institutionRS = institutionRS;\n            this.institutionStammdatenRS = institutionStammdatenRS;\n            this.gesuchsperiodeRS = gesuchsperiodeRS;\n            this.gesuchModelManager = gesuchModelManager;\n            this.berechnungsManager = berechnungsManager;\n            this.$state = $state;\n            this.activeGesuchsperiodenList = [];\n            this.itemsByPage = 20;\n            this.numberOfPages = 1;\n        }\n        PendenzenInstitutionListViewController.prototype.$onInit = function () {\n            this.updatePendenzenList();\n            this.updateInstitutionenList();\n            this.updateBetreuungsangebotTypList();\n            this.updateActiveGesuchsperiodenList();\n        };\n        PendenzenInstitutionListViewController.prototype.getTotalResultCount = function () {\n            if (this.pendenzenList && this.pendenzenList.length) {\n                return this.pendenzenList.length;\n            }\n            return 0;\n        };\n        PendenzenInstitutionListViewController.prototype.updatePendenzenList = function () {\n            var _this = this;\n            this.pendenzInstitutionRS.getPendenzenList().then(function (response) {\n                _this.pendenzenList = angular.copy(response);\n                _this.numberOfPages = _this.pendenzenList.length / _this.itemsByPage;\n            });\n        };\n        PendenzenInstitutionListViewController.prototype.updateActiveGesuchsperiodenList = function () {\n            var _this = this;\n            this.gesuchsperiodeRS.getAllNichtAbgeschlosseneGesuchsperioden().then(function (response) {\n                _this.extractGesuchsperiodeStringList(response);\n            });\n        };\n        PendenzenInstitutionListViewController.prototype.extractGesuchsperiodeStringList = function (allActiveGesuchsperioden) {\n            var _this = this;\n            allActiveGesuchsperioden.forEach(function (gesuchsperiode) {\n                _this.activeGesuchsperiodenList.push(gesuchsperiode.gesuchsperiodeString);\n            });\n        };\n        PendenzenInstitutionListViewController.prototype.updateInstitutionenList = function () {\n            var _this = this;\n            this.institutionRS.getInstitutionenForCurrentBenutzer().then(function (response) {\n                _this.institutionenList = angular.copy(response);\n            });\n        };\n        PendenzenInstitutionListViewController.prototype.updateBetreuungsangebotTypList = function () {\n            var _this = this;\n            this.institutionStammdatenRS.getBetreuungsangeboteForInstitutionenOfCurrentBenutzer().then(function (response) {\n                _this.betreuungsangebotTypList = angular.copy(response);\n            });\n        };\n        PendenzenInstitutionListViewController.prototype.getPendenzenList = function () {\n            return this.pendenzenList;\n        };\n        PendenzenInstitutionListViewController.prototype.editPendenzInstitution = function (pendenz, event) {\n            if (pendenz) {\n                var isCtrlKeyPressed = (event && event.ctrlKey);\n                this.openBetreuung(pendenz, isCtrlKeyPressed);\n            }\n        };\n        PendenzenInstitutionListViewController.prototype.openBetreuung = function (pendenz, isCtrlKeyPressed) {\n            var numberParts = this.ebeguUtil.splitBetreuungsnummer(pendenz.betreuungsNummer);\n            if (numberParts && pendenz) {\n                var kindNumber = parseInt(numberParts.kindnummer);\n                var betreuungNumber = parseInt(numberParts.betreuungsnummer);\n                if (betreuungNumber > 0) {\n                    this.berechnungsManager.clear(); // nur um sicher zu gehen, dass alle alte Werte geloescht sind\n                    // Reload Gesuch in gesuchModelManager on Init in fallCreationView because it has been changed since last time\n                    this.gesuchModelManager.clearGesuch();\n                    var navObj = {\n                        betreuungNumber: betreuungNumber,\n                        kindNumber: kindNumber,\n                        gesuchId: pendenz.gesuchId\n                    };\n                    if (isCtrlKeyPressed) {\n                        var url = this.$state.href('gesuch.betreuung', navObj);\n                        window.open(url, '_blank');\n                    }\n                    else {\n                        this.$state.go('gesuch.betreuung', navObj);\n                    }\n                }\n            }\n        };\n        PendenzenInstitutionListViewController.$inject = ['PendenzInstitutionRS', 'EbeguUtil', 'InstitutionRS', 'InstitutionStammdatenRS', 'GesuchsperiodeRS',\n            'GesuchModelManager', 'BerechnungsManager', '$state'];\n        return PendenzenInstitutionListViewController;\n    }());\n    exports.PendenzenInstitutionListViewController = PendenzenInstitutionListViewController;\n});\n",{"version":3,"file":"/home/imanol/projects/ebegu/ebegu-web/src/pendenzenInstitution/component/pendenzenInstitutionListView/pendenzenInstitutionListView.ts","sourceRoot":"","sources":["/home/imanol/projects/ebegu/ebegu-web/src/pendenzenInstitution/component/pendenzenInstitutionListView/pendenzenInstitutionListView.ts"],"names":[],"mappings":"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","sourcesContent":["/*\n * Ki-Tax: System for the management of external childcare subsidies\n * Copyright (C) 2017 City of Bern Switzerland\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport {IComponentOptions} from 'angular';\nimport TSPendenzInstitution from '../../../models/TSPendenzInstitution';\nimport TSGesuchsperiode from '../../../models/TSGesuchsperiode';\nimport EbeguUtil from '../../../utils/EbeguUtil';\nimport {TSBetreuungsangebotTyp} from '../../../models/enums/TSBetreuungsangebotTyp';\nimport TSInstitution from '../../../models/TSInstitution';\nimport {InstitutionRS} from '../../../core/service/institutionRS.rest';\nimport GesuchsperiodeRS from '../../../core/service/gesuchsperiodeRS.rest';\nimport GesuchModelManager from '../../../gesuch/service/gesuchModelManager';\nimport {IStateService} from 'angular-ui-router';\nimport BerechnungsManager from '../../../gesuch/service/berechnungsManager';\nimport PendenzInstitutionRS from '../../service/PendenzInstitutionRS.rest';\nimport {InstitutionStammdatenRS} from '../../../core/service/institutionStammdatenRS.rest';\nimport TSBetreuungsnummerParts from '../../../models/dto/TSBetreuungsnummerParts';\nlet template = require('./pendenzenInstitutionListView.html');\nrequire('./pendenzenInstitutionListView.less');\n\nexport class PendenzenInstitutionListViewComponentConfig implements IComponentOptions {\n    transclude = false;\n    template = template;\n    controller = PendenzenInstitutionListViewController;\n    controllerAs = 'vm';\n}\n\nexport class PendenzenInstitutionListViewController {\n\n    private pendenzenList: Array<TSPendenzInstitution>;\n    selectedBetreuungsangebotTyp: string;\n    selectedInstitution: string;\n    selectedGesuchsperiode: string;\n    institutionenList: Array<TSInstitution>;\n    betreuungsangebotTypList: Array<TSBetreuungsangebotTyp>;\n    activeGesuchsperiodenList: Array<string> = [];\n    itemsByPage: number = 20;\n    numberOfPages: number = 1;\n\n\n    static $inject: string[] = ['PendenzInstitutionRS', 'EbeguUtil', 'InstitutionRS', 'InstitutionStammdatenRS', 'GesuchsperiodeRS',\n        'GesuchModelManager', 'BerechnungsManager', '$state'];\n\n    constructor(public pendenzInstitutionRS: PendenzInstitutionRS, private ebeguUtil: EbeguUtil, private institutionRS: InstitutionRS,\n                private institutionStammdatenRS: InstitutionStammdatenRS, private gesuchsperiodeRS: GesuchsperiodeRS,\n                private gesuchModelManager: GesuchModelManager, private berechnungsManager: BerechnungsManager,\n                private $state: IStateService) {\n    }\n\n    $onInit() {\n        this.updatePendenzenList();\n        this.updateInstitutionenList();\n        this.updateBetreuungsangebotTypList();\n        this.updateActiveGesuchsperiodenList();\n    }\n\n    private getTotalResultCount(): number {\n        if (this.pendenzenList && this.pendenzenList.length) {\n            return this.pendenzenList.length;\n        }\n        return 0;\n    }\n\n    private updatePendenzenList() {\n        this.pendenzInstitutionRS.getPendenzenList().then((response: any) => {\n            this.pendenzenList = angular.copy(response);\n            this.numberOfPages = this.pendenzenList.length / this.itemsByPage;\n        });\n    }\n\n    public updateActiveGesuchsperiodenList(): void {\n        this.gesuchsperiodeRS.getAllNichtAbgeschlosseneGesuchsperioden().then((response: TSGesuchsperiode[]) => {\n            this.extractGesuchsperiodeStringList(response);\n        });\n    }\n\n    private extractGesuchsperiodeStringList(allActiveGesuchsperioden: TSGesuchsperiode[]) {\n        allActiveGesuchsperioden.forEach((gesuchsperiode: TSGesuchsperiode) => {\n            this.activeGesuchsperiodenList.push(gesuchsperiode.gesuchsperiodeString);\n        });\n    }\n\n    public updateInstitutionenList(): void {\n        this.institutionRS.getInstitutionenForCurrentBenutzer().then((response: any) => {\n            this.institutionenList = angular.copy(response);\n        });\n    }\n\n    public updateBetreuungsangebotTypList(): void {\n        this.institutionStammdatenRS.getBetreuungsangeboteForInstitutionenOfCurrentBenutzer().then((response: any) => {\n            this.betreuungsangebotTypList = angular.copy(response);\n        });\n    }\n\n    public getPendenzenList(): Array<TSPendenzInstitution> {\n        return this.pendenzenList;\n    }\n\n    public editPendenzInstitution(pendenz: TSPendenzInstitution, event: any): void {\n        if (pendenz) {\n            let isCtrlKeyPressed: boolean = (event && event.ctrlKey);\n            this.openBetreuung(pendenz, isCtrlKeyPressed);\n        }\n    }\n\n    private openBetreuung(pendenz: TSPendenzInstitution, isCtrlKeyPressed: boolean): void {\n        let numberParts: TSBetreuungsnummerParts = this.ebeguUtil.splitBetreuungsnummer(pendenz.betreuungsNummer);\n        if (numberParts && pendenz) {\n            let kindNumber: number = parseInt(numberParts.kindnummer);\n            let betreuungNumber: number = parseInt(numberParts.betreuungsnummer);\n            if (betreuungNumber > 0) {\n                this.berechnungsManager.clear(); // nur um sicher zu gehen, dass alle alte Werte geloescht sind\n\n                // Reload Gesuch in gesuchModelManager on Init in fallCreationView because it has been changed since last time\n                this.gesuchModelManager.clearGesuch();\n                let navObj: any = {\n                    betreuungNumber: betreuungNumber,\n                    kindNumber: kindNumber,\n                    gesuchId: pendenz.gesuchId\n                };\n                if (isCtrlKeyPressed) {\n                    let url = this.$state.href('gesuch.betreuung', navObj);\n                    window.open(url, '_blank');\n                } else {\n                    this.$state.go('gesuch.betreuung', navObj);\n                }\n            }\n        }\n    }\n}\n"]}]}