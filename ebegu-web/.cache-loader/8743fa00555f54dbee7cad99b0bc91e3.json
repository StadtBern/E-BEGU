{"remainingRequest":"/home/imanol/projects/ebegu/ebegu-web/node_modules/thread-loader/dist/cjs.js??ref--0-1!/home/imanol/projects/ebegu/ebegu-web/node_modules/ts-loader/index.js??ref--0-2!/home/imanol/projects/ebegu/ebegu-web/src/admin/component/institutionStammdatenView/institutionStammdatenView.ts","cacheIdentifier":"cache-loader:1.1.0 test","dependencies":[{"path":"/home/imanol/projects/ebegu/ebegu-web/src/admin/component/institutionStammdatenView/institutionStammdatenView.ts","mtime":1518003987668},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/cache-loader/dist/cjs.js","mtime":1507514019000},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/thread-loader/dist/cjs.js","mtime":1507523420000},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/ts-loader/index.js","mtime":1508488471000}],"contextDependencies":[],"result":["\"use strict\";\n/*\n * Ki-Tax: System for the management of external childcare subsidies\n * Copyright (C) 2017 City of Bern Switzerland\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n */\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar TSBetreuungsangebotTyp_1 = require(\"../../../models/enums/TSBetreuungsangebotTyp\");\nvar TSDayOfWeek_1 = require(\"../../../models/enums/TSDayOfWeek\");\nvar TSModulTagesschuleName_1 = require(\"../../../models/enums/TSModulTagesschuleName\");\nvar TSAdresse_1 = require(\"../../../models/TSAdresse\");\nvar TSInstitutionStammdaten_1 = require(\"../../../models/TSInstitutionStammdaten\");\nvar TSInstitutionStammdatenTagesschule_1 = require(\"../../../models/TSInstitutionStammdatenTagesschule\");\nvar TSModulTagesschule_1 = require(\"../../../models/TSModulTagesschule\");\nvar abstractAdminView_1 = require(\"../../abstractAdminView\");\nvar template = require('./institutionStammdatenView.html');\nrequire('./institutionStammdatenView.less');\nvar InstitutionStammdatenViewComponentConfig = /** @class */ (function () {\n    function InstitutionStammdatenViewComponentConfig() {\n        this.transclude = false;\n        this.template = template;\n        this.controller = InstitutionStammdatenViewController;\n        this.controllerAs = 'vm';\n    }\n    return InstitutionStammdatenViewComponentConfig;\n}());\nexports.InstitutionStammdatenViewComponentConfig = InstitutionStammdatenViewComponentConfig;\nvar InstitutionStammdatenViewController = /** @class */ (function (_super) {\n    __extends(InstitutionStammdatenViewController, _super);\n    function InstitutionStammdatenViewController(institutionRS, ebeguUtil, institutionStammdatenRS, $state, listResourceRS, authServiceRS, $stateParams) {\n        var _this = _super.call(this, authServiceRS) || this;\n        _this.institutionRS = institutionRS;\n        _this.ebeguUtil = ebeguUtil;\n        _this.institutionStammdatenRS = institutionStammdatenRS;\n        _this.$state = $state;\n        _this.listResourceRS = listResourceRS;\n        _this.$stateParams = $stateParams;\n        _this.errormessage = undefined;\n        _this.hasDifferentZahlungsadresse = false;\n        _this.modulTageschuleMap = {};\n        return _this;\n    }\n    InstitutionStammdatenViewController.prototype.$onInit = function () {\n        var _this = this;\n        this.setBetreuungsangebotTypValues();\n        this.listResourceRS.getLaenderList().then(function (laenderList) {\n            _this.laenderList = laenderList;\n        });\n        if (!this.$stateParams.institutionStammdatenId) {\n            this.institutionRS.findInstitution(this.$stateParams.institutionId).then(function (institution) {\n                _this.selectedInstitution = institution;\n                _this.createInstitutionStammdaten();\n                _this.loadModuleTagesschule();\n            });\n        }\n        else {\n            this.institutionStammdatenRS.findInstitutionStammdaten(this.$stateParams.institutionStammdatenId).then(function (institutionStammdaten) {\n                _this.setSelectedInstitutionStammdaten(institutionStammdaten);\n                _this.loadModuleTagesschule();\n            });\n        }\n    };\n    InstitutionStammdatenViewController.prototype.isCreateStammdatenMode = function () {\n        return this.selectedInstitutionStammdaten && this.selectedInstitutionStammdaten.isNew();\n    };\n    InstitutionStammdatenViewController.prototype.setSelectedInstitutionStammdaten = function (institutionStammdaten) {\n        this.selectedInstitutionStammdaten = institutionStammdaten;\n        this.selectedInstitution = institutionStammdaten.institution;\n        this.selectedInstitutionStammdatenBetreuungsangebot = this.getBetreuungsangebotFromInstitutionList(institutionStammdaten.betreuungsangebotTyp);\n        this.hasDifferentZahlungsadresse = !!this.selectedInstitutionStammdaten.adresseKontoinhaber;\n    };\n    InstitutionStammdatenViewController.prototype.getSelectedInstitutionStammdaten = function () {\n        return this.selectedInstitutionStammdaten;\n    };\n    InstitutionStammdatenViewController.prototype.createInstitutionStammdaten = function () {\n        this.selectedInstitutionStammdaten = new TSInstitutionStammdaten_1.default();\n        this.selectedInstitutionStammdaten.adresse = new TSAdresse_1.default();\n        this.selectedInstitutionStammdaten.institution = this.selectedInstitution;\n    };\n    InstitutionStammdatenViewController.prototype.differentZahlungsadresseClicked = function () {\n        if (this.hasDifferentZahlungsadresse) {\n            this.selectedInstitutionStammdaten.adresseKontoinhaber = new TSAdresse_1.default();\n        }\n        else {\n            this.selectedInstitutionStammdaten.adresseKontoinhaber = undefined;\n        }\n    };\n    InstitutionStammdatenViewController.prototype.saveInstitutionStammdaten = function (form) {\n        var _this = this;\n        if (form.$valid) {\n            this.selectedInstitutionStammdaten.betreuungsangebotTyp = this.selectedInstitutionStammdatenBetreuungsangebot.key;\n            this.replaceTagesschulmoduleOnInstitutionStammdatenTagesschule();\n            if (this.isCreateStammdatenMode()) {\n                this.institutionStammdatenRS.createInstitutionStammdaten(this.selectedInstitutionStammdaten).then(function (institutionStammdaten) {\n                    _this.goBack();\n                });\n            }\n            else {\n                this.institutionStammdatenRS.updateInstitutionStammdaten(this.selectedInstitutionStammdaten).then(function (institutionStammdaten) {\n                    _this.goBack();\n                });\n            }\n        }\n    };\n    InstitutionStammdatenViewController.prototype.goBack = function () {\n        this.$state.go('institution', {\n            institutionId: this.selectedInstitution.id\n        });\n    };\n    InstitutionStammdatenViewController.prototype.getBetreuungsangebotFromInstitutionList = function (betreuungsangebotTyp) {\n        return $.grep(this.betreuungsangebotValues, function (value) {\n            return value.key === betreuungsangebotTyp;\n        })[0];\n    };\n    InstitutionStammdatenViewController.prototype.isKita = function () {\n        return this.selectedInstitutionStammdatenBetreuungsangebot\n            && this.selectedInstitutionStammdatenBetreuungsangebot.key === TSBetreuungsangebotTyp_1.TSBetreuungsangebotTyp.KITA;\n    };\n    InstitutionStammdatenViewController.prototype.isTagesschule = function () {\n        return this.selectedInstitutionStammdatenBetreuungsangebot\n            && this.selectedInstitutionStammdatenBetreuungsangebot.key === TSBetreuungsangebotTyp_1.TSBetreuungsangebotTyp.TAGESSCHULE;\n    };\n    InstitutionStammdatenViewController.prototype.setBetreuungsangebotTypValues = function () {\n        this.betreuungsangebotValues = this.ebeguUtil.translateStringList(TSBetreuungsangebotTyp_1.getTSBetreuungsangebotTypValues());\n    };\n    InstitutionStammdatenViewController.prototype.getModulTagesschuleNamen = function () {\n        return TSModulTagesschuleName_1.getTSModulTagesschuleNameValues();\n    };\n    InstitutionStammdatenViewController.prototype.getModulTagesschule = function (modulname) {\n        var modul = this.modulTageschuleMap[modulname];\n        if (!modul) {\n            modul = new TSModulTagesschule_1.default();\n            modul.wochentag = TSDayOfWeek_1.TSDayOfWeek.MONDAY; // als Vertreter der ganzen Woche\n            modul.modulTagesschuleName = modulname;\n            this.modulTageschuleMap[modulname] = modul;\n        }\n        return modul;\n    };\n    InstitutionStammdatenViewController.prototype.loadModuleTagesschule = function () {\n        this.modulTageschuleMap = {};\n        if (this.selectedInstitutionStammdaten && this.selectedInstitutionStammdaten.id) {\n            if (this.selectedInstitutionStammdaten.institutionStammdatenTagesschule && this.selectedInstitutionStammdaten.institutionStammdatenTagesschule.moduleTagesschule) {\n                this.fillModulTagesschuleMap(this.selectedInstitutionStammdaten.institutionStammdatenTagesschule.moduleTagesschule);\n            }\n        }\n        else {\n            this.fillModulTagesschuleMap([]);\n        }\n    };\n    InstitutionStammdatenViewController.prototype.fillModulTagesschuleMap = function (modulListFromServer) {\n        var _this = this;\n        TSModulTagesschuleName_1.getTSModulTagesschuleNameValues().forEach(function (modulname) {\n            var foundmodul = modulListFromServer.filter(function (modul) { return (modul.modulTagesschuleName === modulname && modul.wochentag === TSDayOfWeek_1.TSDayOfWeek.MONDAY); })[0];\n            if (foundmodul) {\n                _this.modulTageschuleMap[modulname] = foundmodul;\n            }\n            else {\n                _this.modulTageschuleMap[modulname] = _this.getModulTagesschule(modulname);\n            }\n        });\n    };\n    InstitutionStammdatenViewController.prototype.replaceTagesschulmoduleOnInstitutionStammdatenTagesschule = function () {\n        var definedModulTagesschule = [];\n        for (var modulname in this.modulTageschuleMap) {\n            var tempModul = this.modulTageschuleMap[modulname];\n            if (tempModul.zeitVon && tempModul.zeitBis) {\n                definedModulTagesschule.push(tempModul);\n            }\n        }\n        if (definedModulTagesschule.length > 0) {\n            if (!this.selectedInstitutionStammdaten.institutionStammdatenTagesschule) {\n                this.selectedInstitutionStammdaten.institutionStammdatenTagesschule = new TSInstitutionStammdatenTagesschule_1.default();\n            }\n            this.selectedInstitutionStammdaten.institutionStammdatenTagesschule.moduleTagesschule = definedModulTagesschule;\n        }\n    };\n    InstitutionStammdatenViewController.$inject = ['InstitutionRS', 'EbeguUtil', 'InstitutionStammdatenRS', '$state', 'ListResourceRS', 'AuthServiceRS', '$stateParams'];\n    return InstitutionStammdatenViewController;\n}(abstractAdminView_1.default));\nexports.InstitutionStammdatenViewController = InstitutionStammdatenViewController;\n",{"version":3,"file":"/home/imanol/projects/ebegu/ebegu-web/src/admin/component/institutionStammdatenView/institutionStammdatenView.ts","sourceRoot":"","sources":["/home/imanol/projects/ebegu/ebegu-web/src/admin/component/institutionStammdatenView/institutionStammdatenView.ts"],"names":[],"mappings":"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","sourcesContent":["/*\n * Ki-Tax: System for the management of external childcare subsidies\n * Copyright (C) 2017 City of Bern Switzerland\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport {IComponentOptions} from 'angular';\nimport AuthServiceRS from '../../../authentication/service/AuthServiceRS.rest';\nimport {InstitutionRS} from '../../../core/service/institutionRS.rest';\nimport {InstitutionStammdatenRS} from '../../../core/service/institutionStammdatenRS.rest';\nimport ListResourceRS from '../../../core/service/listResourceRS.rest';\nimport {getTSBetreuungsangebotTypValues, TSBetreuungsangebotTyp} from '../../../models/enums/TSBetreuungsangebotTyp';\nimport {TSDayOfWeek} from '../../../models/enums/TSDayOfWeek';\nimport {getTSModulTagesschuleNameValues, TSModulTagesschuleName} from '../../../models/enums/TSModulTagesschuleName';\nimport TSAdresse from '../../../models/TSAdresse';\nimport TSInstitution from '../../../models/TSInstitution';\nimport TSInstitutionStammdaten from '../../../models/TSInstitutionStammdaten';\nimport TSInstitutionStammdatenTagesschule from '../../../models/TSInstitutionStammdatenTagesschule';\nimport TSModulTagesschule from '../../../models/TSModulTagesschule';\nimport TSLand from '../../../models/types/TSLand';\nimport EbeguUtil from '../../../utils/EbeguUtil';\nimport AbstractAdminViewController from '../../abstractAdminView';\nimport {IInstitutionStammdatenStateParams} from '../../admin.route';\nimport IStateService = angular.ui.IStateService;\nimport IFormController = angular.IFormController;\n\nlet template = require('./institutionStammdatenView.html');\nrequire('./institutionStammdatenView.less');\n\nexport class InstitutionStammdatenViewComponentConfig implements IComponentOptions {\n    transclude = false;\n    template = template;\n    controller = InstitutionStammdatenViewController;\n    controllerAs = 'vm';\n}\n\nexport class InstitutionStammdatenViewController extends AbstractAdminViewController {\n\n    form: IFormController;\n\n    selectedInstitution: TSInstitution;\n    selectedInstitutionStammdaten: TSInstitutionStammdaten;\n    betreuungsangebotValues: Array<any>;\n    selectedInstitutionStammdatenBetreuungsangebot: any;\n    laenderList: TSLand[];\n    errormessage: string = undefined;\n    hasDifferentZahlungsadresse: boolean = false;\n    modulTageschuleMap: { [key: string]: TSModulTagesschule; } = {};\n\n    static $inject = ['InstitutionRS', 'EbeguUtil', 'InstitutionStammdatenRS', '$state', 'ListResourceRS', 'AuthServiceRS', '$stateParams'];\n\n    constructor(private institutionRS: InstitutionRS, private ebeguUtil: EbeguUtil,\n                private institutionStammdatenRS: InstitutionStammdatenRS,\n                private $state: IStateService, private listResourceRS: ListResourceRS, authServiceRS: AuthServiceRS,\n                private $stateParams: IInstitutionStammdatenStateParams) {\n        super(authServiceRS);\n    }\n\n    $onInit() {\n        this.setBetreuungsangebotTypValues();\n        this.listResourceRS.getLaenderList().then((laenderList: TSLand[]) => {\n            this.laenderList = laenderList;\n        });\n        if (!this.$stateParams.institutionStammdatenId) {\n            this.institutionRS.findInstitution(this.$stateParams.institutionId).then((institution) => {\n                this.selectedInstitution = institution;\n                this.createInstitutionStammdaten();\n                this.loadModuleTagesschule();\n            });\n        } else {\n            this.institutionStammdatenRS.findInstitutionStammdaten(this.$stateParams.institutionStammdatenId).then((institutionStammdaten) => {\n                this.setSelectedInstitutionStammdaten(institutionStammdaten);\n                this.loadModuleTagesschule();\n            });\n        }\n    }\n\n    isCreateStammdatenMode(): boolean {\n        return this.selectedInstitutionStammdaten && this.selectedInstitutionStammdaten.isNew();\n    }\n\n    setSelectedInstitutionStammdaten(institutionStammdaten: TSInstitutionStammdaten): void {\n        this.selectedInstitutionStammdaten = institutionStammdaten;\n        this.selectedInstitution = institutionStammdaten.institution;\n        this.selectedInstitutionStammdatenBetreuungsangebot = this.getBetreuungsangebotFromInstitutionList(institutionStammdaten.betreuungsangebotTyp);\n        this.hasDifferentZahlungsadresse = !!this.selectedInstitutionStammdaten.adresseKontoinhaber;\n    }\n\n    getSelectedInstitutionStammdaten(): TSInstitutionStammdaten {\n        return this.selectedInstitutionStammdaten;\n    }\n\n    createInstitutionStammdaten(): void {\n        this.selectedInstitutionStammdaten = new TSInstitutionStammdaten();\n        this.selectedInstitutionStammdaten.adresse = new TSAdresse();\n        this.selectedInstitutionStammdaten.institution = this.selectedInstitution;\n    }\n\n    differentZahlungsadresseClicked(): void {\n        if (this.hasDifferentZahlungsadresse) {\n            this.selectedInstitutionStammdaten.adresseKontoinhaber = new TSAdresse();\n        } else {\n            this.selectedInstitutionStammdaten.adresseKontoinhaber = undefined;\n        }\n    }\n\n    saveInstitutionStammdaten(form: IFormController): void {\n        if (form.$valid) {\n            this.selectedInstitutionStammdaten.betreuungsangebotTyp = this.selectedInstitutionStammdatenBetreuungsangebot.key;\n            this.replaceTagesschulmoduleOnInstitutionStammdatenTagesschule();\n            if (this.isCreateStammdatenMode()) {\n                this.institutionStammdatenRS.createInstitutionStammdaten(this.selectedInstitutionStammdaten).then((institutionStammdaten: TSInstitutionStammdaten) => {\n                    this.goBack();\n                });\n            } else {\n                this.institutionStammdatenRS.updateInstitutionStammdaten(this.selectedInstitutionStammdaten).then((institutionStammdaten: TSInstitutionStammdaten) => {\n                    this.goBack();\n                });\n            }\n        }\n    }\n\n    private goBack() {\n        this.$state.go('institution', {\n            institutionId: this.selectedInstitution.id\n        });\n    }\n\n    getBetreuungsangebotFromInstitutionList(betreuungsangebotTyp: TSBetreuungsangebotTyp) {\n        return $.grep(this.betreuungsangebotValues, (value: any) => {\n            return value.key === betreuungsangebotTyp;\n        })[0];\n    }\n\n    isKita(): boolean {\n        return this.selectedInstitutionStammdatenBetreuungsangebot\n            && this.selectedInstitutionStammdatenBetreuungsangebot.key === TSBetreuungsangebotTyp.KITA;\n    }\n\n    isTagesschule(): boolean {\n        return this.selectedInstitutionStammdatenBetreuungsangebot\n            && this.selectedInstitutionStammdatenBetreuungsangebot.key === TSBetreuungsangebotTyp.TAGESSCHULE;\n    }\n\n    private setBetreuungsangebotTypValues(): void {\n        this.betreuungsangebotValues = this.ebeguUtil.translateStringList(getTSBetreuungsangebotTypValues());\n    }\n\n    public getModulTagesschuleNamen(): TSModulTagesschuleName[] {\n        return getTSModulTagesschuleNameValues();\n    }\n\n    public getModulTagesschule(modulname: TSModulTagesschuleName): TSModulTagesschule {\n        let modul: TSModulTagesschule = this.modulTageschuleMap[modulname];\n        if (!modul) {\n            modul = new TSModulTagesschule();\n            modul.wochentag = TSDayOfWeek.MONDAY; // als Vertreter der ganzen Woche\n            modul.modulTagesschuleName = modulname;\n            this.modulTageschuleMap[modulname] = modul;\n        }\n        return modul;\n    }\n\n    private loadModuleTagesschule(): void {\n        this.modulTageschuleMap = {};\n        if (this.selectedInstitutionStammdaten && this.selectedInstitutionStammdaten.id) {\n            if (this.selectedInstitutionStammdaten.institutionStammdatenTagesschule && this.selectedInstitutionStammdaten.institutionStammdatenTagesschule.moduleTagesschule) {\n                this.fillModulTagesschuleMap(this.selectedInstitutionStammdaten.institutionStammdatenTagesschule.moduleTagesschule);\n            }\n        } else {\n            this.fillModulTagesschuleMap([]);\n        }\n    }\n\n    private fillModulTagesschuleMap(modulListFromServer: TSModulTagesschule[]) {\n        getTSModulTagesschuleNameValues().forEach((modulname: TSModulTagesschuleName) => {\n            let foundmodul = modulListFromServer.filter(modul => (modul.modulTagesschuleName === modulname && modul.wochentag === TSDayOfWeek.MONDAY))[0];\n            if (foundmodul) {\n                this.modulTageschuleMap[modulname] = foundmodul;\n            } else {\n                this.modulTageschuleMap[modulname] = this.getModulTagesschule(modulname);\n            }\n        });\n    }\n\n    private replaceTagesschulmoduleOnInstitutionStammdatenTagesschule(): void {\n        let definedModulTagesschule = [];\n        for (let modulname in this.modulTageschuleMap) {\n            let tempModul: TSModulTagesschule = this.modulTageschuleMap[modulname];\n            if (tempModul.zeitVon && tempModul.zeitBis) {\n                definedModulTagesschule.push(tempModul);\n            }\n        }\n        if (definedModulTagesschule.length > 0) {\n            if (!this.selectedInstitutionStammdaten.institutionStammdatenTagesschule) {\n                this.selectedInstitutionStammdaten.institutionStammdatenTagesschule = new TSInstitutionStammdatenTagesschule();\n            }\n            this.selectedInstitutionStammdaten.institutionStammdatenTagesschule.moduleTagesschule = definedModulTagesschule;\n        }\n    }\n}\n"]}]}