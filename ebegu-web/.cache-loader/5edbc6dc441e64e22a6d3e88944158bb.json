{"remainingRequest":"/home/imanol/projects/ebegu/ebegu-web/node_modules/thread-loader/dist/cjs.js??ref--0-1!/home/imanol/projects/ebegu/ebegu-web/node_modules/ts-loader/index.js??ref--0-2!/home/imanol/projects/ebegu/ebegu-web/src/models/TSFinanzModel.ts","cacheIdentifier":"cache-loader:1.1.0 test","dependencies":[{"path":"/home/imanol/projects/ebegu/ebegu-web/src/models/TSFinanzModel.ts","mtime":1518535855232},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/cache-loader/dist/cjs.js","mtime":1507514019000},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/thread-loader/dist/cjs.js","mtime":1507523420000},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/ts-loader/index.js","mtime":1508488471000}],"contextDependencies":[],"result":["/*\n * Ki-Tax: System for the management of external childcare subsidies\n * Copyright (C) 2017 City of Bern Switzerland\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n */\ndefine([\"require\", \"exports\", \"./TSFinanzielleSituationContainer\", \"./TSFinanzielleSituation\", \"./TSEinkommensverschlechterungContainer\", \"./TSEinkommensverschlechterung\", \"./TSEinkommensverschlechterungInfoContainer\"], function (require, exports, TSFinanzielleSituationContainer_1, TSFinanzielleSituation_1, TSEinkommensverschlechterungContainer_1, TSEinkommensverschlechterung_1, TSEinkommensverschlechterungInfoContainer_1) {\n    \"use strict\";\n    Object.defineProperty(exports, \"__esModule\", { value: true });\n    var TSFinanzModel = /** @class */ (function () {\n        function TSFinanzModel(basisjahr, gesuchsteller2Required, gesuchstellerNumber, basisjahrPlus) {\n            this.basisjahr = basisjahr;\n            this.basisjahrPlus = basisjahrPlus;\n            this.gesuchsteller2Required = gesuchsteller2Required;\n            this.gesuchstellerNumber = gesuchstellerNumber;\n        }\n        Object.defineProperty(TSFinanzModel.prototype, \"gemeinsameSteuererklaerung\", {\n            get: function () {\n                return this._gemeinsameSteuererklaerung;\n            },\n            set: function (value) {\n                this._gemeinsameSteuererklaerung = value;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(TSFinanzModel.prototype, \"finanzielleSituationContainerGS1\", {\n            get: function () {\n                return this._finanzielleSituationContainerGS1;\n            },\n            set: function (value) {\n                this._finanzielleSituationContainerGS1 = value;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(TSFinanzModel.prototype, \"finanzielleSituationContainerGS2\", {\n            get: function () {\n                return this._finanzielleSituationContainerGS2;\n            },\n            set: function (value) {\n                this._finanzielleSituationContainerGS2 = value;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        TSFinanzModel.prototype.copyFinSitDataFromGesuch = function (gesuch) {\n            if (gesuch.extractFamiliensituation().gemeinsameSteuererklaerung) {\n                this.gemeinsameSteuererklaerung = angular.copy(gesuch.extractFamiliensituation().gemeinsameSteuererklaerung);\n            }\n            else {\n                this.gemeinsameSteuererklaerung = false;\n            }\n            this.finanzielleSituationContainerGS1 = angular.copy(gesuch.gesuchsteller1.finanzielleSituationContainer);\n            if (gesuch.gesuchsteller2) {\n                this.finanzielleSituationContainerGS2 = angular.copy(gesuch.gesuchsteller2.finanzielleSituationContainer);\n            }\n            this.initFinSit();\n        };\n        TSFinanzModel.prototype.copyEkvDataFromGesuch = function (gesuch) {\n            if (gesuch.einkommensverschlechterungInfoContainer) {\n                this.einkommensverschlechterungInfoContainer = angular.copy(gesuch.einkommensverschlechterungInfoContainer);\n            }\n            else {\n                this.einkommensverschlechterungInfoContainer = new TSEinkommensverschlechterungInfoContainer_1.default;\n            }\n            //geesuchstelelr1 nullsave?\n            this.einkommensverschlechterungContainerGS1 = angular.copy(gesuch.gesuchsteller1.einkommensverschlechterungContainer);\n            if (gesuch.gesuchsteller2) {\n                this.einkommensverschlechterungContainerGS2 = angular.copy(gesuch.gesuchsteller2.einkommensverschlechterungContainer);\n            }\n        };\n        TSFinanzModel.prototype.initFinSit = function () {\n            if (!this.finanzielleSituationContainerGS1) {\n                this.finanzielleSituationContainerGS1 = new TSFinanzielleSituationContainer_1.default();\n                this.finanzielleSituationContainerGS1.jahr = this.basisjahr;\n                this.finanzielleSituationContainerGS1.finanzielleSituationJA = new TSFinanzielleSituation_1.default();\n            }\n            if (this.gesuchsteller2Required && !this.finanzielleSituationContainerGS2) {\n                this.finanzielleSituationContainerGS2 = new TSFinanzielleSituationContainer_1.default();\n                this.finanzielleSituationContainerGS2.jahr = this.basisjahr;\n                this.finanzielleSituationContainerGS2.finanzielleSituationJA = new TSFinanzielleSituation_1.default();\n            }\n        };\n        TSFinanzModel.prototype.copyFinSitDataToGesuch = function (gesuch) {\n            gesuch.extractFamiliensituation().gemeinsameSteuererklaerung = this.gemeinsameSteuererklaerung;\n            gesuch.gesuchsteller1.finanzielleSituationContainer = this.finanzielleSituationContainerGS1;\n            if (gesuch.gesuchsteller2) {\n                gesuch.gesuchsteller2.finanzielleSituationContainer = this.finanzielleSituationContainerGS2;\n            }\n            else {\n                if (this.finanzielleSituationContainerGS2) {\n                    //wenn wir keinen gs2 haben sollten wir auch gar keinen solchen container haben\n                    console.log('illegal state: finanzielleSituationContainerGS2 exists but no gs2 is available');\n                }\n            }\n            this.resetSteuerveranlagungErhalten(gesuch);\n            return gesuch;\n        };\n        /**\n         * if gemeinsameSteuererklaerung has been set to true and steuerveranlagungErhalten ist set to true for the GS1\n         * as well, then we need to set steuerveranlagungErhalten to true for the GS2 too, if it exists.\n         */\n        TSFinanzModel.prototype.resetSteuerveranlagungErhalten = function (gesuch) {\n            if (gesuch.extractFamiliensituation().gemeinsameSteuererklaerung === true\n                && gesuch.gesuchsteller1 && gesuch.gesuchsteller2\n                && gesuch.gesuchsteller1.finanzielleSituationContainer.finanzielleSituationJA.steuerveranlagungErhalten === true) {\n                gesuch.gesuchsteller2.finanzielleSituationContainer.finanzielleSituationJA.steuerveranlagungErhalten = true;\n            }\n        };\n        TSFinanzModel.prototype.copyEkvSitDataToGesuch = function (gesuch) {\n            gesuch.einkommensverschlechterungInfoContainer = this.einkommensverschlechterungInfoContainer;\n            gesuch.gesuchsteller1.einkommensverschlechterungContainer = this.einkommensverschlechterungContainerGS1;\n            if (gesuch.gesuchsteller2) {\n                gesuch.gesuchsteller2.einkommensverschlechterungContainer = this.einkommensverschlechterungContainerGS2;\n            }\n            else {\n                if (this.einkommensverschlechterungContainerGS2) {\n                    //wenn wir keinen gs2 haben sollten wir auch gar keinen solchen container haben\n                    console.log('illegal state: einkommensverschlechterungContainerGS2 exists but no gs2 is available');\n                }\n            }\n            return gesuch;\n        };\n        TSFinanzModel.prototype.getFiSiConToWorkWith = function () {\n            if (this.gesuchstellerNumber === 2) {\n                return this.finanzielleSituationContainerGS2;\n            }\n            else {\n                return this.finanzielleSituationContainerGS1;\n            }\n        };\n        TSFinanzModel.prototype.getEkvContToWorkWith = function () {\n            if (this.gesuchstellerNumber === 2) {\n                return this.einkommensverschlechterungContainerGS2;\n            }\n            else {\n                return this.einkommensverschlechterungContainerGS1;\n            }\n        };\n        TSFinanzModel.prototype.getEkvToWorkWith = function () {\n            if (this.gesuchstellerNumber === 2) {\n                return this.getEkvOfBsj_JA(this.einkommensverschlechterungContainerGS2);\n            }\n            else {\n                return this.getEkvOfBsj_JA(this.einkommensverschlechterungContainerGS1);\n            }\n        };\n        TSFinanzModel.prototype.getEkvOfBsj_JA = function (einkommensverschlechterungContainer) {\n            if (this.basisjahrPlus === 2) {\n                return einkommensverschlechterungContainer.ekvJABasisJahrPlus2;\n            }\n            else {\n                return einkommensverschlechterungContainer.ekvJABasisJahrPlus1;\n            }\n        };\n        TSFinanzModel.prototype.getEkvToWorkWith_GS = function () {\n            if (this.gesuchstellerNumber === 2) {\n                return this.getEkvOfBsj_GS(this.einkommensverschlechterungContainerGS2);\n            }\n            else {\n                return this.getEkvOfBsj_GS(this.einkommensverschlechterungContainerGS1);\n            }\n        };\n        TSFinanzModel.prototype.getEkvOfBsj_GS = function (einkommensverschlechterungContainer) {\n            if (this.basisjahrPlus === 2) {\n                return einkommensverschlechterungContainer.ekvGSBasisJahrPlus2;\n            }\n            else {\n                return einkommensverschlechterungContainer.ekvGSBasisJahrPlus1;\n            }\n        };\n        TSFinanzModel.prototype.getGesuchstellerNumber = function () {\n            return this.gesuchstellerNumber;\n        };\n        TSFinanzModel.prototype.isGesuchsteller2Required = function () {\n            return this.gesuchsteller2Required;\n        };\n        Object.defineProperty(TSFinanzModel.prototype, \"einkommensverschlechterungContainerGS1\", {\n            get: function () {\n                return this._einkommensverschlechterungContainerGS1;\n            },\n            set: function (value) {\n                this._einkommensverschlechterungContainerGS1 = value;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(TSFinanzModel.prototype, \"einkommensverschlechterungContainerGS2\", {\n            get: function () {\n                return this._einkommensverschlechterungContainerGS2;\n            },\n            set: function (value) {\n                this._einkommensverschlechterungContainerGS2 = value;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(TSFinanzModel.prototype, \"einkommensverschlechterungInfoContainer\", {\n            get: function () {\n                return this._einkommensverschlechterungInfoContainer;\n            },\n            set: function (value) {\n                this._einkommensverschlechterungInfoContainer = value;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        TSFinanzModel.prototype.initEinkommensverschlechterungContainer = function (basisjahrPlus, gesuchstellerNumber) {\n            if (gesuchstellerNumber === 1) {\n                if (!this.einkommensverschlechterungContainerGS1) {\n                    this.einkommensverschlechterungContainerGS1 = new TSEinkommensverschlechterungContainer_1.default();\n                }\n                if (basisjahrPlus === 1) {\n                    if (!this.einkommensverschlechterungContainerGS1.ekvJABasisJahrPlus1) {\n                        this.einkommensverschlechterungContainerGS1.ekvJABasisJahrPlus1 = new TSEinkommensverschlechterung_1.default();\n                    }\n                }\n                if (basisjahrPlus === 2) {\n                    if (!this.einkommensverschlechterungContainerGS1.ekvJABasisJahrPlus2) {\n                        this.einkommensverschlechterungContainerGS1.ekvJABasisJahrPlus2 = new TSEinkommensverschlechterung_1.default();\n                    }\n                    // Wenn z.B. in der Periode 2016/2017 eine Einkommensverschlechterung für 2017 geltend gemacht wird,\n                    // ist es unmöglich, dass die Steuerveranlagung und Steuererklärung für 2017 schon dem Gesuchsteller vorliegt\n                    this.einkommensverschlechterungInfoContainer.einkommensverschlechterungInfoJA.gemeinsameSteuererklaerung_BjP2 = false;\n                    this.einkommensverschlechterungContainerGS1.ekvJABasisJahrPlus2.steuerveranlagungErhalten = false;\n                    this.einkommensverschlechterungContainerGS1.ekvJABasisJahrPlus2.steuererklaerungAusgefuellt = false;\n                }\n            }\n            if (gesuchstellerNumber === 2) {\n                if (!this.einkommensverschlechterungContainerGS2) {\n                    this.einkommensverschlechterungContainerGS2 = new TSEinkommensverschlechterungContainer_1.default();\n                }\n                if (basisjahrPlus === 1) {\n                    if (!this.einkommensverschlechterungContainerGS2.ekvJABasisJahrPlus1) {\n                        this.einkommensverschlechterungContainerGS2.ekvJABasisJahrPlus1 = new TSEinkommensverschlechterung_1.default();\n                    }\n                }\n                if (basisjahrPlus === 2) {\n                    if (!this.einkommensverschlechterungContainerGS2.ekvJABasisJahrPlus2) {\n                        this.einkommensverschlechterungContainerGS2.ekvJABasisJahrPlus2 = new TSEinkommensverschlechterung_1.default();\n                    }\n                    // Wenn z.B. in der Periode 2016/2017 eine Einkommensverschlechterung für 2017 geltend gemacht wird,\n                    // ist es unmöglich, dass die Steuerveranlagung und Steuererklärung für 2017 schon dem Gesuchsteller vorliegt\n                    this.einkommensverschlechterungInfoContainer.einkommensverschlechterungInfoJA.gemeinsameSteuererklaerung_BjP2 = false;\n                    this.einkommensverschlechterungContainerGS2.ekvJABasisJahrPlus2.steuerveranlagungErhalten = false;\n                    this.einkommensverschlechterungContainerGS2.ekvJABasisJahrPlus2.steuererklaerungAusgefuellt = false;\n                }\n            }\n        };\n        TSFinanzModel.prototype.getGemeinsameSteuererklaerungToWorkWith = function () {\n            if (this.basisjahrPlus === 2) {\n                return this.einkommensverschlechterungInfoContainer.einkommensverschlechterungInfoJA.gemeinsameSteuererklaerung_BjP2;\n            }\n            else {\n                return this.einkommensverschlechterungInfoContainer.einkommensverschlechterungInfoJA.gemeinsameSteuererklaerung_BjP1;\n            }\n        };\n        TSFinanzModel.prototype.getBasisJahrPlus = function () {\n            return this.basisjahrPlus;\n        };\n        return TSFinanzModel;\n    }());\n    exports.default = TSFinanzModel;\n});\n",{"version":3,"file":"/home/imanol/projects/ebegu/ebegu-web/src/models/TSFinanzModel.ts","sourceRoot":"","sources":["/home/imanol/projects/ebegu/ebegu-web/src/models/TSFinanzModel.ts"],"names":[],"mappings":"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","sourcesContent":["/*\n * Ki-Tax: System for the management of external childcare subsidies\n * Copyright (C) 2017 City of Bern Switzerland\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport TSFinanzielleSituationContainer from './TSFinanzielleSituationContainer';\nimport TSGesuch from './TSGesuch';\nimport TSFinanzielleSituation from './TSFinanzielleSituation';\nimport TSEinkommensverschlechterungContainer from './TSEinkommensverschlechterungContainer';\nimport TSEinkommensverschlechterung from './TSEinkommensverschlechterung';\nimport TSEinkommensverschlechterungInfoContainer from './TSEinkommensverschlechterungInfoContainer';\n\nexport default class TSFinanzModel {\n\n    private _gemeinsameSteuererklaerung: boolean;\n    private _finanzielleSituationContainerGS1: TSFinanzielleSituationContainer;\n    private _finanzielleSituationContainerGS2: TSFinanzielleSituationContainer;\n    private _einkommensverschlechterungContainerGS1: TSEinkommensverschlechterungContainer;\n    private _einkommensverschlechterungContainerGS2: TSEinkommensverschlechterungContainer;\n    private _einkommensverschlechterungInfoContainer: TSEinkommensverschlechterungInfoContainer;\n\n    private basisjahr: number;\n    private basisjahrPlus: number;\n    private gesuchsteller2Required: boolean;\n    private gesuchstellerNumber: number;\n\n    constructor(basisjahr: number, gesuchsteller2Required: boolean, gesuchstellerNumber: number, basisjahrPlus?: number) {\n        this.basisjahr = basisjahr;\n        this.basisjahrPlus = basisjahrPlus;\n        this.gesuchsteller2Required = gesuchsteller2Required;\n        this.gesuchstellerNumber = gesuchstellerNumber;\n    }\n\n    get gemeinsameSteuererklaerung(): boolean {\n        return this._gemeinsameSteuererklaerung;\n    }\n\n    set gemeinsameSteuererklaerung(value: boolean) {\n        this._gemeinsameSteuererklaerung = value;\n    }\n\n    get finanzielleSituationContainerGS1(): TSFinanzielleSituationContainer {\n        return this._finanzielleSituationContainerGS1;\n    }\n\n    set finanzielleSituationContainerGS1(value: TSFinanzielleSituationContainer) {\n        this._finanzielleSituationContainerGS1 = value;\n    }\n\n    get finanzielleSituationContainerGS2(): TSFinanzielleSituationContainer {\n        return this._finanzielleSituationContainerGS2;\n    }\n\n    set finanzielleSituationContainerGS2(value: TSFinanzielleSituationContainer) {\n        this._finanzielleSituationContainerGS2 = value;\n    }\n\n    public copyFinSitDataFromGesuch(gesuch: TSGesuch) {\n\n        if (gesuch.extractFamiliensituation().gemeinsameSteuererklaerung) {\n            this.gemeinsameSteuererklaerung = angular.copy(gesuch.extractFamiliensituation().gemeinsameSteuererklaerung);\n        } else {\n            this.gemeinsameSteuererklaerung = false;\n        }\n        this.finanzielleSituationContainerGS1 = angular.copy(gesuch.gesuchsteller1.finanzielleSituationContainer);\n        if (gesuch.gesuchsteller2) {\n            this.finanzielleSituationContainerGS2 = angular.copy(gesuch.gesuchsteller2.finanzielleSituationContainer);\n        }\n        this.initFinSit();\n    }\n\n    copyEkvDataFromGesuch(gesuch: TSGesuch) {\n        if (gesuch.einkommensverschlechterungInfoContainer) {\n            this.einkommensverschlechterungInfoContainer = angular.copy(gesuch.einkommensverschlechterungInfoContainer);\n        } else {\n            this.einkommensverschlechterungInfoContainer = new TSEinkommensverschlechterungInfoContainer;\n        }\n        //geesuchstelelr1 nullsave?\n        this.einkommensverschlechterungContainerGS1 = angular.copy(gesuch.gesuchsteller1.einkommensverschlechterungContainer);\n        if (gesuch.gesuchsteller2) {\n            this.einkommensverschlechterungContainerGS2 = angular.copy(gesuch.gesuchsteller2.einkommensverschlechterungContainer);\n        }\n\n    }\n\n    public initFinSit() {\n        if (!this.finanzielleSituationContainerGS1) {\n            this.finanzielleSituationContainerGS1 = new TSFinanzielleSituationContainer();\n            this.finanzielleSituationContainerGS1.jahr = this.basisjahr;\n            this.finanzielleSituationContainerGS1.finanzielleSituationJA = new TSFinanzielleSituation();\n        }\n\n        if (this.gesuchsteller2Required && !this.finanzielleSituationContainerGS2) {\n            this.finanzielleSituationContainerGS2 = new TSFinanzielleSituationContainer();\n            this.finanzielleSituationContainerGS2.jahr = this.basisjahr;\n            this.finanzielleSituationContainerGS2.finanzielleSituationJA = new TSFinanzielleSituation();\n        }\n    }\n\n    copyFinSitDataToGesuch(gesuch: TSGesuch): TSGesuch {\n        gesuch.extractFamiliensituation().gemeinsameSteuererklaerung = this.gemeinsameSteuererklaerung;\n        gesuch.gesuchsteller1.finanzielleSituationContainer = this.finanzielleSituationContainerGS1;\n        if (gesuch.gesuchsteller2) {\n            gesuch.gesuchsteller2.finanzielleSituationContainer = this.finanzielleSituationContainerGS2;\n        } else {\n            if (this.finanzielleSituationContainerGS2) {\n                //wenn wir keinen gs2 haben sollten wir auch gar keinen solchen container haben\n                console.log('illegal state: finanzielleSituationContainerGS2 exists but no gs2 is available');\n            }\n        }\n        this.resetSteuerveranlagungErhalten(gesuch);\n        return gesuch;\n    }\n\n    /**\n     * if gemeinsameSteuererklaerung has been set to true and steuerveranlagungErhalten ist set to true for the GS1\n     * as well, then we need to set steuerveranlagungErhalten to true for the GS2 too, if it exists.\n     */\n    private resetSteuerveranlagungErhalten(gesuch: TSGesuch) {\n        if (gesuch.extractFamiliensituation().gemeinsameSteuererklaerung === true\n            && gesuch.gesuchsteller1 && gesuch.gesuchsteller2\n            && gesuch.gesuchsteller1.finanzielleSituationContainer.finanzielleSituationJA.steuerveranlagungErhalten === true) {\n\n            gesuch.gesuchsteller2.finanzielleSituationContainer.finanzielleSituationJA.steuerveranlagungErhalten = true;\n        }\n    }\n\n    copyEkvSitDataToGesuch(gesuch: TSGesuch): TSGesuch {\n        gesuch.einkommensverschlechterungInfoContainer = this.einkommensverschlechterungInfoContainer;\n        gesuch.gesuchsteller1.einkommensverschlechterungContainer = this.einkommensverschlechterungContainerGS1;\n        if (gesuch.gesuchsteller2) {\n            gesuch.gesuchsteller2.einkommensverschlechterungContainer = this.einkommensverschlechterungContainerGS2;\n        } else {\n            if (this.einkommensverschlechterungContainerGS2) {\n                //wenn wir keinen gs2 haben sollten wir auch gar keinen solchen container haben\n                console.log('illegal state: einkommensverschlechterungContainerGS2 exists but no gs2 is available');\n            }\n        }\n        return gesuch;\n    }\n\n    public getFiSiConToWorkWith(): TSFinanzielleSituationContainer {\n        if (this.gesuchstellerNumber === 2) {\n            return this.finanzielleSituationContainerGS2;\n        } else {\n            return this.finanzielleSituationContainerGS1;\n        }\n    }\n\n    public getEkvContToWorkWith(): TSEinkommensverschlechterungContainer {\n        if (this.gesuchstellerNumber === 2) {\n            return this.einkommensverschlechterungContainerGS2;\n        } else {\n            return this.einkommensverschlechterungContainerGS1;\n        }\n    }\n\n    public getEkvToWorkWith(): TSEinkommensverschlechterung {\n        if (this.gesuchstellerNumber === 2) {\n            return this.getEkvOfBsj_JA(this.einkommensverschlechterungContainerGS2);\n        } else {\n            return this.getEkvOfBsj_JA(this.einkommensverschlechterungContainerGS1);\n        }\n    }\n\n    private getEkvOfBsj_JA(einkommensverschlechterungContainer: TSEinkommensverschlechterungContainer): TSEinkommensverschlechterung {\n        if (this.basisjahrPlus === 2) {\n            return einkommensverschlechterungContainer.ekvJABasisJahrPlus2;\n        } else {\n            return einkommensverschlechterungContainer.ekvJABasisJahrPlus1;\n        }\n    }\n\n    public getEkvToWorkWith_GS(): TSEinkommensverschlechterung {\n        if (this.gesuchstellerNumber === 2) {\n            return this.getEkvOfBsj_GS(this.einkommensverschlechterungContainerGS2);\n        } else {\n            return this.getEkvOfBsj_GS(this.einkommensverschlechterungContainerGS1);\n        }\n    }\n\n    private getEkvOfBsj_GS(einkommensverschlechterungContainer: TSEinkommensverschlechterungContainer): TSEinkommensverschlechterung {\n        if (this.basisjahrPlus === 2) {\n            return einkommensverschlechterungContainer.ekvGSBasisJahrPlus2;\n        } else {\n            return einkommensverschlechterungContainer.ekvGSBasisJahrPlus1;\n        }\n    }\n\n    public getGesuchstellerNumber(): number {\n        return this.gesuchstellerNumber;\n    }\n\n    public isGesuchsteller2Required(): boolean {\n        return this.gesuchsteller2Required;\n    }\n\n    get einkommensverschlechterungContainerGS1(): TSEinkommensverschlechterungContainer {\n        return this._einkommensverschlechterungContainerGS1;\n    }\n\n    set einkommensverschlechterungContainerGS1(value: TSEinkommensverschlechterungContainer) {\n        this._einkommensverschlechterungContainerGS1 = value;\n    }\n\n    get einkommensverschlechterungContainerGS2(): TSEinkommensverschlechterungContainer {\n        return this._einkommensverschlechterungContainerGS2;\n    }\n\n    set einkommensverschlechterungContainerGS2(value: TSEinkommensverschlechterungContainer) {\n        this._einkommensverschlechterungContainerGS2 = value;\n    }\n\n    get einkommensverschlechterungInfoContainer(): TSEinkommensverschlechterungInfoContainer {\n        return this._einkommensverschlechterungInfoContainer;\n    }\n\n    set einkommensverschlechterungInfoContainer(value: TSEinkommensverschlechterungInfoContainer) {\n        this._einkommensverschlechterungInfoContainer = value;\n    }\n\n    public initEinkommensverschlechterungContainer(basisjahrPlus: number, gesuchstellerNumber: number): void {\n\n        if (gesuchstellerNumber === 1) {\n            if (!this.einkommensverschlechterungContainerGS1) {\n                this.einkommensverschlechterungContainerGS1 = new TSEinkommensverschlechterungContainer();\n            }\n\n            if (basisjahrPlus === 1) {\n                if (!this.einkommensverschlechterungContainerGS1.ekvJABasisJahrPlus1) {\n                    this.einkommensverschlechterungContainerGS1.ekvJABasisJahrPlus1 = new TSEinkommensverschlechterung();\n                }\n            }\n\n            if (basisjahrPlus === 2) {\n                if (!this.einkommensverschlechterungContainerGS1.ekvJABasisJahrPlus2) {\n                    this.einkommensverschlechterungContainerGS1.ekvJABasisJahrPlus2 = new TSEinkommensverschlechterung();\n                }\n                // Wenn z.B. in der Periode 2016/2017 eine Einkommensverschlechterung für 2017 geltend gemacht wird,\n                // ist es unmöglich, dass die Steuerveranlagung und Steuererklärung für 2017 schon dem Gesuchsteller vorliegt\n                this.einkommensverschlechterungInfoContainer.einkommensverschlechterungInfoJA.gemeinsameSteuererklaerung_BjP2 = false;\n                this.einkommensverschlechterungContainerGS1.ekvJABasisJahrPlus2.steuerveranlagungErhalten = false;\n                this.einkommensverschlechterungContainerGS1.ekvJABasisJahrPlus2.steuererklaerungAusgefuellt = false;\n            }\n        }\n\n        if (gesuchstellerNumber === 2) {\n            if (!this.einkommensverschlechterungContainerGS2) {\n                this.einkommensverschlechterungContainerGS2 = new TSEinkommensverschlechterungContainer();\n            }\n\n            if (basisjahrPlus === 1) {\n                if (!this.einkommensverschlechterungContainerGS2.ekvJABasisJahrPlus1) {\n                    this.einkommensverschlechterungContainerGS2.ekvJABasisJahrPlus1 = new TSEinkommensverschlechterung();\n                }\n            }\n\n            if (basisjahrPlus === 2) {\n                if (!this.einkommensverschlechterungContainerGS2.ekvJABasisJahrPlus2) {\n                    this.einkommensverschlechterungContainerGS2.ekvJABasisJahrPlus2 = new TSEinkommensverschlechterung();\n                }\n                // Wenn z.B. in der Periode 2016/2017 eine Einkommensverschlechterung für 2017 geltend gemacht wird,\n                // ist es unmöglich, dass die Steuerveranlagung und Steuererklärung für 2017 schon dem Gesuchsteller vorliegt\n                this.einkommensverschlechterungInfoContainer.einkommensverschlechterungInfoJA.gemeinsameSteuererklaerung_BjP2 = false;\n                this.einkommensverschlechterungContainerGS2.ekvJABasisJahrPlus2.steuerveranlagungErhalten = false;\n                this.einkommensverschlechterungContainerGS2.ekvJABasisJahrPlus2.steuererklaerungAusgefuellt = false;\n            }\n        }\n    }\n\n    public getGemeinsameSteuererklaerungToWorkWith(): boolean {\n        if (this.basisjahrPlus === 2) {\n            return this.einkommensverschlechterungInfoContainer.einkommensverschlechterungInfoJA.gemeinsameSteuererklaerung_BjP2;\n        } else {\n            return this.einkommensverschlechterungInfoContainer.einkommensverschlechterungInfoJA.gemeinsameSteuererklaerung_BjP1;\n        }\n    }\n\n    getBasisJahrPlus() {\n        return this.basisjahrPlus;\n    }\n}\n"]}]}