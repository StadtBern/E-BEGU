{"remainingRequest":"/home/imanol/projects/ebegu/ebegu-web/node_modules/thread-loader/dist/cjs.js??ref--0-1!/home/imanol/projects/ebegu/ebegu-web/node_modules/ts-loader/index.js??ref--0-2!/home/imanol/projects/ebegu/ebegu-web/src/core/component/dv-countdown/dv-countdown.ts","cacheIdentifier":"cache-loader:1.1.0 test","dependencies":[{"path":"/home/imanol/projects/ebegu/ebegu-web/src/core/component/dv-countdown/dv-countdown.ts","mtime":1512484411999},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/cache-loader/dist/cjs.js","mtime":1507514019000},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/thread-loader/dist/cjs.js","mtime":1507523420000},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/ts-loader/index.js","mtime":1508488471000}],"contextDependencies":[],"result":["\"use strict\";\n/*\n * Ki-Tax: System for the management of external childcare subsidies\n * Copyright (C) 2017 City of Bern Switzerland\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar TSRoleUtil_1 = require(\"../../../utils/TSRoleUtil\");\nvar TSHTTPEvent_1 = require(\"../../events/TSHTTPEvent\");\nvar OkDialogController_1 = require(\"../../../gesuch/dialog/OkDialogController\");\nvar TSRole_1 = require(\"../../../models/enums/TSRole\");\nvar moment = require(\"moment\");\nvar template = require('./dv-countdown.html');\nvar dialogTemplate = require('../../../gesuch/dialog/okDialogTemplate.html');\nvar DvCountdownComponentConfig = /** @class */ (function () {\n    function DvCountdownComponentConfig() {\n        this.transclude = false;\n        this.bindings = {};\n        this.template = template;\n        this.controller = DvCountdownController;\n        this.controllerAs = 'vm';\n    }\n    return DvCountdownComponentConfig;\n}());\nexports.DvCountdownComponentConfig = DvCountdownComponentConfig;\nvar DvCountdownController = /** @class */ (function () {\n    function DvCountdownController(authServiceRS, $state, $interval, $rootScope, DvDialog, gesuchModelManager) {\n        this.authServiceRS = authServiceRS;\n        this.$state = $state;\n        this.$interval = $interval;\n        this.$rootScope = $rootScope;\n        this.DvDialog = DvDialog;\n        this.gesuchModelManager = gesuchModelManager;\n    }\n    DvCountdownController.prototype.$onInit = function () {\n        var _this = this;\n        this.TSRoleUtil = TSRoleUtil_1.TSRoleUtil;\n        this.$rootScope.$on(TSHTTPEvent_1.TSHTTPEvent[TSHTTPEvent_1.TSHTTPEvent.REQUEST_FINISHED], function () {\n            if (_this.authServiceRS.isRole(TSRole_1.TSRole.GESUCHSTELLER) && _this.isGesuchAvailableAndWritable() && _this.isOnGesuchView()) {\n                if (_this.timerInterval === undefined) {\n                    _this.startTimer();\n                }\n                else {\n                    _this.resetTimer();\n                }\n            }\n            else {\n                _this.cancelInterval();\n            }\n        });\n    };\n    DvCountdownController.prototype.getTimeLeft = function () {\n        if (this.timer) {\n            if (this.timer.asMinutes() < 5) {\n                return this.timer.minutes() + ' : ' + (this.timer.seconds() < 10 ? '0' + this.timer.seconds() : this.timer.seconds());\n            }\n        }\n        return '';\n    };\n    DvCountdownController.prototype.decrease = function () {\n        if (this.timer.asMilliseconds() <= 0) {\n            this.stopTimer();\n        }\n        else {\n            this.timer = moment.duration(this.timer.asSeconds() - 1, 'seconds');\n        }\n    };\n    //Fuer Testzwecke hier auf 5 setzen, ab dann erscheint der Countdown\n    DvCountdownController.prototype.resetTimer = function () {\n        this.timer = moment.duration(10, 'minutes');\n    };\n    DvCountdownController.prototype.stopTimer = function () {\n        this.cancelInterval();\n        this.DvDialog.showDialog(dialogTemplate, OkDialogController_1.OkDialogController, {\n            title: 'Bitte fahren Sie mit der Bearbeitung fort',\n        });\n    };\n    DvCountdownController.prototype.cancelInterval = function () {\n        if (this.timerInterval !== undefined) {\n            this.$interval.cancel(this.timerInterval);\n            this.timerInterval = undefined;\n            this.timer = undefined;\n        }\n    };\n    DvCountdownController.prototype.startTimer = function () {\n        this.resetTimer();\n        //Fuer Testzwecke hier auf 10 oder 100 setzen\n        this.timerInterval = this.$interval(this.decrease.bind(this), 1000);\n    };\n    DvCountdownController.prototype.isOnGesuchView = function () {\n        return (this.$state.current && this.$state.current.name.substring(0, 7) === 'gesuch.');\n    };\n    DvCountdownController.prototype.isGesuchAvailableAndWritable = function () {\n        // verursacht login problem wenn man nicht schon eingelogged ist (gesuch model manager versucht services aufzurufen)\n        if (this.gesuchModelManager.getGesuch()) {\n            return !this.gesuchModelManager.isGesuchReadonly();\n        }\n        return false;\n    };\n    DvCountdownController.$inject = ['AuthServiceRS', '$state', '$interval', '$rootScope', 'DvDialog', 'GesuchModelManager'];\n    return DvCountdownController;\n}());\nexports.DvCountdownController = DvCountdownController;\n",{"version":3,"file":"/home/imanol/projects/ebegu/ebegu-web/src/core/component/dv-countdown/dv-countdown.ts","sourceRoot":"","sources":["/home/imanol/projects/ebegu/ebegu-web/src/core/component/dv-countdown/dv-countdown.ts"],"names":[],"mappings":"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","sourcesContent":["/*\n * Ki-Tax: System for the management of external childcare subsidies\n * Copyright (C) 2017 City of Bern Switzerland\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport {IComponentOptions, IIntervalService} from 'angular';\nimport {TSRoleUtil} from '../../../utils/TSRoleUtil';\nimport {IStateService} from 'angular-ui-router';\nimport {TSHTTPEvent} from '../../events/TSHTTPEvent';\nimport {DvDialog} from '../../directive/dv-dialog/dv-dialog';\nimport {OkDialogController} from '../../../gesuch/dialog/OkDialogController';\nimport AuthServiceRS from '../../../authentication/service/AuthServiceRS.rest';\nimport {TSRole} from '../../../models/enums/TSRole';\nimport GesuchModelManager from '../../../gesuch/service/gesuchModelManager';\nimport * as moment from 'moment';\nimport IPromise = angular.IPromise;\nimport IRootScopeService = angular.IRootScopeService;\nlet template = require('./dv-countdown.html');\nlet dialogTemplate = require('../../../gesuch/dialog/okDialogTemplate.html');\n\nexport class DvCountdownComponentConfig implements IComponentOptions {\n    transclude = false;\n    bindings: any = {};\n    template = template;\n    controller = DvCountdownController;\n    controllerAs = 'vm';\n}\n\nexport class DvCountdownController {\n\n    TSRoleUtil: any;\n    timer: moment.Duration;\n    timerInterval: IPromise<any>;\n\n    static $inject: any[] = ['AuthServiceRS', '$state', '$interval', '$rootScope', 'DvDialog', 'GesuchModelManager'];\n\n    constructor(private authServiceRS: AuthServiceRS, private $state: IStateService, private $interval: IIntervalService, private $rootScope: IRootScopeService, private DvDialog: DvDialog,\n                private gesuchModelManager: GesuchModelManager) {\n    }\n\n    $onInit() {\n        this.TSRoleUtil = TSRoleUtil;\n        this.$rootScope.$on(TSHTTPEvent[TSHTTPEvent.REQUEST_FINISHED], () => {\n                if (this.authServiceRS.isRole(TSRole.GESUCHSTELLER) && this.isGesuchAvailableAndWritable()  && this.isOnGesuchView()) {\n                    if (this.timerInterval === undefined) {\n                        this.startTimer();\n                    } else {\n                        this.resetTimer();\n                    }\n                } else {\n                    this.cancelInterval();\n                }\n\n        });\n\n    }\n\n    public getTimeLeft(): string {\n        if (this.timer) {\n            if (this.timer.asMinutes() < 5) {\n                return this.timer.minutes() + ' : ' + (this.timer.seconds() < 10 ? '0' + this.timer.seconds() : this.timer.seconds());\n            }\n        }\n        return '';\n    }\n\n    public decrease() {\n        if (this.timer.asMilliseconds() <= 0) {\n            this.stopTimer();\n        } else {\n            this.timer = moment.duration(this.timer.asSeconds() - 1, 'seconds');\n        }\n    }\n\n    //Fuer Testzwecke hier auf 5 setzen, ab dann erscheint der Countdown\n    public resetTimer(): void {\n        this.timer = moment.duration(10, 'minutes');\n    }\n\n    public stopTimer(): void {\n        this.cancelInterval();\n        this.DvDialog.showDialog(dialogTemplate, OkDialogController, {\n            title: 'Bitte fahren Sie mit der Bearbeitung fort',\n        });\n    }\n\n    public cancelInterval(): void {\n        if (this.timerInterval !== undefined) {\n            this.$interval.cancel(this.timerInterval);\n            this.timerInterval = undefined;\n            this.timer = undefined;\n        }\n    }\n\n    public startTimer(): void {\n        this.resetTimer();\n        //Fuer Testzwecke hier auf 10 oder 100 setzen\n        this.timerInterval = this.$interval(this.decrease.bind(this), 1000);\n    }\n\n    public isOnGesuchView(): boolean {\n        return (this.$state.current && this.$state.current.name.substring(0, 7) === 'gesuch.');\n    }\n\n    public isGesuchAvailableAndWritable(): boolean {\n        // verursacht login problem wenn man nicht schon eingelogged ist (gesuch model manager versucht services aufzurufen)\n        if (this.gesuchModelManager.getGesuch()) {\n            return !this.gesuchModelManager.isGesuchReadonly();\n        }\n        return false;\n    }\n}\n"]}]}