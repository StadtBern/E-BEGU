{"remainingRequest":"/home/imanol/projects/ebegu/ebegu-web/node_modules/thread-loader/dist/cjs.js??ref--0-1!/home/imanol/projects/ebegu/ebegu-web/node_modules/ts-loader/index.js??ref--0-2!/home/imanol/projects/ebegu/ebegu-web/src/gesuch/component/verfuegenListView/verfuegenListView.ts","cacheIdentifier":"cache-loader:1.1.0 test","dependencies":[{"path":"/home/imanol/projects/ebegu/ebegu-web/src/gesuch/component/verfuegenListView/verfuegenListView.ts","mtime":1518535855228},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/cache-loader/dist/cjs.js","mtime":1507514019000},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/thread-loader/dist/cjs.js","mtime":1507523420000},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/ts-loader/index.js","mtime":1508488471000}],"contextDependencies":[],"result":["/*\n * Ki-Tax: System for the management of external childcare subsidies\n * Copyright (C) 2017 City of Bern Switzerland\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n */\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\ndefine([\"require\", \"exports\", \"../abstractGesuchView\", \"../../../utils/EbeguUtil\", \"../../../models/enums/TSWizardStepName\", \"../../../models/enums/TSWizardStepStatus\", \"../../../models/enums/TSAntragStatus\", \"../../dialog/RemoveDialogController\", \"../../../models/enums/TSBetreuungsstatus\", \"../../../models/TSMahnung\", \"../../../models/enums/TSMahnungTyp\", \"../../../models/enums/TSRole\", \"../../dialog/BemerkungenDialogController\", \"../../../utils/AuthenticationUtil\"], function (require, exports, abstractGesuchView_1, EbeguUtil_1, TSWizardStepName_1, TSWizardStepStatus_1, TSAntragStatus_1, RemoveDialogController_1, TSBetreuungsstatus_1, TSMahnung_1, TSMahnungTyp_1, TSRole_1, BemerkungenDialogController_1, AuthenticationUtil_1) {\n    \"use strict\";\n    Object.defineProperty(exports, \"__esModule\", { value: true });\n    var template = require('./verfuegenListView.html');\n    require('./verfuegenListView.less');\n    var removeDialogTempl = require('../../dialog/removeDialogTemplate.html');\n    var bemerkungDialogTempl = require('../../dialog/bemerkungenDialogTemplate.html');\n    var VerfuegenListViewComponentConfig = /** @class */ (function () {\n        function VerfuegenListViewComponentConfig() {\n            this.transclude = false;\n            this.bindings = {\n                // Bereits vorhandene Mahnungen\n                mahnungList: '<'\n            };\n            this.template = template;\n            this.controller = VerfuegenListViewController;\n            this.controllerAs = 'vm';\n        }\n        return VerfuegenListViewComponentConfig;\n    }());\n    exports.VerfuegenListViewComponentConfig = VerfuegenListViewComponentConfig;\n    var VerfuegenListViewController = /** @class */ (function (_super) {\n        __extends(VerfuegenListViewController, _super);\n        /* @ngInject */\n        function VerfuegenListViewController($state, gesuchModelManager, berechnungsManager, ebeguUtil, wizardStepManager, DvDialog, downloadRS, mahnungRS, $log, authServiceRs, $scope, gesuchRS, $timeout) {\n            var _this = _super.call(this, gesuchModelManager, berechnungsManager, wizardStepManager, $scope, TSWizardStepName_1.TSWizardStepName.VERFUEGEN, $timeout) || this;\n            _this.$state = $state;\n            _this.ebeguUtil = ebeguUtil;\n            _this.DvDialog = DvDialog;\n            _this.downloadRS = downloadRS;\n            _this.mahnungRS = mahnungRS;\n            _this.$log = $log;\n            _this.authServiceRs = authServiceRs;\n            _this.gesuchRS = gesuchRS;\n            _this.initViewModel();\n            return _this;\n        }\n        /**\n         * Die finanzielle Situation und die Einkommensverschlechterungen muessen mithilfe des Berechnungsmanagers\n         * berechnet werden, um manche Daten zur Verfügung zu haben. Das ist notwendig weil die finanzielle Situation nicht\n         * gespeichert wird. D.H. das erste Mal in einer Sitzung wenn ein Gesuch geoeffnet wird, ist gar nichts berechnet.\n         * Wenn man dann die Verfügen direkt aufmacht, ist alles leer und wird nichts angezeigt, deswegen muss alles auch\n         * hier berechnet werden. Um Probleme mit der Performance zu vermeiden, wird zuerst geprueft, ob die Berechnung\n         * schon vorher gemacht wurde, wenn ja dann wird sie einfach verwendet ohne sie neu berechnen zu muessen. Dieses\n         * geht aber davon aus, dass die Berechnungen immer richtig kalkuliert wurden.\n         *\n         * Die Verfuegungen werden IMMER geladen, wenn diese View geladen wird. Dieses ist etwas ineffizient. Allerdings\n         * muss es eigentlich so funktionieren, weil die Daten sich haben aendern koennen. Es ist ein aehnlicher Fall wie\n         * mit der finanziellen Situation. Sollte es Probleme mit der Performance geben, muessen wir ueberlegen, ob wir es\n         * irgendwie anders berechnen koennen um den Server zu entlasten.\n         */\n        VerfuegenListViewController.prototype.initViewModel = function () {\n            this.wizardStepManager.updateCurrentWizardStepStatus(TSWizardStepStatus_1.TSWizardStepStatus.WARTEN);\n            //Berechnung aller finanziellen Daten\n            if (!this.berechnungsManager.finanzielleSituationResultate) {\n                this.berechnungsManager.calculateFinanzielleSituation(this.gesuchModelManager.getGesuch()); //.then(() => {});\n            }\n            if (this.gesuchModelManager.getGesuch() && this.gesuchModelManager.getGesuch().extractEinkommensverschlechterungInfo()\n                && this.gesuchModelManager.getGesuch().extractEinkommensverschlechterungInfo().ekvFuerBasisJahrPlus1\n                && !this.berechnungsManager.einkommensverschlechterungResultateBjP1) {\n                this.berechnungsManager.calculateEinkommensverschlechterung(this.gesuchModelManager.getGesuch(), 1); //.then(() => {});\n            }\n            if (this.gesuchModelManager.getGesuch() && this.gesuchModelManager.getGesuch().extractEinkommensverschlechterungInfo()\n                && this.gesuchModelManager.getGesuch().extractEinkommensverschlechterungInfo().ekvFuerBasisJahrPlus2\n                && !this.berechnungsManager.einkommensverschlechterungResultateBjP2) {\n                this.berechnungsManager.calculateEinkommensverschlechterung(this.gesuchModelManager.getGesuch(), 2); //.then(() => {});\n            }\n            this.refreshKinderListe();\n        };\n        VerfuegenListViewController.prototype.refreshKinderListe = function () {\n            var _this = this;\n            return this.gesuchModelManager.calculateVerfuegungen().then(function () {\n                _this.kinderWithBetreuungList = _this.gesuchModelManager.getKinderWithBetreuungList();\n            });\n        };\n        VerfuegenListViewController.prototype.getKinderWithBetreuungList = function () {\n            return this.kinderWithBetreuungList;\n        };\n        VerfuegenListViewController.prototype.getMahnungList = function () {\n            return this.mahnungList;\n        };\n        /**\n         * Nur bestaetigte Betreuungen koennen geoeffnet werden\n         * @param kind\n         * @param betreuung\n         */\n        VerfuegenListViewController.prototype.openVerfuegung = function (kind, betreuung) {\n            if (this.kannVerfuegungOeffnen(betreuung)) {\n                if (kind && betreuung) {\n                    var kindIndex = this.gesuchModelManager.convertKindNumberToKindIndex(kind.kindNummer);\n                    if (kindIndex >= 0) {\n                        this.gesuchModelManager.setKindIndex(kindIndex);\n                        this.$state.go('gesuch.verfuegenView', {\n                            betreuungNumber: betreuung.betreuungNummer,\n                            kindNumber: kind.kindNummer,\n                            gesuchId: this.getGesuchId()\n                        });\n                    }\n                }\n            }\n        };\n        VerfuegenListViewController.prototype.kannVerfuegungOeffnen = function (betreuung) {\n            return this.isDetailAvailableForGesuchstatus() && this.isDetailAvailableForBetreuungstatus(betreuung.betreuungsstatus);\n        };\n        VerfuegenListViewController.prototype.isDetailAvailableForGesuchstatus = function () {\n            var isGesuchsteller = this.authServiceRs.isRole(TSRole_1.TSRole.GESUCHSTELLER);\n            //gesuchsteller hat sicher mal nur Zugriff auf verfuegungsdetail wenn das gesuch mindestens freiggeben ist\n            if (isGesuchsteller) {\n                var status = this.getGesuch() ? this.getGesuch().status : TSAntragStatus_1.TSAntragStatus.IN_BEARBEITUNG_GS;\n                return TSAntragStatus_1.isAtLeastFreigegeben(status);\n            }\n            else {\n                return true;\n            }\n        };\n        VerfuegenListViewController.prototype.isDetailAvailableForBetreuungstatus = function (betreuungsstatus) {\n            var isGesuchsteller = this.authServiceRs.isRole(TSRole_1.TSRole.GESUCHSTELLER);\n            var allowedBetstatus = [TSBetreuungsstatus_1.TSBetreuungsstatus.VERFUEGT, TSBetreuungsstatus_1.TSBetreuungsstatus.NICHT_EINGETRETEN, TSBetreuungsstatus_1.TSBetreuungsstatus.STORNIERT];\n            //Annahme: alle ausser Gesuchsteller duerfen bestaetigte betreuungen sehen wenn sie uberhaupt auf die Seite kommen\n            if (!isGesuchsteller) {\n                allowedBetstatus.push(TSBetreuungsstatus_1.TSBetreuungsstatus.BESTAETIGT);\n            }\n            return allowedBetstatus.indexOf(betreuungsstatus) !== -1;\n        };\n        /**\n         * das FinanzielleSituation PDF ist fuer den Gesuchsteller erst sichtbar sobald der Antrag den Status VERFUEGT\n         * erreicht hat\n         */\n        VerfuegenListViewController.prototype.isFinanziellesituationPDFVisible = function () {\n            var isGesuchsteller = this.authServiceRs.isRole(TSRole_1.TSRole.GESUCHSTELLER);\n            if (isGesuchsteller) {\n                var status = this.getGesuch() ? this.getGesuch().status : TSAntragStatus_1.TSAntragStatus.IN_BEARBEITUNG_GS;\n                return TSAntragStatus_1.isAnyStatusOfVerfuegt(status) && this.getGesuch().hasFSDokument;\n            }\n            return this.getGesuch().hasFSDokument;\n        };\n        VerfuegenListViewController.prototype.isBegleitschreibenVisible = function () {\n            var isGesuchsteller = this.authServiceRs.isRole(TSRole_1.TSRole.GESUCHSTELLER);\n            if (isGesuchsteller) {\n                var status = this.getGesuch() ? this.getGesuch().status : TSAntragStatus_1.TSAntragStatus.IN_BEARBEITUNG_GS;\n                return TSAntragStatus_1.isAnyStatusOfVerfuegt(status) && !this.gesuchModelManager.areThereOnlySchulamtAngebote() && !this.gesuchModelManager.areThereOnlyGeschlossenOhneVerfuegung();\n            }\n            return !this.gesuchModelManager.areThereOnlySchulamtAngebote() && !this.gesuchModelManager.areThereOnlyGeschlossenOhneVerfuegung();\n        };\n        VerfuegenListViewController.prototype.getFall = function () {\n            if (this.gesuchModelManager && this.gesuchModelManager.getGesuch()) {\n                return this.gesuchModelManager.getGesuch().fall;\n            }\n            return undefined;\n        };\n        VerfuegenListViewController.prototype.getGesuch = function () {\n            if (this.gesuchModelManager && this.gesuchModelManager.getGesuch()) {\n                return this.gesuchModelManager.getGesuch();\n            }\n            return undefined;\n        };\n        VerfuegenListViewController.prototype.getGesuchsperiode = function () {\n            if (this.gesuchModelManager) {\n                return this.gesuchModelManager.getGesuchsperiode();\n            }\n            return undefined;\n        };\n        VerfuegenListViewController.prototype.setGesuchStatusGeprueft = function () {\n            var _this = this;\n            return this.DvDialog.showDialog(removeDialogTempl, RemoveDialogController_1.RemoveDialogController, {\n                title: 'CONFIRM_GESUCH_STATUS_GEPRUEFT',\n                deleteText: 'BESCHREIBUNG_GESUCH_STATUS_WECHSELN',\n                parentController: undefined,\n                elementID: undefined\n            }).then(function () {\n                return _this.setGesuchStatus(TSAntragStatus_1.TSAntragStatus.GEPRUEFT);\n            });\n        };\n        VerfuegenListViewController.prototype.closeWithoutAngebot = function () {\n            var _this = this;\n            return this.DvDialog.showDialog(removeDialogTempl, RemoveDialogController_1.RemoveDialogController, {\n                title: 'CONFIRM_GESUCH_STATUS_KEIN_ANGEBOT',\n                deleteText: 'BESCHREIBUNG_GESUCH_STATUS_WECHSELN',\n                parentController: undefined,\n                elementID: undefined\n            }).then(function () {\n                return _this.gesuchRS.closeWithoutAngebot(_this.gesuchModelManager.getGesuch().id).then(function (response) {\n                    _this.gesuchModelManager.setGesuch(response);\n                    _this.form.$setPristine(); // nach dem es gespeichert wird, muessen wir das Form wieder auf clean setzen\n                    return _this.refreshKinderListe().then(function () {\n                        return _this.gesuchModelManager.getGesuch();\n                    });\n                });\n            });\n        };\n        VerfuegenListViewController.prototype.setGesuchStatusVerfuegen = function () {\n            var _this = this;\n            var deleteTextValue = 'BESCHREIBUNG_GESUCH_STATUS_WECHSELN';\n            if (this.gesuchModelManager.areThereOnlySchulamtAngebote()) {\n                deleteTextValue = 'BESCHREIBUNG_GESUCH_STATUS_WECHSELN_SCHULAMT';\n            }\n            return this.DvDialog.showDialog(removeDialogTempl, RemoveDialogController_1.RemoveDialogController, {\n                title: 'CONFIRM_GESUCH_STATUS_VERFUEGEN',\n                deleteText: deleteTextValue,\n                parentController: undefined,\n                elementID: undefined\n            }).then(function () {\n                return _this.gesuchRS.verfuegenStarten(_this.gesuchModelManager.getGesuch().id, _this.gesuchModelManager.getGesuch().hasFSDokument).then(function (response) {\n                    if (response.status === TSAntragStatus_1.TSAntragStatus.NUR_SCHULAMT) {\n                        // If AntragStatus==NUR_SCHULAMT the Sachbearbeiter_JA has no rights to work with or even to see this gesuch any more\n                        // For this reason we have to navigate directly out of the gesuch once it has been saved. We navigate to the\n                        // default start page for the current role.\n                        // createNeededPDFs is not being called for the same reason. Anyway, the Gesuch vanishes for the role JA and is only\n                        // available for the role SCHULAMT, so JA doesn't need the PDFs to be created. When a Schulamt worker opens this Gesuch,\n                        // she can generate the PDFs by clicking on the corresponding links\n                        AuthenticationUtil_1.default.navigateToStartPageForRole(_this.authServiceRs.getPrincipal(), _this.$state);\n                        return _this.gesuchModelManager.getGesuch();\n                    }\n                    else {\n                        _this.gesuchModelManager.setGesuch(response);\n                        _this.form.$setPristine(); // nach dem es gespeichert wird, muessen wir das Form wieder auf clean setzen\n                        return _this.refreshKinderListe().then(function () {\n                            return _this.gesuchModelManager.getGesuch();\n                        });\n                    }\n                });\n            });\n        };\n        VerfuegenListViewController.prototype.hasOffeneMahnungen = function () {\n            for (var _i = 0, _a = this.mahnungList; _i < _a.length; _i++) {\n                var mahn = _a[_i];\n                if (!mahn.timestampAbgeschlossen) {\n                    return true;\n                }\n            }\n            return false;\n        };\n        VerfuegenListViewController.prototype.sendToSteuerverwaltung = function () {\n            var _this = this;\n            this.DvDialog.showDialog(bemerkungDialogTempl, BemerkungenDialogController_1.BemerkungenDialogController, {\n                title: 'SEND_TO_STV_CONFIRMATION',\n                bemerkungen: this.gesuchModelManager.getGesuch().bemerkungenSTV\n            }).then(function (bemerkung) {\n                _this.gesuchRS.sendGesuchToSTV(_this.getGesuch().id, bemerkung).then(function (gesuch) {\n                    _this.gesuchModelManager.setGesuch(gesuch);\n                });\n            });\n        };\n        VerfuegenListViewController.prototype.showSendToSteuerverwaltung = function () {\n            //hier wird extra nur \"VERFUEGT\" gestestet statt alle verfuegten status weil das Schulamt das Gesuch nicht pruefen lassen darf\n            return this.gesuchModelManager.isGesuchStatus(TSAntragStatus_1.TSAntragStatus.VERFUEGT) && !this.getGesuch().gesperrtWegenBeschwerde;\n        };\n        VerfuegenListViewController.prototype.stvPruefungAbschliessen = function () {\n            var _this = this;\n            this.DvDialog.showDialog(removeDialogTempl, RemoveDialogController_1.RemoveDialogController, {\n                title: 'STV_PRUEFUNG_ABSCHLIESSEN_CONFIRMATION',\n                deleteText: '',\n                parentController: undefined,\n                elementID: undefined\n            }).then(function (bemerkung) {\n                _this.gesuchRS.stvPruefungAbschliessen(_this.getGesuch().id).then(function (gesuch) {\n                    _this.gesuchModelManager.setGesuch(gesuch);\n                });\n            });\n        };\n        VerfuegenListViewController.prototype.showSTVPruefungAbschliessen = function () {\n            return this.gesuchModelManager.isGesuchStatus(TSAntragStatus_1.TSAntragStatus.GEPRUEFT_STV) && !this.getGesuch().gesperrtWegenBeschwerde;\n        };\n        VerfuegenListViewController.prototype.showErsteMahnungErstellen = function () {\n            // Nur wenn keine offenen Mahnungen vorhanden!\n            return (this.gesuchModelManager.isGesuchStatus(TSAntragStatus_1.TSAntragStatus.IN_BEARBEITUNG_JA) || this.gesuchModelManager.isGesuchStatus(TSAntragStatus_1.TSAntragStatus.FREIGEGEBEN))\n                && this.mahnung === undefined && !this.hasOffeneMahnungen() && !this.isGesuchReadonly();\n        };\n        VerfuegenListViewController.prototype.showErsteMahnungAusloesen = function () {\n            return this.mahnung !== undefined && this.mahnung.mahnungTyp === TSMahnungTyp_1.TSMahnungTyp.ERSTE_MAHNUNG\n                && !this.isGesuchReadonly();\n        };\n        VerfuegenListViewController.prototype.showZweiteMahnungErstellen = function () {\n            return this.gesuchModelManager.isGesuchStatus(TSAntragStatus_1.TSAntragStatus.ERSTE_MAHNUNG_ABGELAUFEN)\n                && this.mahnung === undefined && !this.isGesuchReadonly();\n        };\n        VerfuegenListViewController.prototype.showZweiteMahnungAusloesen = function () {\n            return this.mahnung !== undefined && this.mahnung.mahnungTyp === TSMahnungTyp_1.TSMahnungTyp.ZWEITE_MAHNUNG\n                && !this.isGesuchReadonly();\n        };\n        VerfuegenListViewController.prototype.showMahnlaufBeenden = function () {\n            return TSAntragStatus_1.isAnyStatusOfMahnung(this.getGesuch().status) && !this.isGesuchReadonly();\n        };\n        VerfuegenListViewController.prototype.showDokumenteNichtKomplett = function () {\n            return TSAntragStatus_1.isAnyStatusOfMahnung(this.getGesuch().status) && this.getGesuch().dokumenteHochgeladen\n                && !this.isGesuchReadonly();\n        };\n        VerfuegenListViewController.prototype.showZweiteMahnungNichtEingetreten = function () {\n            return this.gesuchModelManager.isGesuchStatus(TSAntragStatus_1.TSAntragStatus.ZWEITE_MAHNUNG_ABGELAUFEN) && !this.isGesuchReadonly();\n        };\n        VerfuegenListViewController.prototype.ersteMahnungErstellen = function () {\n            this.tempAntragStatus = TSAntragStatus_1.TSAntragStatus.ERSTE_MAHNUNG;\n            this.createMahnung(TSMahnungTyp_1.TSMahnungTyp.ERSTE_MAHNUNG);\n        };\n        VerfuegenListViewController.prototype.zweiteMahnungErstellen = function () {\n            this.tempAntragStatus = TSAntragStatus_1.TSAntragStatus.ZWEITE_MAHNUNG;\n            this.createMahnung(TSMahnungTyp_1.TSMahnungTyp.ZWEITE_MAHNUNG);\n        };\n        VerfuegenListViewController.prototype.saveMahnung = function () {\n            var _this = this;\n            if (this.form.$valid) {\n                this.mahnungRS.saveMahnung(this.mahnung).then(function (mahnungResponse) {\n                    _this.setGesuchStatus(_this.tempAntragStatus).then(function (any) {\n                        _this.mahnungList.push(mahnungResponse);\n                        _this.tempAntragStatus = undefined;\n                        _this.mahnung = undefined;\n                    });\n                });\n            }\n        };\n        VerfuegenListViewController.prototype.createMahnung = function (typ) {\n            var _this = this;\n            return this.mahnungRS.getInitialeBemerkungen(this.getGesuch()).then(function (generatedBemerkungen) {\n                _this.mahnung = new TSMahnung_1.default();\n                _this.mahnung.mahnungTyp = typ;\n                _this.mahnung.gesuch = _this.getGesuch();\n                _this.mahnung.timestampAbgeschlossen = null;\n                _this.mahnung.bemerkungen = generatedBemerkungen.data;\n                return;\n            });\n        };\n        VerfuegenListViewController.prototype.mahnlaufBeenden = function () {\n            var _this = this;\n            // Gesuchstatus zuruecksetzen UND die Mahnungen auf erledigt setzen\n            this.mahnungRS.mahnlaufBeenden(this.getGesuch()).then(function (gesuch) {\n                _this.mahnungRS.findMahnungen(_this.getGesuch().id).then(function (reloadedMahnungen) {\n                    _this.mahnungList = reloadedMahnungen;\n                    _this.gesuchModelManager.getGesuch().status = TSAntragStatus_1.TSAntragStatus.IN_BEARBEITUNG_JA;\n                });\n            });\n        };\n        VerfuegenListViewController.prototype.dokumenteNichtKomplett = function () {\n            this.gesuchModelManager.getGesuch().dokumenteHochgeladen = false;\n            this.gesuchModelManager.updateGesuch();\n        };\n        VerfuegenListViewController.prototype.zweiteMahnungNichtEingetreten = function () {\n            // Auf die zweite Mahnung wurde nicht reagiert. Den Status des Gesuchs wieder auf IN_BEARBEITUNG setzen\n            // damit die Betreuungen auf NICHT_EINGETRETEN verfügt werden können. Die Mahnungen bleiben aber offen!\n            this.setGesuchStatus(TSAntragStatus_1.TSAntragStatus.IN_BEARBEITUNG_JA);\n        };\n        /**\n         * Der Button Geprueft wird nur beim Status IN_BEARBEITUNG_JA eingeblendet\n         * @returns {boolean}\n         */\n        VerfuegenListViewController.prototype.showGeprueft = function () {\n            return (this.gesuchModelManager.isGesuchStatus(TSAntragStatus_1.TSAntragStatus.IN_BEARBEITUNG_JA) || this.gesuchModelManager.isGesuchStatus(TSAntragStatus_1.TSAntragStatus.FREIGEGEBEN))\n                && this.wizardStepManager.areAllStepsOK(this.getGesuch()) && this.mahnung === undefined && !this.isGesuchReadonly();\n        };\n        /**\n         * Der Button Verfuegung starten wird angezeigt, wenn alle Betreuungen bestaetigt und das Gesuch geprueft wurden\n         * @returns {boolean}\n         */\n        VerfuegenListViewController.prototype.showVerfuegenStarten = function () {\n            return this.gesuchModelManager.isGesuchStatus(TSAntragStatus_1.TSAntragStatus.GEPRUEFT)\n                && this.wizardStepManager.isStepStatusOk(TSWizardStepName_1.TSWizardStepName.BETREUUNG)\n                && this.gesuchModelManager.getGesuch().isThereAnyBetreuung()\n                && !this.isGesuchReadonly();\n            // && this.gesuchModelManager.getGesuch().status !== TSAntragStatus.VERFUEGEN;\n        };\n        /**\n         * Nur wenn ein Gesuch keine Angebote hat und geprueft ist, kann man es ohne Angebote schliessen.\n         */\n        VerfuegenListViewController.prototype.showCloseWithoutAngebot = function () {\n            return this.gesuchModelManager.isGesuchStatus(TSAntragStatus_1.TSAntragStatus.GEPRUEFT)\n                && !this.gesuchModelManager.getGesuch().isThereAnyBetreuung()\n                && !this.isGesuchReadonly();\n        };\n        VerfuegenListViewController.prototype.openFinanzielleSituationPDF = function () {\n            var _this = this;\n            var win = this.downloadRS.prepareDownloadWindow();\n            this.downloadRS.getFinSitDokumentAccessTokenGeneratedDokument(this.gesuchModelManager.getGesuch().id)\n                .then(function (downloadFile) {\n                _this.$log.debug('accessToken: ' + downloadFile.accessToken);\n                _this.downloadRS.startDownload(downloadFile.accessToken, downloadFile.filename, false, win);\n            })\n                .catch(function (ex) {\n                win.close();\n                _this.$log.error('An error occurred downloading the document, closing download window.');\n            });\n        };\n        VerfuegenListViewController.prototype.openBegleitschreibenPDF = function () {\n            var _this = this;\n            var win = this.downloadRS.prepareDownloadWindow();\n            this.downloadRS.getBegleitschreibenDokumentAccessTokenGeneratedDokument(this.gesuchModelManager.getGesuch().id, false)\n                .then(function (downloadFile) {\n                _this.$log.debug('accessToken: ' + downloadFile.accessToken);\n                _this.downloadRS.startDownload(downloadFile.accessToken, downloadFile.filename, false, win);\n            })\n                .catch(function (ex) {\n                win.close();\n                _this.$log.error('An error occurred downloading the document, closing download window.');\n            });\n        };\n        VerfuegenListViewController.prototype.openMahnungPDF = function (mahnung) {\n            var _this = this;\n            var win = this.downloadRS.prepareDownloadWindow();\n            if (mahnung == null) {\n                mahnung = this.mahnung;\n            }\n            this.downloadRS.getAccessTokenMahnungGeneratedDokument(mahnung)\n                .then(function (downloadFile) {\n                _this.$log.debug('accessToken: ' + downloadFile.accessToken);\n                _this.downloadRS.startDownload(downloadFile.accessToken, downloadFile.filename, false, win);\n            })\n                .catch(function (ex) {\n                win.close();\n                _this.$log.error('An error occurred downloading the document, closing download window.');\n            });\n        };\n        VerfuegenListViewController.prototype.showBeschwerdeHaengig = function () {\n            var status = this.getGesuch() ? this.getGesuch().status : TSAntragStatus_1.TSAntragStatus.IN_BEARBEITUNG_GS;\n            // Schulamt Status duerfen keine Beschwerde starten\n            return TSAntragStatus_1.isAnyStatusOfVerfuegtButSchulamt(status) && !this.getGesuch().gesperrtWegenBeschwerde;\n        };\n        VerfuegenListViewController.prototype.showBeschwerdeAbschliessen = function () {\n            var status = this.getGesuch() ? this.getGesuch().status : TSAntragStatus_1.TSAntragStatus.IN_BEARBEITUNG_GS;\n            return TSAntragStatus_1.TSAntragStatus.BESCHWERDE_HAENGIG === status;\n        };\n        VerfuegenListViewController.prototype.setGesuchStatusBeschwerdeHaengig = function () {\n            var _this = this;\n            return this.DvDialog.showDialog(removeDialogTempl, RemoveDialogController_1.RemoveDialogController, {\n                title: 'BESCHWERDE_HAENGIG',\n                deleteText: 'BESCHREIBUNG_GESUCH_BESCHWERDE_HAENGIG',\n                parentController: undefined,\n                elementID: undefined\n            }).then(function () {\n                return _this.gesuchRS.setBeschwerdeHaengig(_this.getGesuch().id).then(function (gesuch) {\n                    _this.gesuchModelManager.setGesuch(gesuch);\n                    return _this.gesuchModelManager.getGesuch();\n                });\n            });\n        };\n        VerfuegenListViewController.prototype.setGesuchStatusBeschwerdeAbschliessen = function () {\n            var _this = this;\n            return this.DvDialog.showDialog(removeDialogTempl, RemoveDialogController_1.RemoveDialogController, {\n                title: 'BESCHWERDE_ABSCHLIESSEN',\n                deleteText: 'BESCHREIBUNG_GESUCH_BESCHWERDE_ABSCHLIESSEN',\n                parentController: undefined,\n                elementID: undefined\n            }).then(function () {\n                return _this.gesuchRS.removeBeschwerdeHaengig(_this.getGesuch().id).then(function (gesuch) {\n                    _this.gesuchModelManager.setGesuch(gesuch);\n                    return _this.gesuchModelManager.getGesuch();\n                });\n            });\n        };\n        VerfuegenListViewController.prototype.fsDokumentChanged = function () {\n            // dirty checker wird hier ausgeschaltet. Aenderungen des fs flag wird automatisch gespeichert wenn gesuch auf geprüft gesetzt wird\n            // Aus performance Gründen wird hier daruf verzichtet das Gesuch neu zu persisten, nur weil das Flag ändert.\n            this.form.$setPristine();\n        };\n        VerfuegenListViewController.prototype.isSuperAdmin = function () {\n            return this.authServiceRs.isRole(TSRole_1.TSRole.SUPER_ADMIN);\n        };\n        VerfuegenListViewController.prototype.$postLink = function () {\n            this.$timeout(function () {\n                EbeguUtil_1.default.selectFirst();\n            }, 500);\n        };\n        VerfuegenListViewController.$inject = ['$state', 'GesuchModelManager', 'BerechnungsManager', 'EbeguUtil', 'WizardStepManager',\n            'DvDialog', 'DownloadRS', 'MahnungRS', '$log', 'AuthServiceRS', '$scope', 'GesuchRS', '$timeout'];\n        return VerfuegenListViewController;\n    }(abstractGesuchView_1.default));\n    exports.VerfuegenListViewController = VerfuegenListViewController;\n});\n",{"version":3,"file":"/home/imanol/projects/ebegu/ebegu-web/src/gesuch/component/verfuegenListView/verfuegenListView.ts","sourceRoot":"","sources":["/home/imanol/projects/ebegu/ebegu-web/src/gesuch/component/verfuegenListView/verfuegenListView.ts"],"names":[],"mappings":"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","sourcesContent":["/*\n * Ki-Tax: System for the management of external childcare subsidies\n * Copyright (C) 2017 City of Bern Switzerland\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport {IComponentOptions, ILogService, IPromise, IScope} from 'angular';\nimport AbstractGesuchViewController from '../abstractGesuchView';\nimport GesuchModelManager from '../../service/gesuchModelManager';\nimport {IStateService} from 'angular-ui-router';\nimport TSBetreuung from '../../../models/TSBetreuung';\nimport TSKindContainer from '../../../models/TSKindContainer';\nimport EbeguUtil from '../../../utils/EbeguUtil';\nimport BerechnungsManager from '../../service/berechnungsManager';\nimport WizardStepManager from '../../service/wizardStepManager';\nimport {TSWizardStepName} from '../../../models/enums/TSWizardStepName';\nimport {TSWizardStepStatus} from '../../../models/enums/TSWizardStepStatus';\nimport {\n    isAnyStatusOfMahnung,\n    isAnyStatusOfVerfuegt,\n    isAnyStatusOfVerfuegtButSchulamt,\n    isAtLeastFreigegeben,\n    TSAntragStatus\n} from '../../../models/enums/TSAntragStatus';\nimport {DvDialog} from '../../../core/directive/dv-dialog/dv-dialog';\nimport {RemoveDialogController} from '../../dialog/RemoveDialogController';\nimport {TSBetreuungsstatus} from '../../../models/enums/TSBetreuungsstatus';\nimport {DownloadRS} from '../../../core/service/downloadRS.rest';\nimport TSDownloadFile from '../../../models/TSDownloadFile';\nimport TSMahnung from '../../../models/TSMahnung';\nimport {TSMahnungTyp} from '../../../models/enums/TSMahnungTyp';\nimport MahnungRS from '../../service/mahnungRS.rest';\nimport TSGesuch from '../../../models/TSGesuch';\nimport TSGesuchsperiode from '../../../models/TSGesuchsperiode';\nimport AuthServiceRS from '../../../authentication/service/AuthServiceRS.rest';\nimport {TSRole} from '../../../models/enums/TSRole';\nimport GesuchRS from '../../service/gesuchRS.rest';\nimport {BemerkungenDialogController} from '../../dialog/BemerkungenDialogController';\nimport AuthenticationUtil from '../../../utils/AuthenticationUtil';\nimport ITimeoutService = angular.ITimeoutService;\n\nlet template = require('./verfuegenListView.html');\nrequire('./verfuegenListView.less');\nlet removeDialogTempl = require('../../dialog/removeDialogTemplate.html');\nlet bemerkungDialogTempl = require('../../dialog/bemerkungenDialogTemplate.html');\n\n\nexport class VerfuegenListViewComponentConfig implements IComponentOptions {\n    transclude = false;\n    bindings: any = {\n        // Bereits vorhandene Mahnungen\n        mahnungList: '<'\n    };\n    template = template;\n    controller = VerfuegenListViewController;\n    controllerAs = 'vm';\n}\n\nexport class VerfuegenListViewController extends AbstractGesuchViewController<any> {\n\n    private kinderWithBetreuungList: Array<TSKindContainer>;\n    mahnungList: TSMahnung[];\n    private mahnung: TSMahnung;\n    private tempAntragStatus: TSAntragStatus;\n\n    static $inject: string[] = ['$state', 'GesuchModelManager', 'BerechnungsManager', 'EbeguUtil', 'WizardStepManager',\n        'DvDialog', 'DownloadRS', 'MahnungRS', '$log', 'AuthServiceRS', '$scope', 'GesuchRS', '$timeout'];\n\n    /* @ngInject */\n\n    constructor(private $state: IStateService, gesuchModelManager: GesuchModelManager, berechnungsManager: BerechnungsManager,\n                private ebeguUtil: EbeguUtil, wizardStepManager: WizardStepManager, private DvDialog: DvDialog,\n                private downloadRS: DownloadRS, private mahnungRS: MahnungRS, private $log: ILogService,\n                private authServiceRs: AuthServiceRS, $scope: IScope, private gesuchRS: GesuchRS,\n                $timeout: ITimeoutService) {\n\n        super(gesuchModelManager, berechnungsManager, wizardStepManager, $scope, TSWizardStepName.VERFUEGEN, $timeout);\n        this.initViewModel();\n    }\n\n    /**\n     * Die finanzielle Situation und die Einkommensverschlechterungen muessen mithilfe des Berechnungsmanagers\n     * berechnet werden, um manche Daten zur Verfügung zu haben. Das ist notwendig weil die finanzielle Situation nicht\n     * gespeichert wird. D.H. das erste Mal in einer Sitzung wenn ein Gesuch geoeffnet wird, ist gar nichts berechnet.\n     * Wenn man dann die Verfügen direkt aufmacht, ist alles leer und wird nichts angezeigt, deswegen muss alles auch\n     * hier berechnet werden. Um Probleme mit der Performance zu vermeiden, wird zuerst geprueft, ob die Berechnung\n     * schon vorher gemacht wurde, wenn ja dann wird sie einfach verwendet ohne sie neu berechnen zu muessen. Dieses\n     * geht aber davon aus, dass die Berechnungen immer richtig kalkuliert wurden.\n     *\n     * Die Verfuegungen werden IMMER geladen, wenn diese View geladen wird. Dieses ist etwas ineffizient. Allerdings\n     * muss es eigentlich so funktionieren, weil die Daten sich haben aendern koennen. Es ist ein aehnlicher Fall wie\n     * mit der finanziellen Situation. Sollte es Probleme mit der Performance geben, muessen wir ueberlegen, ob wir es\n     * irgendwie anders berechnen koennen um den Server zu entlasten.\n     */\n    private initViewModel(): void {\n        this.wizardStepManager.updateCurrentWizardStepStatus(TSWizardStepStatus.WARTEN);\n\n        //Berechnung aller finanziellen Daten\n        if (!this.berechnungsManager.finanzielleSituationResultate) {\n            this.berechnungsManager.calculateFinanzielleSituation(this.gesuchModelManager.getGesuch()); //.then(() => {});\n        }\n        if (this.gesuchModelManager.getGesuch() && this.gesuchModelManager.getGesuch().extractEinkommensverschlechterungInfo()\n            && this.gesuchModelManager.getGesuch().extractEinkommensverschlechterungInfo().ekvFuerBasisJahrPlus1\n            && !this.berechnungsManager.einkommensverschlechterungResultateBjP1) {\n\n            this.berechnungsManager.calculateEinkommensverschlechterung(this.gesuchModelManager.getGesuch(), 1); //.then(() => {});\n        }\n        if (this.gesuchModelManager.getGesuch() && this.gesuchModelManager.getGesuch().extractEinkommensverschlechterungInfo()\n            && this.gesuchModelManager.getGesuch().extractEinkommensverschlechterungInfo().ekvFuerBasisJahrPlus2\n            && !this.berechnungsManager.einkommensverschlechterungResultateBjP2) {\n\n            this.berechnungsManager.calculateEinkommensverschlechterung(this.gesuchModelManager.getGesuch(), 2); //.then(() => {});\n        }\n        this.refreshKinderListe();\n    }\n\n    private refreshKinderListe(): IPromise<any> {\n        return this.gesuchModelManager.calculateVerfuegungen().then(() => {\n            this.kinderWithBetreuungList = this.gesuchModelManager.getKinderWithBetreuungList();\n        });\n    }\n\n    public getKinderWithBetreuungList(): Array<TSKindContainer> {\n        return this.kinderWithBetreuungList;\n    }\n\n    public getMahnungList(): Array<TSMahnung> {\n        return this.mahnungList;\n    }\n\n    /**\n     * Nur bestaetigte Betreuungen koennen geoeffnet werden\n     * @param kind\n     * @param betreuung\n     */\n    public openVerfuegung(kind: TSKindContainer, betreuung: TSBetreuung): void {\n        if (this.kannVerfuegungOeffnen(betreuung)) {\n            if (kind && betreuung) {\n                let kindIndex: number = this.gesuchModelManager.convertKindNumberToKindIndex(kind.kindNummer);\n                if (kindIndex >= 0) {\n                    this.gesuchModelManager.setKindIndex(kindIndex);\n                    this.$state.go('gesuch.verfuegenView', {\n                        betreuungNumber: betreuung.betreuungNummer,\n                        kindNumber: kind.kindNummer,\n                        gesuchId: this.getGesuchId()\n                    });\n                }\n            }\n        }\n    }\n\n    public kannVerfuegungOeffnen(betreuung: TSBetreuung): boolean {\n        return this.isDetailAvailableForGesuchstatus() && this.isDetailAvailableForBetreuungstatus(betreuung.betreuungsstatus);\n    }\n\n    private isDetailAvailableForGesuchstatus(): boolean {\n        let isGesuchsteller: boolean = this.authServiceRs.isRole(TSRole.GESUCHSTELLER);\n        //gesuchsteller hat sicher mal nur Zugriff auf verfuegungsdetail wenn das gesuch mindestens freiggeben ist\n        if (isGesuchsteller) {\n            let status: TSAntragStatus = this.getGesuch() ? this.getGesuch().status : TSAntragStatus.IN_BEARBEITUNG_GS;\n            return isAtLeastFreigegeben(status);\n        } else {\n            return true;\n        }\n    }\n\n    private isDetailAvailableForBetreuungstatus(betreuungsstatus: TSBetreuungsstatus): boolean {\n        let isGesuchsteller: boolean = this.authServiceRs.isRole(TSRole.GESUCHSTELLER);\n        let allowedBetstatus: Array<TSBetreuungsstatus> = [TSBetreuungsstatus.VERFUEGT, TSBetreuungsstatus.NICHT_EINGETRETEN, TSBetreuungsstatus.STORNIERT];\n        //Annahme: alle ausser Gesuchsteller duerfen bestaetigte betreuungen sehen wenn sie uberhaupt auf die Seite kommen\n        if (!isGesuchsteller) {\n            allowedBetstatus.push(TSBetreuungsstatus.BESTAETIGT);\n        }\n        return allowedBetstatus.indexOf(betreuungsstatus) !== -1;\n    }\n\n    /**\n     * das FinanzielleSituation PDF ist fuer den Gesuchsteller erst sichtbar sobald der Antrag den Status VERFUEGT\n     * erreicht hat\n     */\n    public isFinanziellesituationPDFVisible(): boolean {\n        let isGesuchsteller: boolean = this.authServiceRs.isRole(TSRole.GESUCHSTELLER);\n        if (isGesuchsteller) {\n            let status: TSAntragStatus = this.getGesuch() ? this.getGesuch().status : TSAntragStatus.IN_BEARBEITUNG_GS;\n            return isAnyStatusOfVerfuegt(status) && this.getGesuch().hasFSDokument;\n        }\n        return this.getGesuch().hasFSDokument;\n\n    }\n\n    public isBegleitschreibenVisible(): boolean {\n        let isGesuchsteller: boolean = this.authServiceRs.isRole(TSRole.GESUCHSTELLER);\n        if (isGesuchsteller) {\n            let status: TSAntragStatus = this.getGesuch() ? this.getGesuch().status : TSAntragStatus.IN_BEARBEITUNG_GS;\n            return isAnyStatusOfVerfuegt(status) && !this.gesuchModelManager.areThereOnlySchulamtAngebote() && !this.gesuchModelManager.areThereOnlyGeschlossenOhneVerfuegung();\n        }\n        return !this.gesuchModelManager.areThereOnlySchulamtAngebote() && !this.gesuchModelManager.areThereOnlyGeschlossenOhneVerfuegung();\n    }\n\n    public getFall() {\n        if (this.gesuchModelManager && this.gesuchModelManager.getGesuch()) {\n            return this.gesuchModelManager.getGesuch().fall;\n        }\n        return undefined;\n    }\n\n    public getGesuch(): TSGesuch {\n        if (this.gesuchModelManager && this.gesuchModelManager.getGesuch()) {\n            return this.gesuchModelManager.getGesuch();\n        }\n        return undefined;\n    }\n\n    public getGesuchsperiode(): TSGesuchsperiode {\n        if (this.gesuchModelManager) {\n            return this.gesuchModelManager.getGesuchsperiode();\n        }\n        return undefined;\n    }\n\n    public setGesuchStatusGeprueft(): IPromise<TSAntragStatus> {\n        return this.DvDialog.showDialog(removeDialogTempl, RemoveDialogController, {\n            title: 'CONFIRM_GESUCH_STATUS_GEPRUEFT',\n            deleteText: 'BESCHREIBUNG_GESUCH_STATUS_WECHSELN',\n            parentController: undefined,\n            elementID: undefined\n        }).then(() => {\n            return this.setGesuchStatus(TSAntragStatus.GEPRUEFT);\n        });\n    }\n\n    public closeWithoutAngebot(): IPromise<TSGesuch> {\n        return this.DvDialog.showDialog(removeDialogTempl, RemoveDialogController, {\n            title: 'CONFIRM_GESUCH_STATUS_KEIN_ANGEBOT',\n            deleteText: 'BESCHREIBUNG_GESUCH_STATUS_WECHSELN',\n            parentController: undefined,\n            elementID: undefined\n\n        }).then(() => {\n            return this.gesuchRS.closeWithoutAngebot(this.gesuchModelManager.getGesuch().id).then((response) => {  // muss gespeichert werden um hasfsdokument zu aktualisieren\n                this.gesuchModelManager.setGesuch(response);\n                this.form.$setPristine(); // nach dem es gespeichert wird, muessen wir das Form wieder auf clean setzen\n                return this.refreshKinderListe().then(() => {\n                    return this.gesuchModelManager.getGesuch();\n                });\n            });\n        });\n    }\n\n    public setGesuchStatusVerfuegen(): IPromise<TSGesuch> {\n        let deleteTextValue: string = 'BESCHREIBUNG_GESUCH_STATUS_WECHSELN';\n        if (this.gesuchModelManager.areThereOnlySchulamtAngebote()) {\n            deleteTextValue = 'BESCHREIBUNG_GESUCH_STATUS_WECHSELN_SCHULAMT';\n        }\n        return this.DvDialog.showDialog(removeDialogTempl, RemoveDialogController, {\n            title: 'CONFIRM_GESUCH_STATUS_VERFUEGEN',\n            deleteText: deleteTextValue,\n            parentController: undefined,\n            elementID: undefined\n        }).then(() => {\n\n            return this.gesuchRS.verfuegenStarten(\n                this.gesuchModelManager.getGesuch().id, this.gesuchModelManager.getGesuch().hasFSDokument).then((response) => {  // muss gespeichert werden um hasfsdokument zu aktualisieren\n                if (response.status === TSAntragStatus.NUR_SCHULAMT) {\n                    // If AntragStatus==NUR_SCHULAMT the Sachbearbeiter_JA has no rights to work with or even to see this gesuch any more\n                    // For this reason we have to navigate directly out of the gesuch once it has been saved. We navigate to the\n                    // default start page for the current role.\n                    // createNeededPDFs is not being called for the same reason. Anyway, the Gesuch vanishes for the role JA and is only\n                    // available for the role SCHULAMT, so JA doesn't need the PDFs to be created. When a Schulamt worker opens this Gesuch,\n                    // she can generate the PDFs by clicking on the corresponding links\n                    AuthenticationUtil.navigateToStartPageForRole(this.authServiceRs.getPrincipal(), this.$state);\n                    return this.gesuchModelManager.getGesuch();\n                } else { // for NUR_SCHULAMT this makes no sense\n                    this.gesuchModelManager.setGesuch(response);\n                    this.form.$setPristine(); // nach dem es gespeichert wird, muessen wir das Form wieder auf clean setzen\n                    return this.refreshKinderListe().then(() => {\n                        return this.gesuchModelManager.getGesuch();\n                    });\n                }\n            });\n        });\n    }\n\n    private hasOffeneMahnungen(): boolean {\n        for (let mahn of this.mahnungList) {\n            if (!mahn.timestampAbgeschlossen) {\n                return true;\n            }\n        }\n        return false;\n    }\n\n    public sendToSteuerverwaltung(): void {\n        this.DvDialog.showDialog(bemerkungDialogTempl, BemerkungenDialogController, {\n            title: 'SEND_TO_STV_CONFIRMATION',\n            bemerkungen: this.gesuchModelManager.getGesuch().bemerkungenSTV\n        }).then((bemerkung: string) => {\n            this.gesuchRS.sendGesuchToSTV(this.getGesuch().id, bemerkung).then((gesuch: TSGesuch) => {\n                this.gesuchModelManager.setGesuch(gesuch);\n            });\n        });\n    }\n\n    public showSendToSteuerverwaltung(): boolean {\n        //hier wird extra nur \"VERFUEGT\" gestestet statt alle verfuegten status weil das Schulamt das Gesuch nicht pruefen lassen darf\n        return this.gesuchModelManager.isGesuchStatus(TSAntragStatus.VERFUEGT) && !this.getGesuch().gesperrtWegenBeschwerde;\n    }\n\n    public stvPruefungAbschliessen(): void {\n        this.DvDialog.showDialog(removeDialogTempl, RemoveDialogController, {\n            title: 'STV_PRUEFUNG_ABSCHLIESSEN_CONFIRMATION',\n            deleteText: '',\n            parentController: undefined,\n            elementID: undefined\n        }).then((bemerkung: string) => {\n            this.gesuchRS.stvPruefungAbschliessen(this.getGesuch().id).then((gesuch: TSGesuch) => {\n                this.gesuchModelManager.setGesuch(gesuch);\n            });\n        });\n    }\n\n    public showSTVPruefungAbschliessen(): boolean {\n        return this.gesuchModelManager.isGesuchStatus(TSAntragStatus.GEPRUEFT_STV) && !this.getGesuch().gesperrtWegenBeschwerde;\n    }\n\n    public showErsteMahnungErstellen(): boolean {\n        // Nur wenn keine offenen Mahnungen vorhanden!\n        return (this.gesuchModelManager.isGesuchStatus(TSAntragStatus.IN_BEARBEITUNG_JA) || this.gesuchModelManager.isGesuchStatus(TSAntragStatus.FREIGEGEBEN))\n            && this.mahnung === undefined && !this.hasOffeneMahnungen() && !this.isGesuchReadonly();\n    }\n\n    public showErsteMahnungAusloesen(): boolean {\n        return this.mahnung !== undefined && this.mahnung.mahnungTyp === TSMahnungTyp.ERSTE_MAHNUNG\n            && !this.isGesuchReadonly();\n    }\n\n    public showZweiteMahnungErstellen(): boolean {\n        return this.gesuchModelManager.isGesuchStatus(TSAntragStatus.ERSTE_MAHNUNG_ABGELAUFEN)\n            && this.mahnung === undefined && !this.isGesuchReadonly();\n    }\n\n    public showZweiteMahnungAusloesen(): boolean {\n        return this.mahnung !== undefined && this.mahnung.mahnungTyp === TSMahnungTyp.ZWEITE_MAHNUNG\n            && !this.isGesuchReadonly();\n    }\n\n    public showMahnlaufBeenden(): boolean {\n        return isAnyStatusOfMahnung(this.getGesuch().status) && !this.isGesuchReadonly();\n    }\n\n    public showDokumenteNichtKomplett(): boolean {\n        return isAnyStatusOfMahnung(this.getGesuch().status) && this.getGesuch().dokumenteHochgeladen\n            && !this.isGesuchReadonly();\n    }\n\n    public showZweiteMahnungNichtEingetreten(): boolean {\n        return this.gesuchModelManager.isGesuchStatus(TSAntragStatus.ZWEITE_MAHNUNG_ABGELAUFEN) && !this.isGesuchReadonly();\n    }\n\n    public ersteMahnungErstellen(): void {\n        this.tempAntragStatus = TSAntragStatus.ERSTE_MAHNUNG;\n        this.createMahnung(TSMahnungTyp.ERSTE_MAHNUNG);\n    }\n\n    public zweiteMahnungErstellen(): void {\n        this.tempAntragStatus = TSAntragStatus.ZWEITE_MAHNUNG;\n        this.createMahnung(TSMahnungTyp.ZWEITE_MAHNUNG);\n    }\n\n    public saveMahnung(): void {\n        if (this.form.$valid) {\n            this.mahnungRS.saveMahnung(this.mahnung).then((mahnungResponse: TSMahnung) => {\n                this.setGesuchStatus(this.tempAntragStatus).then(any => {\n                    this.mahnungList.push(mahnungResponse);\n                    this.tempAntragStatus = undefined;\n                    this.mahnung = undefined;\n                });\n            });\n        }\n    }\n\n    private createMahnung(typ: TSMahnungTyp): IPromise<any> {\n        return this.mahnungRS.getInitialeBemerkungen(this.getGesuch()).then(generatedBemerkungen => {\n            this.mahnung = new TSMahnung();\n            this.mahnung.mahnungTyp = typ;\n            this.mahnung.gesuch = this.getGesuch();\n            this.mahnung.timestampAbgeschlossen = null;\n            this.mahnung.bemerkungen = generatedBemerkungen.data;\n            return;\n        });\n    }\n\n    public mahnlaufBeenden(): void {\n        // Gesuchstatus zuruecksetzen UND die Mahnungen auf erledigt setzen\n        this.mahnungRS.mahnlaufBeenden(this.getGesuch()).then((gesuch: TSGesuch) => {\n            this.mahnungRS.findMahnungen(this.getGesuch().id).then(reloadedMahnungen => {\n                this.mahnungList = reloadedMahnungen;\n                this.gesuchModelManager.getGesuch().status = TSAntragStatus.IN_BEARBEITUNG_JA;\n            });\n        });\n    }\n\n    public dokumenteNichtKomplett(): void {\n        this.gesuchModelManager.getGesuch().dokumenteHochgeladen = false;\n        this.gesuchModelManager.updateGesuch();\n    }\n\n    public zweiteMahnungNichtEingetreten(): void {\n        // Auf die zweite Mahnung wurde nicht reagiert. Den Status des Gesuchs wieder auf IN_BEARBEITUNG setzen\n        // damit die Betreuungen auf NICHT_EINGETRETEN verfügt werden können. Die Mahnungen bleiben aber offen!\n        this.setGesuchStatus(TSAntragStatus.IN_BEARBEITUNG_JA);\n    }\n\n    /**\n     * Der Button Geprueft wird nur beim Status IN_BEARBEITUNG_JA eingeblendet\n     * @returns {boolean}\n     */\n    public showGeprueft(): boolean {\n        return (this.gesuchModelManager.isGesuchStatus(TSAntragStatus.IN_BEARBEITUNG_JA) || this.gesuchModelManager.isGesuchStatus(TSAntragStatus.FREIGEGEBEN))\n            && this.wizardStepManager.areAllStepsOK(this.getGesuch()) && this.mahnung === undefined && !this.isGesuchReadonly();\n    }\n\n    /**\n     * Der Button Verfuegung starten wird angezeigt, wenn alle Betreuungen bestaetigt und das Gesuch geprueft wurden\n     * @returns {boolean}\n     */\n    public showVerfuegenStarten(): boolean {\n        return this.gesuchModelManager.isGesuchStatus(TSAntragStatus.GEPRUEFT)\n            && this.wizardStepManager.isStepStatusOk(TSWizardStepName.BETREUUNG)\n            && this.gesuchModelManager.getGesuch().isThereAnyBetreuung()\n            && !this.isGesuchReadonly();\n        // && this.gesuchModelManager.getGesuch().status !== TSAntragStatus.VERFUEGEN;\n    }\n\n    /**\n     * Nur wenn ein Gesuch keine Angebote hat und geprueft ist, kann man es ohne Angebote schliessen.\n     */\n    public showCloseWithoutAngebot(): boolean {\n        return this.gesuchModelManager.isGesuchStatus(TSAntragStatus.GEPRUEFT)\n            && !this.gesuchModelManager.getGesuch().isThereAnyBetreuung()\n            && !this.isGesuchReadonly();\n    }\n\n    public openFinanzielleSituationPDF(): void {\n        let win: Window = this.downloadRS.prepareDownloadWindow();\n        this.downloadRS.getFinSitDokumentAccessTokenGeneratedDokument(this.gesuchModelManager.getGesuch().id)\n            .then((downloadFile: TSDownloadFile) => {\n                this.$log.debug('accessToken: ' + downloadFile.accessToken);\n                this.downloadRS.startDownload(downloadFile.accessToken, downloadFile.filename, false, win);\n            })\n            .catch((ex) => {\n                win.close();\n                this.$log.error('An error occurred downloading the document, closing download window.');\n            });\n    }\n\n    public openBegleitschreibenPDF(): void {\n        let win: Window = this.downloadRS.prepareDownloadWindow();\n        this.downloadRS.getBegleitschreibenDokumentAccessTokenGeneratedDokument(this.gesuchModelManager.getGesuch().id, false)\n            .then((downloadFile: TSDownloadFile) => {\n                this.$log.debug('accessToken: ' + downloadFile.accessToken);\n                this.downloadRS.startDownload(downloadFile.accessToken, downloadFile.filename, false, win);\n            })\n            .catch((ex) => {\n                win.close();\n                this.$log.error('An error occurred downloading the document, closing download window.');\n            });\n    }\n\n    public openMahnungPDF(mahnung: TSMahnung): void {\n        let win: Window = this.downloadRS.prepareDownloadWindow();\n        if (mahnung == null) {\n            mahnung = this.mahnung;\n        }\n        this.downloadRS.getAccessTokenMahnungGeneratedDokument(mahnung)\n            .then((downloadFile: TSDownloadFile) => {\n                this.$log.debug('accessToken: ' + downloadFile.accessToken);\n                this.downloadRS.startDownload(downloadFile.accessToken, downloadFile.filename, false, win);\n            })\n            .catch((ex) => {\n                win.close();\n                this.$log.error('An error occurred downloading the document, closing download window.');\n            });\n    }\n\n    public showBeschwerdeHaengig(): boolean {\n        let status: TSAntragStatus = this.getGesuch() ? this.getGesuch().status : TSAntragStatus.IN_BEARBEITUNG_GS;\n        // Schulamt Status duerfen keine Beschwerde starten\n        return isAnyStatusOfVerfuegtButSchulamt(status) && !this.getGesuch().gesperrtWegenBeschwerde;\n    }\n\n    public showBeschwerdeAbschliessen(): boolean {\n        let status: TSAntragStatus = this.getGesuch() ? this.getGesuch().status : TSAntragStatus.IN_BEARBEITUNG_GS;\n        return TSAntragStatus.BESCHWERDE_HAENGIG === status;\n    }\n\n    public setGesuchStatusBeschwerdeHaengig(): IPromise<TSGesuch> {\n        return this.DvDialog.showDialog(removeDialogTempl, RemoveDialogController, {\n            title: 'BESCHWERDE_HAENGIG',\n            deleteText: 'BESCHREIBUNG_GESUCH_BESCHWERDE_HAENGIG',\n            parentController: undefined,\n            elementID: undefined\n        }).then(() => {\n            return this.gesuchRS.setBeschwerdeHaengig(this.getGesuch().id).then((gesuch: TSGesuch) => {\n                this.gesuchModelManager.setGesuch(gesuch);\n                return this.gesuchModelManager.getGesuch();\n            });\n        });\n    }\n\n    public setGesuchStatusBeschwerdeAbschliessen(): IPromise<TSGesuch> {\n        return this.DvDialog.showDialog(removeDialogTempl, RemoveDialogController, {\n            title: 'BESCHWERDE_ABSCHLIESSEN',\n            deleteText: 'BESCHREIBUNG_GESUCH_BESCHWERDE_ABSCHLIESSEN',\n            parentController: undefined,\n            elementID: undefined\n        }).then(() => {\n            return this.gesuchRS.removeBeschwerdeHaengig(this.getGesuch().id).then((gesuch: TSGesuch) => {\n                this.gesuchModelManager.setGesuch(gesuch);\n                return this.gesuchModelManager.getGesuch();\n            });\n        });\n    }\n\n    public fsDokumentChanged(): void {\n        // dirty checker wird hier ausgeschaltet. Aenderungen des fs flag wird automatisch gespeichert wenn gesuch auf geprüft gesetzt wird\n        // Aus performance Gründen wird hier daruf verzichtet das Gesuch neu zu persisten, nur weil das Flag ändert.\n        this.form.$setPristine();\n    }\n\n    public isSuperAdmin(): boolean {\n        return this.authServiceRs.isRole(TSRole.SUPER_ADMIN);\n    }\n\n    $postLink() {\n        this.$timeout(() => {\n            EbeguUtil.selectFirst();\n        }, 500);\n    }\n}\n"]}]}