{"remainingRequest":"/home/imanol/projects/ebegu/ebegu-web/node_modules/thread-loader/dist/cjs.js??ref--0-1!/home/imanol/projects/ebegu/ebegu-web/node_modules/ts-loader/index.js??ref--0-2!/home/imanol/projects/ebegu/ebegu-web/src/gesuch/component/kinderListView/kinderListView.ts","cacheIdentifier":"cache-loader:1.1.0 test","dependencies":[{"path":"/home/imanol/projects/ebegu/ebegu-web/src/gesuch/component/kinderListView/kinderListView.ts","mtime":1512484412015},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/cache-loader/dist/cjs.js","mtime":1507514019000},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/thread-loader/dist/cjs.js","mtime":1507523420000},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/ts-loader/index.js","mtime":1508488471000}],"contextDependencies":[],"result":["\"use strict\";\n/*\n * Ki-Tax: System for the management of external childcare subsidies\n * Copyright (C) 2017 City of Bern Switzerland\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n */\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar abstractGesuchView_1 = require(\"../abstractGesuchView\");\nvar RemoveDialogController_1 = require(\"../../dialog/RemoveDialogController\");\nvar TSWizardStepStatus_1 = require(\"../../../models/enums/TSWizardStepStatus\");\nvar TSWizardStepName_1 = require(\"../../../models/enums/TSWizardStepName\");\nvar EbeguUtil_1 = require(\"../../../utils/EbeguUtil\");\nvar template = require('./kinderListView.html');\nvar removeDialogTempl = require('../../dialog/removeDialogTemplate.html');\nrequire('./kinderListView.less');\nvar KinderListViewComponentConfig = /** @class */ (function () {\n    function KinderListViewComponentConfig() {\n        this.transclude = false;\n        this.bindings = {\n            kinderDubletten: '<'\n        };\n        this.template = template;\n        this.controller = KinderListViewController;\n        this.controllerAs = 'vm';\n    }\n    return KinderListViewComponentConfig;\n}());\nexports.KinderListViewComponentConfig = KinderListViewComponentConfig;\nvar KinderListViewController = /** @class */ (function (_super) {\n    __extends(KinderListViewController, _super);\n    /* @ngInject */\n    function KinderListViewController($state, gesuchModelManager, berechnungsManager, $translate, DvDialog, wizardStepManager, $scope, CONSTANTS, $timeout) {\n        var _this = _super.call(this, gesuchModelManager, berechnungsManager, wizardStepManager, $scope, TSWizardStepName_1.TSWizardStepName.KINDER, $timeout) || this;\n        _this.$state = $state;\n        _this.$translate = $translate;\n        _this.DvDialog = DvDialog;\n        _this.CONSTANTS = CONSTANTS;\n        _this.kinderDubletten = [];\n        _this.initViewModel();\n        return _this;\n    }\n    KinderListViewController.prototype.initViewModel = function () {\n        this.gesuchModelManager.initKinder();\n        if (this.gesuchModelManager.isThereAnyKindWithBetreuungsbedarf()) {\n            this.wizardStepManager.updateCurrentWizardStepStatus(TSWizardStepStatus_1.TSWizardStepStatus.OK);\n        }\n        else {\n            this.wizardStepManager.updateCurrentWizardStepStatus(TSWizardStepStatus_1.TSWizardStepStatus.IN_BEARBEITUNG);\n        }\n    };\n    KinderListViewController.prototype.getKinderList = function () {\n        return this.gesuchModelManager.getKinderList();\n    };\n    KinderListViewController.prototype.createKind = function () {\n        this.openKindView(undefined); //neues kind hat noch keinen index\n    };\n    KinderListViewController.prototype.editKind = function (kind) {\n        if (kind) {\n            kind.isSelected = false; // damit die row in der Tabelle nicht mehr als \"selected\" markiert ist\n            this.openKindView(kind.kindNummer);\n        }\n    };\n    KinderListViewController.prototype.getDubletten = function (kindContainer) {\n        if (this.kinderDubletten) {\n            var dublettenForThisKind = [];\n            for (var i = 0; i < this.kinderDubletten.length; i++) {\n                if (this.kinderDubletten[i].kindNummerOriginal === kindContainer.kindNummer) {\n                    dublettenForThisKind.push(this.kinderDubletten[i]);\n                }\n            }\n            return dublettenForThisKind;\n        }\n        return undefined;\n    };\n    KinderListViewController.prototype.gotoKindDublette = function (dublette) {\n        var url = this.$state.href('gesuch.kind', { kindNumber: dublette.kindNummerDublette, gesuchId: dublette.gesuchId });\n        window.open(url, '_blank');\n    };\n    KinderListViewController.prototype.openKindView = function (kindNumber) {\n        this.$state.go('gesuch.kind', { kindNumber: kindNumber, gesuchId: this.getGesuchId() });\n    };\n    KinderListViewController.prototype.getFallNummer = function (dublette) {\n        return EbeguUtil_1.default.addZerosToNumber(dublette.fallNummer, this.CONSTANTS.FALLNUMMER_LENGTH);\n    };\n    KinderListViewController.prototype.removeKind = function (kind, index) {\n        var _this = this;\n        var remTitleText = this.$translate.instant('KIND_LOESCHEN', { kindname: kind.kindJA.getFullName() });\n        this.DvDialog.showDialog(removeDialogTempl, RemoveDialogController_1.RemoveDialogController, {\n            title: remTitleText,\n            deleteText: 'KIND_LOESCHEN_BESCHREIBUNG',\n            parentController: this,\n            elementID: 'removeKindButton_' + index\n        })\n            .then(function () {\n            var kindIndex = _this.gesuchModelManager.findKind(kind);\n            if (kindIndex >= 0) {\n                _this.gesuchModelManager.setKindIndex(kindIndex);\n                _this.gesuchModelManager.removeKind();\n            }\n        });\n    };\n    /**\n     * Ein Kind darf geloescht werden wenn: Das Gesuch noch nicht verfuegt/verfuegen ist und das vorgaengerId null\n     * ist (es ist ein neues kind) oder in einer mutation wenn es (obwohl ein altes Kind) keine Betreuungen hat\n     * @param kind\n     * @returns {boolean}\n     */\n    KinderListViewController.prototype.canRemoveKind = function (kind) {\n        return !this.isGesuchReadonly()\n            && ((this.gesuchModelManager.getGesuch().isMutation() && (!kind.betreuungen || kind.betreuungen.length <= 0))\n                || !kind.kindJA.vorgaengerId);\n    };\n    KinderListViewController.prototype.getColsNumber = function () {\n        return this.kinderDubletten ? 6 : 5;\n    };\n    KinderListViewController.prototype.setFocusBack = function (elementID) {\n        angular.element('#' + elementID).first().focus();\n    };\n    KinderListViewController.$inject = ['$state', 'GesuchModelManager', 'BerechnungsManager', '$translate', 'DvDialog',\n        'WizardStepManager', '$scope', 'CONSTANTS', '$timeout'];\n    return KinderListViewController;\n}(abstractGesuchView_1.default));\nexports.KinderListViewController = KinderListViewController;\n",{"version":3,"file":"/home/imanol/projects/ebegu/ebegu-web/src/gesuch/component/kinderListView/kinderListView.ts","sourceRoot":"","sources":["/home/imanol/projects/ebegu/ebegu-web/src/gesuch/component/kinderListView/kinderListView.ts"],"names":[],"mappings":";AAAA;;;;;;;;;;;;;GAaG;;;;;;;;;;;;AAMH,4DAAiE;AAGjE,8EAA2E;AAE3E,+EAA4E;AAC5E,2EAAwE;AAExE,sDAAiD;AAMjD,IAAI,QAAQ,GAAG,OAAO,CAAC,uBAAuB,CAAC,CAAC;AAChD,IAAI,iBAAiB,GAAG,OAAO,CAAC,wCAAwC,CAAC,CAAC;AAC1E,OAAO,CAAC,uBAAuB,CAAC,CAAC;AAEjC;IAAA;QACI,eAAU,GAAG,KAAK,CAAC;QACnB,aAAQ,GAAQ;YACZ,eAAe,EAAE,GAAG;SACvB,CAAC;QACF,aAAQ,GAAG,QAAQ,CAAC;QACpB,eAAU,GAAG,wBAAwB,CAAC;QACtC,iBAAY,GAAG,IAAI,CAAC;IACxB,CAAC;IAAD,oCAAC;AAAD,CAAC,AARD,IAQC;AARY,sEAA6B;AAU1C;IAA8C,4CAAiC;IAO3E,eAAe;IACf,kCAAoB,MAAqB,EAAE,kBAAsC,EAAE,kBAAsC,EACrG,UAA6B,EAAU,QAAkB,EACjE,iBAAoC,EAAE,MAAc,EAAU,SAAc,EAAE,QAAyB;QAFnH,YAGI,kBAAM,kBAAkB,EAAE,kBAAkB,EAAE,iBAAiB,EAAE,MAAM,EAAE,mCAAgB,CAAC,MAAM,EAAE,QAAQ,CAAC,SAE9G;QALmB,YAAM,GAAN,MAAM,CAAe;QACrB,gBAAU,GAAV,UAAU,CAAmB;QAAU,cAAQ,GAAR,QAAQ,CAAU;QACH,eAAS,GAAT,SAAS,CAAK;QARxF,qBAAe,GAAqB,EAAE,CAAC;QAUnC,KAAI,CAAC,aAAa,EAAE,CAAC;;IACzB,CAAC;IAEO,gDAAa,GAArB;QACI,IAAI,CAAC,kBAAkB,CAAC,UAAU,EAAE,CAAC;QAErC,EAAE,CAAC,CAAC,IAAI,CAAC,kBAAkB,CAAC,kCAAkC,EAAE,CAAC,CAAC,CAAC;YAC/D,IAAI,CAAC,iBAAiB,CAAC,6BAA6B,CAAC,uCAAkB,CAAC,EAAE,CAAC,CAAC;QAChF,CAAC;QAAC,IAAI,CAAC,CAAC;YACJ,IAAI,CAAC,iBAAiB,CAAC,6BAA6B,CAAC,uCAAkB,CAAC,cAAc,CAAC,CAAC;QAC5F,CAAC;IACL,CAAC;IAED,gDAAa,GAAb;QACI,MAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,aAAa,EAAE,CAAC;IACnD,CAAC;IAED,6CAAU,GAAV;QACI,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC,CAAC,CAAC,kCAAkC;IACpE,CAAC;IAED,2CAAQ,GAAR,UAAS,IAAS;QACd,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;YACP,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC,CAAC,sEAAsE;YAC/F,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QACvC,CAAC;IACL,CAAC;IAED,+CAAY,GAAZ,UAAa,aAA8B;QACvC,EAAE,CAAC,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC,CAAC;YACvB,IAAI,oBAAoB,GAAqB,EAAE,CAAC;YAChD,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,eAAe,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;gBACnD,EAAE,CAAC,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,kBAAkB,KAAK,aAAa,CAAC,UAAU,CAAC,CAAC,CAAC;oBAC1E,oBAAoB,CAAC,IAAI,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,CAAC;gBACvD,CAAC;YACL,CAAC;YACD,MAAM,CAAC,oBAAoB,CAAC;QAChC,CAAC;QACD,MAAM,CAAC,SAAS,CAAC;IACrB,CAAC;IAEM,mDAAgB,GAAvB,UAAwB,QAAwB;QAC5C,IAAI,GAAG,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,aAAa,EAAE,EAAC,UAAU,EAAE,QAAQ,CAAC,kBAAkB,EAAE,QAAQ,EAAE,QAAQ,CAAC,QAAQ,EAAC,CAAC,CAAC;QAClH,MAAM,CAAC,IAAI,CAAC,GAAG,EAAE,QAAQ,CAAC,CAAC;IAC/B,CAAC;IAEO,+CAAY,GAApB,UAAqB,UAAkB;QACnC,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,aAAa,EAAE,EAAC,UAAU,EAAE,UAAU,EAAE,QAAQ,EAAE,IAAI,CAAC,WAAW,EAAE,EAAC,CAAC,CAAC;IAC1F,CAAC;IAEM,gDAAa,GAApB,UAAqB,QAAwB;QACzC,MAAM,CAAC,mBAAS,CAAC,gBAAgB,CAAC,QAAQ,CAAC,UAAU,EAAE,IAAI,CAAC,SAAS,CAAC,iBAAiB,CAAC,CAAC;IAC7F,CAAC;IAED,6CAAU,GAAV,UAAW,IAAS,EAAE,KAAU;QAAhC,iBAeC;QAdG,IAAI,YAAY,GAAG,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,eAAe,EAAE,EAAC,QAAQ,EAAE,IAAI,CAAC,MAAM,CAAC,WAAW,EAAE,EAAC,CAAC,CAAC;QACnG,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,iBAAiB,EAAE,+CAAsB,EAAE;YAChE,KAAK,EAAE,YAAY;YACnB,UAAU,EAAE,4BAA4B;YACxC,gBAAgB,EAAE,IAAI;YACtB,SAAS,EAAE,mBAAmB,GAAG,KAAK;SACzC,CAAC;aACG,IAAI,CAAC;YACF,IAAI,SAAS,GAAW,KAAI,CAAC,kBAAkB,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;YAC/D,EAAE,CAAC,CAAC,SAAS,IAAI,CAAC,CAAC,CAAC,CAAC;gBACjB,KAAI,CAAC,kBAAkB,CAAC,YAAY,CAAC,SAAS,CAAC,CAAC;gBAChD,KAAI,CAAC,kBAAkB,CAAC,UAAU,EAAE,CAAC;YACzC,CAAC;QACL,CAAC,CAAC,CAAC;IACX,CAAC;IAED;;;;;OAKG;IACI,gDAAa,GAApB,UAAqB,IAAqB;QACtC,MAAM,CAAC,CAAC,IAAI,CAAC,gBAAgB,EAAE;eACxB,CAAC,CAAC,IAAI,CAAC,kBAAkB,CAAC,SAAS,EAAE,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC,IAAI,CAAC,WAAW,IAAI,IAAI,CAAC,WAAW,CAAC,MAAM,IAAI,CAAC,CAAC,CAAC;mBACtG,CAAC,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC;IAC1C,CAAC;IAEM,gDAAa,GAApB;QACI,MAAM,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACxC,CAAC;IAEM,+CAAY,GAAnB,UAAoB,SAAiB;QACjC,OAAO,CAAC,OAAO,CAAC,GAAG,GAAG,SAAS,CAAC,CAAC,KAAK,EAAE,CAAC,KAAK,EAAE,CAAC;IACrD,CAAC;IAjGM,gCAAO,GAAa,CAAC,QAAQ,EAAE,oBAAoB,EAAE,oBAAoB,EAAE,YAAY,EAAE,UAAU;QACtG,mBAAmB,EAAE,QAAQ,EAAE,WAAW,EAAE,UAAU,CAAC,CAAC;IAkGhE,+BAAC;CAAA,AAvGD,CAA8C,4BAA4B,GAuGzE;AAvGY,4DAAwB","sourcesContent":["/*\n * Ki-Tax: System for the management of external childcare subsidies\n * Copyright (C) 2017 City of Bern Switzerland\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport {IComponentOptions} from 'angular';\nimport GesuchModelManager from '../../service/gesuchModelManager';\nimport {IStateService} from 'angular-ui-router';\nimport TSKindContainer from '../../../models/TSKindContainer';\nimport AbstractGesuchViewController from '../abstractGesuchView';\nimport {DvDialog} from '../../../core/directive/dv-dialog/dv-dialog';\nimport BerechnungsManager from '../../service/berechnungsManager';\nimport {RemoveDialogController} from '../../dialog/RemoveDialogController';\nimport WizardStepManager from '../../service/wizardStepManager';\nimport {TSWizardStepStatus} from '../../../models/enums/TSWizardStepStatus';\nimport {TSWizardStepName} from '../../../models/enums/TSWizardStepName';\nimport TSKindDublette from '../../../models/TSKindDublette';\nimport EbeguUtil from '../../../utils/EbeguUtil';\nimport {IDVFocusableController} from '../../../core/component/IDVFocusableController';\nimport ITranslateService = angular.translate.ITranslateService;\nimport IScope = angular.IScope;\nimport ITimeoutService = angular.ITimeoutService;\n\nlet template = require('./kinderListView.html');\nlet removeDialogTempl = require('../../dialog/removeDialogTemplate.html');\nrequire('./kinderListView.less');\n\nexport class KinderListViewComponentConfig implements IComponentOptions {\n    transclude = false;\n    bindings: any = {\n        kinderDubletten: '<'\n    };\n    template = template;\n    controller = KinderListViewController;\n    controllerAs = 'vm';\n}\n\nexport class KinderListViewController extends AbstractGesuchViewController<any> implements IDVFocusableController {\n\n    kinderDubletten: TSKindDublette[] = [];\n\n    static $inject: string[] = ['$state', 'GesuchModelManager', 'BerechnungsManager', '$translate', 'DvDialog',\n        'WizardStepManager', '$scope', 'CONSTANTS', '$timeout'];\n\n    /* @ngInject */\n    constructor(private $state: IStateService, gesuchModelManager: GesuchModelManager, berechnungsManager: BerechnungsManager,\n                private $translate: ITranslateService, private DvDialog: DvDialog,\n                wizardStepManager: WizardStepManager, $scope: IScope, private CONSTANTS: any, $timeout: ITimeoutService) {\n        super(gesuchModelManager, berechnungsManager, wizardStepManager, $scope, TSWizardStepName.KINDER, $timeout);\n        this.initViewModel();\n    }\n\n    private initViewModel(): void {\n        this.gesuchModelManager.initKinder();\n\n        if (this.gesuchModelManager.isThereAnyKindWithBetreuungsbedarf()) {\n            this.wizardStepManager.updateCurrentWizardStepStatus(TSWizardStepStatus.OK);\n        } else {\n            this.wizardStepManager.updateCurrentWizardStepStatus(TSWizardStepStatus.IN_BEARBEITUNG);\n        }\n    }\n\n    getKinderList(): Array<TSKindContainer> {\n        return this.gesuchModelManager.getKinderList();\n    }\n\n    createKind(): void {\n        this.openKindView(undefined); //neues kind hat noch keinen index\n    }\n\n    editKind(kind: any): void {\n        if (kind) {         //check entfernt\n            kind.isSelected = false; // damit die row in der Tabelle nicht mehr als \"selected\" markiert ist\n            this.openKindView(kind.kindNummer);\n        }\n    }\n\n    getDubletten(kindContainer: TSKindContainer): TSKindDublette[] {\n        if (this.kinderDubletten) {\n            let dublettenForThisKind: TSKindDublette[] = [];\n            for (let i = 0; i < this.kinderDubletten.length; i++) {\n                if (this.kinderDubletten[i].kindNummerOriginal === kindContainer.kindNummer) {\n                    dublettenForThisKind.push(this.kinderDubletten[i]);\n                }\n            }\n            return dublettenForThisKind;\n        }\n        return undefined;\n    }\n\n    public gotoKindDublette(dublette: TSKindDublette): void {\n        let url = this.$state.href('gesuch.kind', {kindNumber: dublette.kindNummerDublette, gesuchId: dublette.gesuchId});\n        window.open(url, '_blank');\n    }\n\n    private openKindView(kindNumber: number): void {\n        this.$state.go('gesuch.kind', {kindNumber: kindNumber, gesuchId: this.getGesuchId()});\n    }\n\n    public getFallNummer(dublette: TSKindDublette): string {\n        return EbeguUtil.addZerosToNumber(dublette.fallNummer, this.CONSTANTS.FALLNUMMER_LENGTH);\n    }\n\n    removeKind(kind: any, index: any): void {\n        let remTitleText = this.$translate.instant('KIND_LOESCHEN', {kindname: kind.kindJA.getFullName()});\n        this.DvDialog.showDialog(removeDialogTempl, RemoveDialogController, {\n            title: remTitleText,\n            deleteText: 'KIND_LOESCHEN_BESCHREIBUNG',\n            parentController: this,\n            elementID: 'removeKindButton_' + index\n        })\n            .then(() => {   //User confirmed removal\n                let kindIndex: number = this.gesuchModelManager.findKind(kind);\n                if (kindIndex >= 0) {\n                    this.gesuchModelManager.setKindIndex(kindIndex);\n                    this.gesuchModelManager.removeKind();\n                }\n            });\n    }\n\n    /**\n     * Ein Kind darf geloescht werden wenn: Das Gesuch noch nicht verfuegt/verfuegen ist und das vorgaengerId null\n     * ist (es ist ein neues kind) oder in einer mutation wenn es (obwohl ein altes Kind) keine Betreuungen hat\n     * @param kind\n     * @returns {boolean}\n     */\n    public canRemoveKind(kind: TSKindContainer): boolean {\n        return !this.isGesuchReadonly()\n            && ((this.gesuchModelManager.getGesuch().isMutation() && (!kind.betreuungen || kind.betreuungen.length <= 0))\n                || !kind.kindJA.vorgaengerId);\n    }\n\n    public getColsNumber(): number {\n        return this.kinderDubletten ? 6 : 5;\n    }\n\n    public setFocusBack(elementID: string): void {\n        angular.element('#' + elementID).first().focus();\n    }\n\n}\n"]}]}