{"remainingRequest":"/home/imanol/projects/ebegu/ebegu-web/node_modules/thread-loader/dist/cjs.js??ref--0-1!/home/imanol/projects/ebegu/ebegu-web/node_modules/ts-loader/index.js??ref--0-2!/home/imanol/projects/ebegu/ebegu-web/src/gesuch/gesuch.ts","cacheIdentifier":"cache-loader:1.1.0 test","dependencies":[{"path":"/home/imanol/projects/ebegu/ebegu-web/src/gesuch/gesuch.ts","mtime":1518535855232},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/cache-loader/dist/cjs.js","mtime":1507514019000},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/thread-loader/dist/cjs.js","mtime":1507523420000},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/ts-loader/index.js","mtime":1508488471000}],"contextDependencies":[],"result":["/*\n * Ki-Tax: System for the management of external childcare subsidies\n * Copyright (C) 2017 City of Bern Switzerland\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n */\ndefine([\"require\", \"exports\", \"../models/enums/TSAntragStatus\", \"../models/enums/TSAntragTyp\", \"../models/enums/TSGesuchBetreuungenStatus\", \"../models/enums/TSGesuchEvent\", \"../models/enums/TSRole\", \"../models/enums/TSWizardStepName\", \"../models/enums/TSWizardStepStatus\", \"../utils/DateUtil\", \"../utils/TSRoleUtil\"], function (require, exports, TSAntragStatus_1, TSAntragTyp_1, TSGesuchBetreuungenStatus_1, TSGesuchEvent_1, TSRole_1, TSWizardStepName_1, TSWizardStepStatus_1, DateUtil_1, TSRoleUtil_1) {\n    \"use strict\";\n    Object.defineProperty(exports, \"__esModule\", { value: true });\n    var GesuchRouteController = /** @class */ (function () {\n        /* @ngInject */\n        function GesuchRouteController(gesuchModelManager, berechnungsManager, wizardStepManager, ebeguUtil, errorService, antragStatusHistoryRS, $translate, authServiceRS, $mdSidenav, CONSTANTS, gesuchstellerRS, ewkRS, $log, $rootScope) {\n            this.gesuchModelManager = gesuchModelManager;\n            this.wizardStepManager = wizardStepManager;\n            this.ebeguUtil = ebeguUtil;\n            this.errorService = errorService;\n            this.antragStatusHistoryRS = antragStatusHistoryRS;\n            this.$translate = $translate;\n            this.authServiceRS = authServiceRS;\n            this.$mdSidenav = $mdSidenav;\n            this.CONSTANTS = CONSTANTS;\n            this.gesuchstellerRS = gesuchstellerRS;\n            this.ewkRS = ewkRS;\n            this.$log = $log;\n            this.$rootScope = $rootScope;\n            //super(gesuchModelManager, berechnungsManager, wizardStepManager);\n            this.antragStatusHistoryRS.loadLastStatusChange(this.gesuchModelManager.getGesuch());\n            this.TSRole = TSRole_1.TSRole;\n            this.TSRoleUtil = TSRoleUtil_1.TSRoleUtil;\n        }\n        GesuchRouteController.prototype.showFinanzsituationStart = function () {\n            return this.gesuchModelManager.isGesuchsteller2Required();\n        };\n        GesuchRouteController.prototype.getDateFromGesuch = function () {\n            if (this.gesuchModelManager && this.gesuchModelManager.getGesuch()) {\n                return DateUtil_1.default.momentToLocalDateFormat(this.gesuchModelManager.getGesuch().eingangsdatum, 'DD.MM.YYYY');\n            }\n            return undefined;\n        };\n        GesuchRouteController.prototype.toggleSidenav = function (componentId) {\n            this.$mdSidenav(componentId).toggle();\n        };\n        GesuchRouteController.prototype.closeSidenav = function (componentId) {\n            this.$mdSidenav(componentId).close();\n        };\n        GesuchRouteController.prototype.getIcon = function (stepName) {\n            var step = this.wizardStepManager.getStepByName(stepName);\n            if (step) {\n                var status = step.wizardStepStatus;\n                if (status === TSWizardStepStatus_1.TSWizardStepStatus.MUTIERT) {\n                    return 'fa-circle green';\n                }\n                else if (status === TSWizardStepStatus_1.TSWizardStepStatus.OK) {\n                    if (this.getGesuch().isMutation()) {\n                        if (step.wizardStepName === TSWizardStepName_1.TSWizardStepName.VERFUEGEN) {\n                            return 'fa-check green';\n                        }\n                        return '';\n                    }\n                    else {\n                        return 'fa-check green';\n                    }\n                }\n                else if (status === TSWizardStepStatus_1.TSWizardStepStatus.NOK) {\n                    return 'fa-close red';\n                }\n                else if (status === TSWizardStepStatus_1.TSWizardStepStatus.IN_BEARBEITUNG) {\n                    if (step.wizardStepName === TSWizardStepName_1.TSWizardStepName.DOKUMENTE || step.wizardStepName === TSWizardStepName_1.TSWizardStepName.FREIGABE) {\n                        return '';\n                    }\n                    return 'fa-pencil black';\n                }\n                else if (status === TSWizardStepStatus_1.TSWizardStepStatus.PLATZBESTAETIGUNG || status === TSWizardStepStatus_1.TSWizardStepStatus.WARTEN) {\n                    if (this.getGesuch().isMutation() && this.isWizardStepDisabled(step.wizardStepName)) {\n                        return '';\n                    }\n                    else {\n                        return 'fa-hourglass orange';\n                    }\n                }\n                else if (status === TSWizardStepStatus_1.TSWizardStepStatus.UNBESUCHT) {\n                    return '';\n                }\n            }\n            return '';\n        };\n        /**\n         * Steps are disabled when the field verfuegbar is false or if they are not allowed for the current role\n         * @param stepName\n         * @returns {boolean} Sollte etwas schief gehen, true wird zurueckgegeben\n         */\n        GesuchRouteController.prototype.isWizardStepDisabled = function (stepName) {\n            var step = this.wizardStepManager.getStepByName(stepName);\n            if (step) {\n                return !this.wizardStepManager.isStepClickableForCurrentRole(step, this.gesuchModelManager.getGesuch());\n            }\n            return true;\n        };\n        GesuchRouteController.prototype.isStepVisible = function (stepName) {\n            if (stepName) {\n                return this.wizardStepManager.isStepVisible(stepName);\n            }\n            return true;\n        };\n        GesuchRouteController.prototype.isElementActive = function (stepName) {\n            return this.wizardStepManager.getCurrentStepName() === stepName;\n        };\n        /**\n         * Uebersetzt den Status des Gesuchs und gibt ihn zurueck. Sollte das Gesuch noch keinen Status haben IN_BEARBEITUNG_JA\n         * wird zurueckgegeben\n         * @returns {string}\n         */\n        GesuchRouteController.prototype.getGesuchStatusTranslation = function () {\n            var toTranslate = TSAntragStatus_1.TSAntragStatus.IN_BEARBEITUNG_JA;\n            if (this.gesuchModelManager.getGesuch() && this.gesuchModelManager.getGesuch().status) {\n                toTranslate = this.gesuchModelManager.calculateNewStatus(this.gesuchModelManager.getGesuch().status);\n            }\n            var isUserGesuchsteller = this.authServiceRS.isOneOfRoles(TSRoleUtil_1.TSRoleUtil.getGesuchstellerOnlyRoles());\n            var isUserJA = this.authServiceRS.isOneOfRoles(TSRoleUtil_1.TSRoleUtil.getJugendamtRole());\n            var isUserSTV = this.authServiceRS.isOneOfRoles(TSRoleUtil_1.TSRoleUtil.getSteueramtOnlyRoles());\n            if (toTranslate === TSAntragStatus_1.TSAntragStatus.IN_BEARBEITUNG_GS && isUserGesuchsteller) {\n                if (TSGesuchBetreuungenStatus_1.TSGesuchBetreuungenStatus.ABGEWIESEN === this.gesuchModelManager.getGesuch().gesuchBetreuungenStatus) {\n                    return this.ebeguUtil.translateString(TSAntragStatus_1.TSAntragStatus[TSAntragStatus_1.TSAntragStatus.PLATZBESTAETIGUNG_ABGEWIESEN]);\n                }\n                else if (TSGesuchBetreuungenStatus_1.TSGesuchBetreuungenStatus.WARTEN === this.gesuchModelManager.getGesuch().gesuchBetreuungenStatus) {\n                    return this.ebeguUtil.translateString(TSAntragStatus_1.TSAntragStatus[TSAntragStatus_1.TSAntragStatus.PLATZBESTAETIGUNG_WARTEN]);\n                }\n            }\n            if (toTranslate === TSAntragStatus_1.TSAntragStatus.IN_BEARBEITUNG_JA && isUserJA) {\n                return this.ebeguUtil.translateString(TSAntragStatus_1.IN_BEARBEITUNG_BASE_NAME);\n            }\n            switch (toTranslate) {\n                case TSAntragStatus_1.TSAntragStatus.GEPRUEFT_STV:\n                case TSAntragStatus_1.TSAntragStatus.IN_BEARBEITUNG_STV:\n                case TSAntragStatus_1.TSAntragStatus.PRUEFUNG_STV:\n                    if (!isUserJA && !isUserSTV) {\n                        return this.ebeguUtil.translateString('VERFUEGT');\n                    }\n                    break;\n                default:\n                    break;\n            }\n            if ((toTranslate === TSAntragStatus_1.TSAntragStatus.NUR_SCHULAMT)\n                && isUserGesuchsteller) {\n                return this.ebeguUtil.translateString('ABGESCHLOSSEN');\n            }\n            return this.ebeguUtil.translateString(TSAntragStatus_1.TSAntragStatus[toTranslate]);\n        };\n        GesuchRouteController.prototype.getUserFullname = function () {\n            return this.antragStatusHistoryRS.getUserFullname();\n        };\n        GesuchRouteController.prototype.getGesuchId = function () {\n            if (this.getGesuch()) {\n                return this.getGesuch().id;\n            }\n            return undefined;\n        };\n        GesuchRouteController.prototype.getGesuch = function () {\n            if (this.gesuchModelManager.getGesuch()) {\n                return this.gesuchModelManager.getGesuch();\n            }\n            return undefined;\n        };\n        GesuchRouteController.prototype.getGesuchErstellenStepTitle = function () {\n            if (this.gesuchModelManager.isGesuch()) {\n                if (this.getDateFromGesuch()) {\n                    var key = (this.gesuchModelManager.getGesuch().typ === TSAntragTyp_1.TSAntragTyp.ERNEUERUNGSGESUCH) ? 'MENU_ERNEUERUNGSGESUCH_VOM' : 'MENU_ERSTGESUCH_VOM';\n                    return this.$translate.instant(key, {\n                        date: this.getDateFromGesuch()\n                    });\n                }\n                else {\n                    var key = (this.gesuchModelManager.getGesuch().typ === TSAntragTyp_1.TSAntragTyp.ERNEUERUNGSGESUCH) ? 'MENU_ERNEUERUNGSGESUCH' : 'MENU_ERSTGESUCH';\n                    return this.$translate.instant(key);\n                }\n            }\n            else {\n                if (this.getDateFromGesuch()) {\n                    return this.$translate.instant('MENU_MUTATION_VOM', {\n                        date: this.getDateFromGesuch()\n                    });\n                }\n                else {\n                    return this.$translate.instant('MENU_MUTATION');\n                }\n            }\n        };\n        GesuchRouteController.prototype.getGesuchName = function () {\n            return this.gesuchModelManager.getGesuchName();\n        };\n        GesuchRouteController.prototype.getActiveElement = function () {\n            return this.wizardStepManager.getCurrentStepName();\n        };\n        GesuchRouteController.prototype.getGesuchstellerTitle = function (gsnumber) {\n            var gs = this.ewkRS.getGesuchsteller(gsnumber).gesuchstellerJA;\n            if (gs) {\n                var title = gs.getFullName();\n                if (gs.ewkPersonId) {\n                    return title + ' (' + gs.ewkPersonId + ')';\n                }\n                return title;\n            }\n            return undefined;\n        };\n        GesuchRouteController.prototype.showAbfrageForGesuchsteller = function (n) {\n            return this.ewkRS.ewkSearchAvailable(n);\n        };\n        GesuchRouteController.prototype.getGesuchsteller = function (n) {\n            switch (n) {\n                case 1:\n                    if (this.gesuchModelManager.getGesuch() && this.gesuchModelManager.getGesuch().gesuchsteller1) {\n                        return this.gesuchModelManager.getGesuch().gesuchsteller1;\n                    }\n                    return undefined;\n                case 2:\n                    if (this.gesuchModelManager.getGesuch() && this.gesuchModelManager.getGesuch().gesuchsteller2) {\n                        return this.gesuchModelManager.getGesuch().gesuchsteller2;\n                    }\n                    return undefined;\n                default:\n                    return undefined;\n            }\n        };\n        GesuchRouteController.prototype.getEWKResultat = function (n) {\n            switch (n) {\n                case 1:\n                    return this.gesuchModelManager.ewkResultatGS1;\n                case 2:\n                    return this.gesuchModelManager.ewkResultatGS2;\n                default:\n                    return undefined;\n            }\n        };\n        GesuchRouteController.prototype.getEWKPerson = function (n) {\n            switch (n) {\n                case 1:\n                    return this.gesuchModelManager.ewkPersonGS1;\n                case 2:\n                    return this.gesuchModelManager.ewkPersonGS2;\n                default:\n                    return undefined;\n            }\n        };\n        GesuchRouteController.prototype.checkEWKPerson = function (person, n) {\n            switch (n) {\n                case 1:\n                    return (person.personID === this.ewkRS.gesuchsteller1.gesuchstellerJA.ewkPersonId);\n                case 2:\n                    return (person.personID === this.ewkRS.gesuchsteller2.gesuchstellerJA.ewkPersonId);\n                default:\n                    return false;\n            }\n        };\n        GesuchRouteController.prototype.searchGesuchsteller = function (n) {\n            var _this = this;\n            this.errorService.clearAll();\n            this.ewkRS.suchePerson(n).then(function (response) {\n                switch (n) {\n                    case 1:\n                        _this.gesuchModelManager.ewkResultatGS1 = response;\n                        if (_this.gesuchModelManager.ewkResultatGS1.anzahlResultate === 1) {\n                            _this.selectPerson(_this.gesuchModelManager.ewkResultatGS1.personen[0], n);\n                        }\n                        else {\n                            _this.setDateEWKAbfrage(n);\n                        }\n                        break;\n                    case 2:\n                        _this.gesuchModelManager.ewkResultatGS2 = response;\n                        if (_this.gesuchModelManager.ewkResultatGS2.anzahlResultate === 1) {\n                            _this.selectPerson(_this.gesuchModelManager.ewkResultatGS2.personen[0], n);\n                        }\n                        else {\n                            _this.setDateEWKAbfrage(n);\n                        }\n                        break;\n                    default:\n                        break;\n                }\n            }).catch(function (exception) {\n                var bussinesExceptionMitFehlercode = (_this.errorService.getErrors().filter(function filterForBusinessException(e) {\n                    return (e.errorCodeEnum === 'ERROR_PERSONENSUCHE_BUSINESS' && e.argumentList[0]);\n                }).length) > 0;\n                if (bussinesExceptionMitFehlercode) {\n                    // es war eine Businessexception und der Sercvice hat mit einem ErrorCode geantwortet\n                    // Abfrage hat stattgefunden\n                    _this.setDateEWKAbfrage(n);\n                }\n                _this.$log.error('there was an error searching the person in EWK ', exception);\n            });\n        };\n        GesuchRouteController.prototype.selectPerson = function (person, n) {\n            this.ewkRS.selectPerson(n, person.personID);\n            switch (n) {\n                case 1:\n                    this.gesuchModelManager.ewkPersonGS1 = person;\n                    this.$rootScope.$broadcast(TSGesuchEvent_1.TSGesuchEvent[TSGesuchEvent_1.TSGesuchEvent.EWK_PERSON_SELECTED], 1, person.personID);\n                    break;\n                case 2:\n                    this.gesuchModelManager.ewkPersonGS2 = person;\n                    this.$rootScope.$broadcast(TSGesuchEvent_1.TSGesuchEvent[TSGesuchEvent_1.TSGesuchEvent.EWK_PERSON_SELECTED], 2, person.personID);\n                    break;\n                default:\n                    break;\n            }\n        };\n        GesuchRouteController.prototype.isGesuchGesperrt = function () {\n            if (this.gesuchModelManager.getGesuch()) {\n                return this.gesuchModelManager.getGesuch().gesperrtWegenBeschwerde === true;\n            }\n            return false;\n        };\n        GesuchRouteController.prototype.isSuperAdmin = function () {\n            return this.authServiceRS.isRole(TSRole_1.TSRole.SUPER_ADMIN);\n        };\n        GesuchRouteController.prototype.isDocumentUploaded = function () {\n            return this.getGesuch() && this.getGesuch().dokumenteHochgeladen;\n        };\n        GesuchRouteController.prototype.setDateEWKAbfrage = function (n) {\n            this.ewkRS.selectPerson(n, null);\n            switch (n) {\n                case 1:\n                    this.$rootScope.$broadcast(TSGesuchEvent_1.TSGesuchEvent[TSGesuchEvent_1.TSGesuchEvent.EWK_PERSON_SELECTED], 1, null);\n                    break;\n                case 2:\n                    this.$rootScope.$broadcast(TSGesuchEvent_1.TSGesuchEvent[TSGesuchEvent_1.TSGesuchEvent.EWK_PERSON_SELECTED], 2, null);\n                    break;\n                default:\n                    break;\n            }\n        };\n        GesuchRouteController.$inject = ['GesuchModelManager', 'BerechnungsManager', 'WizardStepManager', 'EbeguUtil', 'ErrorService',\n            'AntragStatusHistoryRS', '$translate', 'AuthServiceRS', '$mdSidenav', 'CONSTANTS', 'GesuchstellerRS', 'EwkRS', '$log', '$rootScope'];\n        return GesuchRouteController;\n    }());\n    exports.GesuchRouteController = GesuchRouteController;\n});\n",{"version":3,"file":"/home/imanol/projects/ebegu/ebegu-web/src/gesuch/gesuch.ts","sourceRoot":"","sources":["/home/imanol/projects/ebegu/ebegu-web/src/gesuch/gesuch.ts"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;GAaG;;;;IA4BH;QASI,eAAe;QACf,+BAAoB,kBAAsC,EAAE,kBAAsC,EAC9E,iBAAoC,EAAU,SAAoB,EAClE,YAA0B,EAC1B,qBAA4C,EAAU,UAA6B,EACnF,aAA4B,EAAU,UAAuC,EAAU,SAAc,EACrG,eAAgC,EAAU,KAAY,EACtD,IAAiB,EAAU,UAA6B;YANxD,uBAAkB,GAAlB,kBAAkB,CAAoB;YACtC,sBAAiB,GAAjB,iBAAiB,CAAmB;YAAU,cAAS,GAAT,SAAS,CAAW;YAClE,iBAAY,GAAZ,YAAY,CAAc;YAC1B,0BAAqB,GAArB,qBAAqB,CAAuB;YAAU,eAAU,GAAV,UAAU,CAAmB;YACnF,kBAAa,GAAb,aAAa,CAAe;YAAU,eAAU,GAAV,UAAU,CAA6B;YAAU,cAAS,GAAT,SAAS,CAAK;YACrG,oBAAe,GAAf,eAAe,CAAiB;YAAU,UAAK,GAAL,KAAK,CAAO;YACtD,SAAI,GAAJ,IAAI,CAAa;YAAU,eAAU,GAAV,UAAU,CAAmB;YACxE,mEAAmE;YACnE,IAAI,CAAC,qBAAqB,CAAC,oBAAoB,CAAC,IAAI,CAAC,kBAAkB,CAAC,SAAS,EAAE,CAAC,CAAC;YACrF,IAAI,CAAC,MAAM,GAAG,eAAM,CAAC;YACrB,IAAI,CAAC,UAAU,GAAG,uBAAU,CAAC;QACjC,CAAC;QAED,wDAAwB,GAAxB;YACI,MAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,wBAAwB,EAAE,CAAC;QAC9D,CAAC;QAEM,iDAAiB,GAAxB;YACI,EAAE,CAAC,CAAC,IAAI,CAAC,kBAAkB,IAAI,IAAI,CAAC,kBAAkB,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC;gBACjE,MAAM,CAAC,kBAAQ,CAAC,uBAAuB,CAAC,IAAI,CAAC,kBAAkB,CAAC,SAAS,EAAE,CAAC,aAAa,EAAE,YAAY,CAAC,CAAC;YAC7G,CAAC;YACD,MAAM,CAAC,SAAS,CAAC;QACrB,CAAC;QAEM,6CAAa,GAApB,UAAqB,WAAmB;YACpC,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC,CAAC,MAAM,EAAE,CAAC;QAC1C,CAAC;QAEM,4CAAY,GAAnB,UAAoB,WAAmB;YACnC,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC,CAAC,KAAK,EAAE,CAAC;QACzC,CAAC;QAEM,uCAAO,GAAd,UAAe,QAA0B;YACrC,IAAI,IAAI,GAAG,IAAI,CAAC,iBAAiB,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;YAC1D,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;gBACP,IAAI,MAAM,GAAG,IAAI,CAAC,gBAAgB,CAAC;gBACnC,EAAE,CAAC,CAAC,MAAM,KAAK,uCAAkB,CAAC,OAAO,CAAC,CAAC,CAAC;oBACxC,MAAM,CAAC,iBAAiB,CAAC;gBAC7B,CAAC;gBAAC,IAAI,CAAC,EAAE,CAAC,CAAC,MAAM,KAAK,uCAAkB,CAAC,EAAE,CAAC,CAAC,CAAC;oBAC1C,EAAE,CAAC,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC,UAAU,EAAE,CAAC,CAAC,CAAC;wBAChC,EAAE,CAAC,CAAC,IAAI,CAAC,cAAc,KAAK,mCAAgB,CAAC,SAAS,CAAC,CAAC,CAAC;4BACrD,MAAM,CAAC,gBAAgB,CAAC;wBAC5B,CAAC;wBACD,MAAM,CAAC,EAAE,CAAC;oBACd,CAAC;oBAAC,IAAI,CAAC,CAAC;wBACJ,MAAM,CAAC,gBAAgB,CAAC;oBAC5B,CAAC;gBACL,CAAC;gBAAC,IAAI,CAAC,EAAE,CAAC,CAAC,MAAM,KAAK,uCAAkB,CAAC,GAAG,CAAC,CAAC,CAAC;oBAC3C,MAAM,CAAC,cAAc,CAAC;gBAC1B,CAAC;gBAAC,IAAI,CAAC,EAAE,CAAC,CAAC,MAAM,KAAK,uCAAkB,CAAC,cAAc,CAAC,CAAC,CAAC;oBACtD,EAAE,CAAC,CAAC,IAAI,CAAC,cAAc,KAAK,mCAAgB,CAAC,SAAS,IAAI,IAAI,CAAC,cAAc,KAAK,mCAAgB,CAAC,QAAQ,CAAC,CAAC,CAAC;wBAC1G,MAAM,CAAC,EAAE,CAAC;oBACd,CAAC;oBACD,MAAM,CAAC,iBAAiB,CAAC;gBAC7B,CAAC;gBAAC,IAAI,CAAC,EAAE,CAAC,CAAC,MAAM,KAAK,uCAAkB,CAAC,iBAAiB,IAAI,MAAM,KAAK,uCAAkB,CAAC,MAAM,CAAC,CAAC,CAAC;oBACjG,EAAE,CAAC,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC,UAAU,EAAE,IAAI,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC;wBAClF,MAAM,CAAC,EAAE,CAAC;oBACd,CAAC;oBAAC,IAAI,CAAC,CAAC;wBACJ,MAAM,CAAC,qBAAqB,CAAC;oBACjC,CAAC;gBACL,CAAC;gBAAC,IAAI,CAAC,EAAE,CAAC,CAAC,MAAM,KAAK,uCAAkB,CAAC,SAAS,CAAC,CAAC,CAAC;oBACjD,MAAM,CAAC,EAAE,CAAC;gBACd,CAAC;YACL,CAAC;YACD,MAAM,CAAC,EAAE,CAAC;QACd,CAAC;QAED;;;;WAIG;QACI,oDAAoB,GAA3B,UAA4B,QAA0B;YAClD,IAAI,IAAI,GAAG,IAAI,CAAC,iBAAiB,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;YAC1D,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;gBACP,MAAM,CAAC,CAAC,IAAI,CAAC,iBAAiB,CAAC,6BAA6B,CAAC,IAAI,EAAE,IAAI,CAAC,kBAAkB,CAAC,SAAS,EAAE,CAAC,CAAC;YAC5G,CAAC;YACD,MAAM,CAAC,IAAI,CAAC;QAChB,CAAC;QAEM,6CAAa,GAApB,UAAqB,QAA0B;YAC3C,EAAE,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;gBACX,MAAM,CAAC,IAAI,CAAC,iBAAiB,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;YAC1D,CAAC;YACD,MAAM,CAAC,IAAI,CAAC;QAChB,CAAC;QAEM,+CAAe,GAAtB,UAAuB,QAA0B;YAC7C,MAAM,CAAC,IAAI,CAAC,iBAAiB,CAAC,kBAAkB,EAAE,KAAK,QAAQ,CAAC;QACpE,CAAC;QAED;;;;WAIG;QACI,0DAA0B,GAAjC;YACI,IAAI,WAAW,GAAmB,+BAAc,CAAC,iBAAiB,CAAC;YACnE,EAAE,CAAC,CAAC,IAAI,CAAC,kBAAkB,CAAC,SAAS,EAAE,IAAI,IAAI,CAAC,kBAAkB,CAAC,SAAS,EAAE,CAAC,MAAM,CAAC,CAAC,CAAC;gBACpF,WAAW,GAAG,IAAI,CAAC,kBAAkB,CAAC,kBAAkB,CAAC,IAAI,CAAC,kBAAkB,CAAC,SAAS,EAAE,CAAC,MAAM,CAAC,CAAC;YACzG,CAAC;YACD,IAAI,mBAAmB,GAAY,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC,uBAAU,CAAC,yBAAyB,EAAE,CAAC,CAAC;YAC3G,IAAI,QAAQ,GAAY,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC,uBAAU,CAAC,gBAAgB,EAAE,CAAC,CAAC;YACvF,IAAI,SAAS,GAAY,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC,uBAAU,CAAC,qBAAqB,EAAE,CAAC,CAAC;YAE7F,EAAE,CAAC,CAAC,WAAW,KAAK,+BAAc,CAAC,iBAAiB,IAAI,mBAAmB,CAAC,CAAC,CAAC;gBAC1E,EAAE,CAAC,CAAC,qDAAyB,CAAC,UAAU,KAAK,IAAI,CAAC,kBAAkB,CAAC,SAAS,EAAE,CAAC,uBAAuB,CAAC,CAAC,CAAC;oBACvG,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,+BAAc,CAAC,+BAAc,CAAC,4BAA4B,CAAC,CAAC,CAAC;gBACvG,CAAC;gBAAC,IAAI,CAAC,EAAE,CAAC,CAAC,qDAAyB,CAAC,MAAM,KAAK,IAAI,CAAC,kBAAkB,CAAC,SAAS,EAAE,CAAC,uBAAuB,CAAC,CAAC,CAAC;oBAC1G,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,+BAAc,CAAC,+BAAc,CAAC,wBAAwB,CAAC,CAAC,CAAC;gBACnG,CAAC;YACL,CAAC;YACD,EAAE,CAAC,CAAC,WAAW,KAAK,+BAAc,CAAC,iBAAiB,IAAI,QAAQ,CAAC,CAAC,CAAC;gBAC/D,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,yCAAwB,CAAC,CAAC;YACpE,CAAC;YACD,MAAM,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC;gBAClB,KAAK,+BAAc,CAAC,YAAY,CAAC;gBACjC,KAAK,+BAAc,CAAC,kBAAkB,CAAC;gBACvC,KAAK,+BAAc,CAAC,YAAY;oBAC5B,EAAE,CAAC,CAAC,CAAC,QAAQ,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;wBAC1B,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,UAAU,CAAC,CAAC;oBACtD,CAAC;oBACD,KAAK,CAAC;gBACV;oBACI,KAAK,CAAC;YAEd,CAAC;YAED,EAAE,CAAC,CAAC,CAAC,WAAW,KAAK,+BAAc,CAAC,YAAY,CAAC;mBAC1C,mBAAmB,CAAC,CAAC,CAAC;gBACzB,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,eAAe,CAAC,CAAC;YAC3D,CAAC;YAED,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,+BAAc,CAAC,WAAW,CAAC,CAAC,CAAC;QACvE,CAAC;QAEM,+CAAe,GAAtB;YACI,MAAM,CAAC,IAAI,CAAC,qBAAqB,CAAC,eAAe,EAAE,CAAC;QACxD,CAAC;QAEM,2CAAW,GAAlB;YACI,EAAE,CAAC,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC;gBACnB,MAAM,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC,EAAE,CAAC;YAC/B,CAAC;YACD,MAAM,CAAC,SAAS,CAAC;QACrB,CAAC;QAEM,yCAAS,GAAhB;YACI,EAAE,CAAC,CAAC,IAAI,CAAC,kBAAkB,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC;gBACtC,MAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,SAAS,EAAE,CAAC;YAC/C,CAAC;YACD,MAAM,CAAC,SAAS,CAAC;QACrB,CAAC;QAEM,2DAA2B,GAAlC;YACI,EAAE,CAAC,CAAC,IAAI,CAAC,kBAAkB,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC;gBACrC,EAAE,CAAC,CAAC,IAAI,CAAC,iBAAiB,EAAE,CAAC,CAAC,CAAC;oBAC3B,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC,kBAAkB,CAAC,SAAS,EAAE,CAAC,GAAG,KAAK,yBAAW,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAC,4BAA4B,CAAC,CAAC,CAAC,qBAAqB,CAAC;oBAC7I,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,GAAG,EAAE;wBAChC,IAAI,EAAE,IAAI,CAAC,iBAAiB,EAAE;qBACjC,CAAC,CAAC;gBACP,CAAC;gBAAC,IAAI,CAAC,CAAC;oBACJ,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC,kBAAkB,CAAC,SAAS,EAAE,CAAC,GAAG,KAAK,yBAAW,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAC,wBAAwB,CAAC,CAAC,CAAC,iBAAiB,CAAC;oBACrI,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;gBACxC,CAAC;YACL,CAAC;YAAC,IAAI,CAAC,CAAC;gBACJ,EAAE,CAAC,CAAC,IAAI,CAAC,iBAAiB,EAAE,CAAC,CAAC,CAAC;oBAC3B,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,mBAAmB,EAAE;wBAChD,IAAI,EAAE,IAAI,CAAC,iBAAiB,EAAE;qBACjC,CAAC,CAAC;gBACP,CAAC;gBAAC,IAAI,CAAC,CAAC;oBACJ,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC;gBACpD,CAAC;YACL,CAAC;QACL,CAAC;QAEM,6CAAa,GAApB;YACI,MAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,aAAa,EAAE,CAAC;QACnD,CAAC;QAEM,gDAAgB,GAAvB;YACI,MAAM,CAAC,IAAI,CAAC,iBAAiB,CAAC,kBAAkB,EAAE,CAAC;QACvD,CAAC;QAEM,qDAAqB,GAA5B,UAA6B,QAAgB;YACzC,IAAI,EAAE,GAAoB,IAAI,CAAC,KAAK,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CAAC,eAAe,CAAC;YAChF,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;gBACL,IAAI,KAAK,GAAW,EAAE,CAAC,WAAW,EAAE,CAAC;gBACrC,EAAE,CAAC,CAAC,EAAE,CAAC,WAAW,CAAC,CAAC,CAAC;oBACjB,MAAM,CAAC,KAAK,GAAG,IAAI,GAAG,EAAE,CAAC,WAAW,GAAG,GAAG,CAAC;gBAC/C,CAAC;gBACD,MAAM,CAAC,KAAK,CAAC;YACjB,CAAC;YACD,MAAM,CAAC,SAAS,CAAC;QACrB,CAAC;QAEM,2DAA2B,GAAlC,UAAmC,CAAM;YACrC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,kBAAkB,CAAC,CAAC,CAAC,CAAC;QAC5C,CAAC;QAEM,gDAAgB,GAAvB,UAAwB,CAAS;YAC7B,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;gBACR,KAAK,CAAC;oBACF,EAAE,CAAC,CAAC,IAAI,CAAC,kBAAkB,CAAC,SAAS,EAAE,IAAI,IAAI,CAAC,kBAAkB,CAAC,SAAS,EAAE,CAAC,cAAc,CAAC,CAAC,CAAC;wBAC5F,MAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,SAAS,EAAE,CAAC,cAAc,CAAC;oBAC9D,CAAC;oBACD,MAAM,CAAC,SAAS,CAAC;gBACrB,KAAK,CAAC;oBACF,EAAE,CAAC,CAAC,IAAI,CAAC,kBAAkB,CAAC,SAAS,EAAE,IAAI,IAAI,CAAC,kBAAkB,CAAC,SAAS,EAAE,CAAC,cAAc,CAAC,CAAC,CAAC;wBAC5F,MAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,SAAS,EAAE,CAAC,cAAc,CAAC;oBAC9D,CAAC;oBACD,MAAM,CAAC,SAAS,CAAC;gBACrB;oBACI,MAAM,CAAC,SAAS,CAAC;YACzB,CAAC;QACL,CAAC;QAEM,8CAAc,GAArB,UAAsB,CAAS;YAC3B,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;gBACR,KAAK,CAAC;oBACF,MAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,cAAc,CAAC;gBAClD,KAAK,CAAC;oBACF,MAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,cAAc,CAAC;gBAClD;oBACI,MAAM,CAAC,SAAS,CAAC;YACzB,CAAC;QACL,CAAC;QAEM,4CAAY,GAAnB,UAAoB,CAAS;YACzB,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;gBACR,KAAK,CAAC;oBACF,MAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,YAAY,CAAC;gBAChD,KAAK,CAAC;oBACF,MAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,YAAY,CAAC;gBAChD;oBACI,MAAM,CAAC,SAAS,CAAC;YACzB,CAAC;QACL,CAAC;QAEM,8CAAc,GAArB,UAAsB,MAAmB,EAAE,CAAS;YAChD,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;gBACR,KAAK,CAAC;oBACF,MAAM,CAAC,CAAC,MAAM,CAAC,QAAQ,KAAK,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC,eAAe,CAAC,WAAW,CAAC,CAAC;gBACvF,KAAK,CAAC;oBACF,MAAM,CAAC,CAAC,MAAM,CAAC,QAAQ,KAAK,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC,eAAe,CAAC,WAAW,CAAC,CAAC;gBACvF;oBACI,MAAM,CAAC,KAAK,CAAC;YACrB,CAAC;QACL,CAAC;QAEM,mDAAmB,GAA1B,UAA2B,CAAS;YAApC,iBAoCC;YAnCG,IAAI,CAAC,YAAY,CAAC,QAAQ,EAAE,CAAC;YAC7B,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,UAAA,QAAQ;gBACnC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBACR,KAAK,CAAC;wBACF,KAAI,CAAC,kBAAkB,CAAC,cAAc,GAAG,QAAQ,CAAC;wBAClD,EAAE,CAAC,CAAC,KAAI,CAAC,kBAAkB,CAAC,cAAc,CAAC,eAAe,KAAK,CAAC,CAAC,CAAC,CAAC;4BAC/D,KAAI,CAAC,YAAY,CAAC,KAAI,CAAC,kBAAkB,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;wBAC7E,CAAC;wBAAC,IAAI,CAAC,CAAC;4BACJ,KAAI,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAC;wBAC9B,CAAC;wBACD,KAAK,CAAC;oBACV,KAAK,CAAC;wBACF,KAAI,CAAC,kBAAkB,CAAC,cAAc,GAAG,QAAQ,CAAC;wBAClD,EAAE,CAAC,CAAC,KAAI,CAAC,kBAAkB,CAAC,cAAc,CAAC,eAAe,KAAK,CAAC,CAAC,CAAC,CAAC;4BAC/D,KAAI,CAAC,YAAY,CAAC,KAAI,CAAC,kBAAkB,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;wBAC7E,CAAC;wBAAC,IAAI,CAAC,CAAC;4BACJ,KAAI,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAC;wBAC9B,CAAC;wBACD,KAAK,CAAC;oBACV;wBACI,KAAK,CAAC;gBACd,CAAC;YACL,CAAC,CAAC,CAAC,KAAK,CAAC,UAAC,SAAS;gBACf,IAAI,8BAA8B,GAAG,CAAC,KAAI,CAAC,YAAY,CAAC,SAAS,EAAE,CAAC,MAAM,CAClE,oCAAoC,CAAC;oBACjC,MAAM,CAAC,CAAC,CAAC,CAAC,aAAa,KAAK,8BAA8B,IAAI,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,CAAC;gBACrF,CAAC,CAAC,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;gBAEvB,EAAE,CAAC,CAAC,8BAA8B,CAAC,CAAC,CAAC;oBACjC,qFAAqF;oBACrF,4BAA4B;oBAC5B,KAAI,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAC;gBAC9B,CAAC;gBACD,KAAI,CAAC,IAAI,CAAC,KAAK,CAAC,iDAAiD,EAAE,SAAS,CAAC,CAAC;YAClF,CAAC,CAAC,CAAC;QACP,CAAC;QAEM,4CAAY,GAAnB,UAAoB,MAAmB,EAAE,CAAS;YAC9C,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,CAAC,EAAE,MAAM,CAAC,QAAQ,CAAC,CAAC;YAC5C,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;gBACR,KAAK,CAAC;oBACF,IAAI,CAAC,kBAAkB,CAAC,YAAY,GAAG,MAAM,CAAC;oBAC9C,IAAI,CAAC,UAAU,CAAC,UAAU,CAAC,6BAAa,CAAC,6BAAa,CAAC,mBAAmB,CAAC,EAAE,CAAC,EAAE,MAAM,CAAC,QAAQ,CAAC,CAAC;oBACjG,KAAK,CAAC;gBACV,KAAK,CAAC;oBACF,IAAI,CAAC,kBAAkB,CAAC,YAAY,GAAG,MAAM,CAAC;oBAC9C,IAAI,CAAC,UAAU,CAAC,UAAU,CAAC,6BAAa,CAAC,6BAAa,CAAC,mBAAmB,CAAC,EAAE,CAAC,EAAE,MAAM,CAAC,QAAQ,CAAC,CAAC;oBACjG,KAAK,CAAC;gBACV;oBACI,KAAK,CAAC;YACd,CAAC;QACL,CAAC;QAEM,gDAAgB,GAAvB;YACI,EAAE,CAAC,CAAC,IAAI,CAAC,kBAAkB,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC;gBACtC,MAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,SAAS,EAAE,CAAC,uBAAuB,KAAK,IAAI,CAAC;YAChF,CAAC;YACD,MAAM,CAAC,KAAK,CAAC;QACjB,CAAC;QAEM,4CAAY,GAAnB;YACI,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,eAAM,CAAC,WAAW,CAAC,CAAC;QACzD,CAAC;QAEM,kDAAkB,GAAzB;YACI,MAAM,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,IAAI,CAAC,SAAS,EAAE,CAAC,oBAAoB,CAAC;QACrE,CAAC;QAEO,iDAAiB,GAAzB,UAA0B,CAAS;YAC/B,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC;YACjC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;gBACR,KAAK,CAAC;oBACF,IAAI,CAAC,UAAU,CAAC,UAAU,CAAC,6BAAa,CAAC,6BAAa,CAAC,mBAAmB,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,CAAC;oBACtF,KAAK,CAAC;gBACV,KAAK,CAAC;oBACF,IAAI,CAAC,UAAU,CAAC,UAAU,CAAC,6BAAa,CAAC,6BAAa,CAAC,mBAAmB,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,CAAC;oBACtF,KAAK,CAAC;gBACV;oBACI,KAAK,CAAC;YACd,CAAC;QAEL,CAAC;QAhVM,6BAAO,GAAa,CAAC,oBAAoB,EAAE,oBAAoB,EAAE,mBAAmB,EAAE,WAAW,EAAE,cAAc;YACpH,uBAAuB,EAAE,YAAY,EAAE,eAAe,EAAE,YAAY,EAAE,WAAW,EAAE,iBAAiB,EAAE,OAAO,EAAE,MAAM,EAAE,YAAY,CAAC,CAAC;QAgV7I,4BAAC;KAAA,AAvVD,IAuVC;IAvVY,sDAAqB","sourcesContent":["/*\n * Ki-Tax: System for the management of external childcare subsidies\n * Copyright (C) 2017 City of Bern Switzerland\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport {ILogService, IRootScopeService} from '@types/angular';\nimport AuthServiceRS from '../authentication/service/AuthServiceRS.rest';\nimport ErrorService from '../core/errors/service/ErrorService';\nimport AntragStatusHistoryRS from '../core/service/antragStatusHistoryRS.rest';\nimport EwkRS from '../core/service/ewkRS.rest';\nimport GesuchstellerRS from '../core/service/gesuchstellerRS.rest';\nimport {IN_BEARBEITUNG_BASE_NAME, TSAntragStatus} from '../models/enums/TSAntragStatus';\nimport {TSAntragTyp} from '../models/enums/TSAntragTyp';\nimport {TSGesuchBetreuungenStatus} from '../models/enums/TSGesuchBetreuungenStatus';\nimport {TSGesuchEvent} from '../models/enums/TSGesuchEvent';\nimport {TSRole} from '../models/enums/TSRole';\nimport {TSWizardStepName} from '../models/enums/TSWizardStepName';\nimport {TSWizardStepStatus} from '../models/enums/TSWizardStepStatus';\nimport TSEWKPerson from '../models/TSEWKPerson';\nimport TSEWKResultat from '../models/TSEWKResultat';\nimport TSGesuch from '../models/TSGesuch';\nimport TSGesuchsteller from '../models/TSGesuchsteller';\nimport TSGesuchstellerContainer from '../models/TSGesuchstellerContainer';\nimport DateUtil from '../utils/DateUtil';\nimport EbeguUtil from '../utils/EbeguUtil';\nimport {TSRoleUtil} from '../utils/TSRoleUtil';\nimport BerechnungsManager from './service/berechnungsManager';\nimport GesuchModelManager from './service/gesuchModelManager';\nimport WizardStepManager from './service/wizardStepManager';\nimport ITranslateService = angular.translate.ITranslateService;\n\nexport class GesuchRouteController {\n\n    TSRole: any;\n    TSRoleUtil: any;\n    openEwkSidenav: boolean;\n\n    static $inject: string[] = ['GesuchModelManager', 'BerechnungsManager', 'WizardStepManager', 'EbeguUtil', 'ErrorService',\n        'AntragStatusHistoryRS', '$translate', 'AuthServiceRS', '$mdSidenav', 'CONSTANTS', 'GesuchstellerRS', 'EwkRS', '$log', '$rootScope'];\n\n    /* @ngInject */\n    constructor(private gesuchModelManager: GesuchModelManager, berechnungsManager: BerechnungsManager,\n                private wizardStepManager: WizardStepManager, private ebeguUtil: EbeguUtil,\n                private errorService: ErrorService,\n                private antragStatusHistoryRS: AntragStatusHistoryRS, private $translate: ITranslateService,\n                private authServiceRS: AuthServiceRS, private $mdSidenav: ng.material.ISidenavService, private CONSTANTS: any,\n                private gesuchstellerRS: GesuchstellerRS, private ewkRS: EwkRS,\n                private $log: ILogService, private $rootScope: IRootScopeService) {\n        //super(gesuchModelManager, berechnungsManager, wizardStepManager);\n        this.antragStatusHistoryRS.loadLastStatusChange(this.gesuchModelManager.getGesuch());\n        this.TSRole = TSRole;\n        this.TSRoleUtil = TSRoleUtil;\n    }\n\n    showFinanzsituationStart(): boolean {\n        return this.gesuchModelManager.isGesuchsteller2Required();\n    }\n\n    public getDateFromGesuch(): string {\n        if (this.gesuchModelManager && this.gesuchModelManager.getGesuch()) {\n            return DateUtil.momentToLocalDateFormat(this.gesuchModelManager.getGesuch().eingangsdatum, 'DD.MM.YYYY');\n        }\n        return undefined;\n    }\n\n    public toggleSidenav(componentId: string) {\n        this.$mdSidenav(componentId).toggle();\n    }\n\n    public closeSidenav(componentId: string) {\n        this.$mdSidenav(componentId).close();\n    }\n\n    public getIcon(stepName: TSWizardStepName): string {\n        let step = this.wizardStepManager.getStepByName(stepName);\n        if (step) {\n            let status = step.wizardStepStatus;\n            if (status === TSWizardStepStatus.MUTIERT) {\n                return 'fa-circle green';\n            } else if (status === TSWizardStepStatus.OK) {\n                if (this.getGesuch().isMutation()) {\n                    if (step.wizardStepName === TSWizardStepName.VERFUEGEN) { // Verfuegung auch bei Mutation mit Hacken (falls verfuegt)\n                        return 'fa-check green';\n                    }\n                    return '';\n                } else {\n                    return 'fa-check green';\n                }\n            } else if (status === TSWizardStepStatus.NOK) {\n                return 'fa-close red';\n            } else if (status === TSWizardStepStatus.IN_BEARBEITUNG) {\n                if (step.wizardStepName === TSWizardStepName.DOKUMENTE || step.wizardStepName === TSWizardStepName.FREIGABE) { // Dokumenten haben kein Icon wenn nicht alle hochgeladen wurden\n                    return '';\n                }\n                return 'fa-pencil black';\n            } else if (status === TSWizardStepStatus.PLATZBESTAETIGUNG || status === TSWizardStepStatus.WARTEN) {\n                if (this.getGesuch().isMutation() && this.isWizardStepDisabled(step.wizardStepName)) { // in einer Mutation bekommt icon nur wenn es aktiviert ist\n                    return '';\n                } else {\n                    return 'fa-hourglass orange';\n                }\n            } else if (status === TSWizardStepStatus.UNBESUCHT) {\n                return '';\n            }\n        }\n        return '';\n    }\n\n    /**\n     * Steps are disabled when the field verfuegbar is false or if they are not allowed for the current role\n     * @param stepName\n     * @returns {boolean} Sollte etwas schief gehen, true wird zurueckgegeben\n     */\n    public isWizardStepDisabled(stepName: TSWizardStepName): boolean {\n        let step = this.wizardStepManager.getStepByName(stepName);\n        if (step) {\n            return !this.wizardStepManager.isStepClickableForCurrentRole(step, this.gesuchModelManager.getGesuch());\n        }\n        return true;\n    }\n\n    public isStepVisible(stepName: TSWizardStepName): boolean {\n        if (stepName) {\n            return this.wizardStepManager.isStepVisible(stepName);\n        }\n        return true;\n    }\n\n    public isElementActive(stepName: TSWizardStepName): boolean {\n        return this.wizardStepManager.getCurrentStepName() === stepName;\n    }\n\n    /**\n     * Uebersetzt den Status des Gesuchs und gibt ihn zurueck. Sollte das Gesuch noch keinen Status haben IN_BEARBEITUNG_JA\n     * wird zurueckgegeben\n     * @returns {string}\n     */\n    public getGesuchStatusTranslation(): string {\n        let toTranslate: TSAntragStatus = TSAntragStatus.IN_BEARBEITUNG_JA;\n        if (this.gesuchModelManager.getGesuch() && this.gesuchModelManager.getGesuch().status) {\n            toTranslate = this.gesuchModelManager.calculateNewStatus(this.gesuchModelManager.getGesuch().status);\n        }\n        let isUserGesuchsteller: boolean = this.authServiceRS.isOneOfRoles(TSRoleUtil.getGesuchstellerOnlyRoles());\n        let isUserJA: boolean = this.authServiceRS.isOneOfRoles(TSRoleUtil.getJugendamtRole());\n        let isUserSTV: boolean = this.authServiceRS.isOneOfRoles(TSRoleUtil.getSteueramtOnlyRoles());\n\n        if (toTranslate === TSAntragStatus.IN_BEARBEITUNG_GS && isUserGesuchsteller) {\n            if (TSGesuchBetreuungenStatus.ABGEWIESEN === this.gesuchModelManager.getGesuch().gesuchBetreuungenStatus) {\n                return this.ebeguUtil.translateString(TSAntragStatus[TSAntragStatus.PLATZBESTAETIGUNG_ABGEWIESEN]);\n            } else if (TSGesuchBetreuungenStatus.WARTEN === this.gesuchModelManager.getGesuch().gesuchBetreuungenStatus) {\n                return this.ebeguUtil.translateString(TSAntragStatus[TSAntragStatus.PLATZBESTAETIGUNG_WARTEN]);\n            }\n        }\n        if (toTranslate === TSAntragStatus.IN_BEARBEITUNG_JA && isUserJA) {\n            return this.ebeguUtil.translateString(IN_BEARBEITUNG_BASE_NAME);\n        }\n        switch (toTranslate) {\n            case TSAntragStatus.GEPRUEFT_STV:\n            case TSAntragStatus.IN_BEARBEITUNG_STV:\n            case TSAntragStatus.PRUEFUNG_STV:\n                if (!isUserJA && !isUserSTV) {\n                    return this.ebeguUtil.translateString('VERFUEGT');\n                }\n                break;\n            default:\n                break;\n\n        }\n\n        if ((toTranslate === TSAntragStatus.NUR_SCHULAMT)\n            && isUserGesuchsteller) {\n            return this.ebeguUtil.translateString('ABGESCHLOSSEN');\n        }\n\n        return this.ebeguUtil.translateString(TSAntragStatus[toTranslate]);\n    }\n\n    public getUserFullname(): string {\n        return this.antragStatusHistoryRS.getUserFullname();\n    }\n\n    public getGesuchId(): string {\n        if (this.getGesuch()) {\n            return this.getGesuch().id;\n        }\n        return undefined;\n    }\n\n    public getGesuch(): TSGesuch {\n        if (this.gesuchModelManager.getGesuch()) {\n            return this.gesuchModelManager.getGesuch();\n        }\n        return undefined;\n    }\n\n    public getGesuchErstellenStepTitle(): string {\n        if (this.gesuchModelManager.isGesuch()) {\n            if (this.getDateFromGesuch()) {\n                let key = (this.gesuchModelManager.getGesuch().typ === TSAntragTyp.ERNEUERUNGSGESUCH) ? 'MENU_ERNEUERUNGSGESUCH_VOM' : 'MENU_ERSTGESUCH_VOM';\n                return this.$translate.instant(key, {\n                    date: this.getDateFromGesuch()\n                });\n            } else {\n                let key = (this.gesuchModelManager.getGesuch().typ === TSAntragTyp.ERNEUERUNGSGESUCH) ? 'MENU_ERNEUERUNGSGESUCH' : 'MENU_ERSTGESUCH';\n                return this.$translate.instant(key);\n            }\n        } else {\n            if (this.getDateFromGesuch()) {\n                return this.$translate.instant('MENU_MUTATION_VOM', {\n                    date: this.getDateFromGesuch()\n                });\n            } else {\n                return this.$translate.instant('MENU_MUTATION');\n            }\n        }\n    }\n\n    public getGesuchName(): string {\n        return this.gesuchModelManager.getGesuchName();\n    }\n\n    public getActiveElement(): TSWizardStepName {\n        return this.wizardStepManager.getCurrentStepName();\n    }\n\n    public getGesuchstellerTitle(gsnumber: number): string {\n        let gs: TSGesuchsteller = this.ewkRS.getGesuchsteller(gsnumber).gesuchstellerJA;\n        if (gs) {\n            let title: string = gs.getFullName();\n            if (gs.ewkPersonId) {\n                return title + ' (' + gs.ewkPersonId + ')';\n            }\n            return title;\n        }\n        return undefined;\n    }\n\n    public showAbfrageForGesuchsteller(n: any): boolean {\n        return this.ewkRS.ewkSearchAvailable(n);\n    }\n\n    public getGesuchsteller(n: number): TSGesuchstellerContainer {\n        switch (n) {\n            case 1:\n                if (this.gesuchModelManager.getGesuch() && this.gesuchModelManager.getGesuch().gesuchsteller1) {\n                    return this.gesuchModelManager.getGesuch().gesuchsteller1;\n                }\n                return undefined;\n            case 2:\n                if (this.gesuchModelManager.getGesuch() && this.gesuchModelManager.getGesuch().gesuchsteller2) {\n                    return this.gesuchModelManager.getGesuch().gesuchsteller2;\n                }\n                return undefined;\n            default:\n                return undefined;\n        }\n    }\n\n    public getEWKResultat(n: number): TSEWKResultat {\n        switch (n) {\n            case 1:\n                return this.gesuchModelManager.ewkResultatGS1;\n            case 2:\n                return this.gesuchModelManager.ewkResultatGS2;\n            default:\n                return undefined;\n        }\n    }\n\n    public getEWKPerson(n: number): TSEWKPerson {\n        switch (n) {\n            case 1:\n                return this.gesuchModelManager.ewkPersonGS1;\n            case 2:\n                return this.gesuchModelManager.ewkPersonGS2;\n            default:\n                return undefined;\n        }\n    }\n\n    public checkEWKPerson(person: TSEWKPerson, n: number): boolean {\n        switch (n) {\n            case 1:\n                return (person.personID === this.ewkRS.gesuchsteller1.gesuchstellerJA.ewkPersonId);\n            case 2:\n                return (person.personID === this.ewkRS.gesuchsteller2.gesuchstellerJA.ewkPersonId);\n            default:\n                return false;\n        }\n    }\n\n    public searchGesuchsteller(n: number): void {\n        this.errorService.clearAll();\n        this.ewkRS.suchePerson(n).then(response => {\n            switch (n) {\n                case 1:\n                    this.gesuchModelManager.ewkResultatGS1 = response;\n                    if (this.gesuchModelManager.ewkResultatGS1.anzahlResultate === 1) {\n                        this.selectPerson(this.gesuchModelManager.ewkResultatGS1.personen[0], n);\n                    } else {\n                        this.setDateEWKAbfrage(n);\n                    }\n                    break;\n                case 2:\n                    this.gesuchModelManager.ewkResultatGS2 = response;\n                    if (this.gesuchModelManager.ewkResultatGS2.anzahlResultate === 1) {\n                        this.selectPerson(this.gesuchModelManager.ewkResultatGS2.personen[0], n);\n                    } else {\n                        this.setDateEWKAbfrage(n);\n                    }\n                    break;\n                default:\n                    break;\n            }\n        }).catch((exception) => {\n            let bussinesExceptionMitFehlercode = (this.errorService.getErrors().filter(\n                    function filterForBusinessException(e) {\n                        return (e.errorCodeEnum === 'ERROR_PERSONENSUCHE_BUSINESS' && e.argumentList[0]);\n                    }).length) > 0;\n\n            if (bussinesExceptionMitFehlercode) {\n                // es war eine Businessexception und der Sercvice hat mit einem ErrorCode geantwortet\n                // Abfrage hat stattgefunden\n                this.setDateEWKAbfrage(n);\n            }\n            this.$log.error('there was an error searching the person in EWK ', exception);\n        });\n    }\n\n    public selectPerson(person: TSEWKPerson, n: number): void {\n        this.ewkRS.selectPerson(n, person.personID);\n        switch (n) {\n            case 1:\n                this.gesuchModelManager.ewkPersonGS1 = person;\n                this.$rootScope.$broadcast(TSGesuchEvent[TSGesuchEvent.EWK_PERSON_SELECTED], 1, person.personID);\n                break;\n            case 2:\n                this.gesuchModelManager.ewkPersonGS2 = person;\n                this.$rootScope.$broadcast(TSGesuchEvent[TSGesuchEvent.EWK_PERSON_SELECTED], 2, person.personID);\n                break;\n            default:\n                break;\n        }\n    }\n\n    public isGesuchGesperrt(): boolean {\n        if (this.gesuchModelManager.getGesuch()) {\n            return this.gesuchModelManager.getGesuch().gesperrtWegenBeschwerde === true;\n        }\n        return false;\n    }\n\n    public isSuperAdmin(): boolean {\n        return this.authServiceRS.isRole(TSRole.SUPER_ADMIN);\n    }\n\n    public isDocumentUploaded(): boolean {\n        return this.getGesuch() && this.getGesuch().dokumenteHochgeladen;\n    }\n\n    private setDateEWKAbfrage(n: number) {\n        this.ewkRS.selectPerson(n, null);\n        switch (n) {\n            case 1:\n                this.$rootScope.$broadcast(TSGesuchEvent[TSGesuchEvent.EWK_PERSON_SELECTED], 1, null);\n                break;\n            case 2:\n                this.$rootScope.$broadcast(TSGesuchEvent[TSGesuchEvent.EWK_PERSON_SELECTED], 2, null);\n                break;\n            default:\n                break;\n        }\n\n    }\n}\n"]}]}