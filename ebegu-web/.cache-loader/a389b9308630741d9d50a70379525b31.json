{"remainingRequest":"/home/imanol/projects/ebegu/ebegu-web/node_modules/thread-loader/dist/cjs.js??ref--0-1!/home/imanol/projects/ebegu/ebegu-web/node_modules/ts-loader/index.js??ref--0-2!/home/imanol/projects/ebegu/ebegu-web/src/gesuch/gesuch.ts","cacheIdentifier":"cache-loader:1.1.0 test","dependencies":[{"path":"/home/imanol/projects/ebegu/ebegu-web/src/gesuch/gesuch.ts","mtime":1518612532806},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/cache-loader/dist/cjs.js","mtime":1507514019000},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/thread-loader/dist/cjs.js","mtime":1507523420000},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/ts-loader/index.js","mtime":1508488471000}],"contextDependencies":[],"result":["\"use strict\";\n/*\n * Ki-Tax: System for the management of external childcare subsidies\n * Copyright (C) 2017 City of Bern Switzerland\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar TSAntragStatus_1 = require(\"../models/enums/TSAntragStatus\");\nvar TSAntragTyp_1 = require(\"../models/enums/TSAntragTyp\");\nvar TSGesuchBetreuungenStatus_1 = require(\"../models/enums/TSGesuchBetreuungenStatus\");\nvar TSGesuchEvent_1 = require(\"../models/enums/TSGesuchEvent\");\nvar TSRole_1 = require(\"../models/enums/TSRole\");\nvar TSWizardStepName_1 = require(\"../models/enums/TSWizardStepName\");\nvar TSWizardStepStatus_1 = require(\"../models/enums/TSWizardStepStatus\");\nvar DateUtil_1 = require(\"../utils/DateUtil\");\nvar TSRoleUtil_1 = require(\"../utils/TSRoleUtil\");\nvar GesuchRouteController = /** @class */ (function () {\n    /* @ngInject */\n    function GesuchRouteController(gesuchModelManager, berechnungsManager, wizardStepManager, ebeguUtil, errorService, antragStatusHistoryRS, $translate, authServiceRS, $mdSidenav, CONSTANTS, gesuchstellerRS, ewkRS, $log, $rootScope) {\n        this.gesuchModelManager = gesuchModelManager;\n        this.wizardStepManager = wizardStepManager;\n        this.ebeguUtil = ebeguUtil;\n        this.errorService = errorService;\n        this.antragStatusHistoryRS = antragStatusHistoryRS;\n        this.$translate = $translate;\n        this.authServiceRS = authServiceRS;\n        this.$mdSidenav = $mdSidenav;\n        this.CONSTANTS = CONSTANTS;\n        this.gesuchstellerRS = gesuchstellerRS;\n        this.ewkRS = ewkRS;\n        this.$log = $log;\n        this.$rootScope = $rootScope;\n        //super(gesuchModelManager, berechnungsManager, wizardStepManager);\n        this.antragStatusHistoryRS.loadLastStatusChange(this.gesuchModelManager.getGesuch());\n        this.TSRole = TSRole_1.TSRole;\n        this.TSRoleUtil = TSRoleUtil_1.TSRoleUtil;\n    }\n    GesuchRouteController.prototype.showFinanzielleSituationStart = function () {\n        return this.gesuchModelManager.showFinanzielleSituationStart();\n    };\n    GesuchRouteController.prototype.getDateFromGesuch = function () {\n        if (this.gesuchModelManager && this.gesuchModelManager.getGesuch()) {\n            return DateUtil_1.default.momentToLocalDateFormat(this.gesuchModelManager.getGesuch().eingangsdatum, 'DD.MM.YYYY');\n        }\n        return undefined;\n    };\n    GesuchRouteController.prototype.toggleSidenav = function (componentId) {\n        this.$mdSidenav(componentId).toggle();\n    };\n    GesuchRouteController.prototype.closeSidenav = function (componentId) {\n        this.$mdSidenav(componentId).close();\n    };\n    GesuchRouteController.prototype.getIcon = function (stepName) {\n        var step = this.wizardStepManager.getStepByName(stepName);\n        if (step) {\n            var status = step.wizardStepStatus;\n            if (status === TSWizardStepStatus_1.TSWizardStepStatus.MUTIERT) {\n                return 'fa-circle green';\n            }\n            else if (status === TSWizardStepStatus_1.TSWizardStepStatus.OK) {\n                if (this.getGesuch().isMutation()) {\n                    if (step.wizardStepName === TSWizardStepName_1.TSWizardStepName.VERFUEGEN) {\n                        return 'fa-check green';\n                    }\n                    return '';\n                }\n                else {\n                    return 'fa-check green';\n                }\n            }\n            else if (status === TSWizardStepStatus_1.TSWizardStepStatus.NOK) {\n                return 'fa-close red';\n            }\n            else if (status === TSWizardStepStatus_1.TSWizardStepStatus.IN_BEARBEITUNG) {\n                if (step.wizardStepName === TSWizardStepName_1.TSWizardStepName.DOKUMENTE || step.wizardStepName === TSWizardStepName_1.TSWizardStepName.FREIGABE) {\n                    return '';\n                }\n                return 'fa-pencil black';\n            }\n            else if (status === TSWizardStepStatus_1.TSWizardStepStatus.PLATZBESTAETIGUNG || status === TSWizardStepStatus_1.TSWizardStepStatus.WARTEN) {\n                if (this.getGesuch().isMutation() && this.isWizardStepDisabled(step.wizardStepName)) {\n                    return '';\n                }\n                else {\n                    return 'fa-hourglass orange';\n                }\n            }\n            else if (status === TSWizardStepStatus_1.TSWizardStepStatus.UNBESUCHT) {\n                return '';\n            }\n        }\n        return '';\n    };\n    /**\n     * Steps are disabled when the field verfuegbar is false or if they are not allowed for the current role\n     * @param stepName\n     * @returns {boolean} Sollte etwas schief gehen, true wird zurueckgegeben\n     */\n    GesuchRouteController.prototype.isWizardStepDisabled = function (stepName) {\n        var step = this.wizardStepManager.getStepByName(stepName);\n        if (step) {\n            return !this.wizardStepManager.isStepClickableForCurrentRole(step, this.gesuchModelManager.getGesuch());\n        }\n        return true;\n    };\n    GesuchRouteController.prototype.isStepVisible = function (stepName) {\n        if (stepName) {\n            return this.wizardStepManager.isStepVisible(stepName);\n        }\n        return true;\n    };\n    GesuchRouteController.prototype.isElementActive = function (stepName) {\n        return this.wizardStepManager.getCurrentStepName() === stepName;\n    };\n    /**\n     * Uebersetzt den Status des Gesuchs und gibt ihn zurueck. Sollte das Gesuch noch keinen Status haben IN_BEARBEITUNG_JA\n     * wird zurueckgegeben\n     * @returns {string}\n     */\n    GesuchRouteController.prototype.getGesuchStatusTranslation = function () {\n        var toTranslate = TSAntragStatus_1.TSAntragStatus.IN_BEARBEITUNG_JA;\n        if (this.gesuchModelManager.getGesuch() && this.gesuchModelManager.getGesuch().status) {\n            toTranslate = this.gesuchModelManager.calculateNewStatus(this.gesuchModelManager.getGesuch().status);\n        }\n        var isUserGesuchsteller = this.authServiceRS.isOneOfRoles(TSRoleUtil_1.TSRoleUtil.getGesuchstellerOnlyRoles());\n        var isUserAmt = this.authServiceRS.isOneOfRoles(TSRoleUtil_1.TSRoleUtil.getJugendamtAndSchulamtRole());\n        var isUserSTV = this.authServiceRS.isOneOfRoles(TSRoleUtil_1.TSRoleUtil.getSteueramtOnlyRoles());\n        if (toTranslate === TSAntragStatus_1.TSAntragStatus.IN_BEARBEITUNG_GS && isUserGesuchsteller) {\n            if (TSGesuchBetreuungenStatus_1.TSGesuchBetreuungenStatus.ABGEWIESEN === this.gesuchModelManager.getGesuch().gesuchBetreuungenStatus) {\n                return this.ebeguUtil.translateString(TSAntragStatus_1.TSAntragStatus[TSAntragStatus_1.TSAntragStatus.PLATZBESTAETIGUNG_ABGEWIESEN]);\n            }\n            else if (TSGesuchBetreuungenStatus_1.TSGesuchBetreuungenStatus.WARTEN === this.gesuchModelManager.getGesuch().gesuchBetreuungenStatus) {\n                return this.ebeguUtil.translateString(TSAntragStatus_1.TSAntragStatus[TSAntragStatus_1.TSAntragStatus.PLATZBESTAETIGUNG_WARTEN]);\n            }\n        }\n        if (toTranslate === TSAntragStatus_1.TSAntragStatus.IN_BEARBEITUNG_JA && isUserAmt) {\n            return this.ebeguUtil.translateString(TSAntragStatus_1.IN_BEARBEITUNG_BASE_NAME);\n        }\n        switch (toTranslate) {\n            case TSAntragStatus_1.TSAntragStatus.GEPRUEFT_STV:\n            case TSAntragStatus_1.TSAntragStatus.IN_BEARBEITUNG_STV:\n            case TSAntragStatus_1.TSAntragStatus.PRUEFUNG_STV:\n                if (!isUserAmt && !isUserSTV) {\n                    return this.ebeguUtil.translateString('VERFUEGT');\n                }\n                break;\n            default:\n                break;\n        }\n        if ((toTranslate === TSAntragStatus_1.TSAntragStatus.NUR_SCHULAMT)\n            && isUserGesuchsteller) {\n            return this.ebeguUtil.translateString('ABGESCHLOSSEN');\n        }\n        return this.ebeguUtil.translateString(TSAntragStatus_1.TSAntragStatus[toTranslate]);\n    };\n    GesuchRouteController.prototype.getUserFullname = function () {\n        return this.antragStatusHistoryRS.getUserFullname();\n    };\n    GesuchRouteController.prototype.getGesuchId = function () {\n        if (this.getGesuch()) {\n            return this.getGesuch().id;\n        }\n        return undefined;\n    };\n    GesuchRouteController.prototype.getGesuch = function () {\n        if (this.gesuchModelManager.getGesuch()) {\n            return this.gesuchModelManager.getGesuch();\n        }\n        return undefined;\n    };\n    GesuchRouteController.prototype.getGesuchErstellenStepTitle = function () {\n        if (this.gesuchModelManager.isGesuch()) {\n            if (this.getDateFromGesuch()) {\n                var key = (this.gesuchModelManager.getGesuch().typ === TSAntragTyp_1.TSAntragTyp.ERNEUERUNGSGESUCH) ? 'MENU_ERNEUERUNGSGESUCH_VOM' : 'MENU_ERSTGESUCH_VOM';\n                return this.$translate.instant(key, {\n                    date: this.getDateFromGesuch()\n                });\n            }\n            else {\n                var key = (this.gesuchModelManager.getGesuch().typ === TSAntragTyp_1.TSAntragTyp.ERNEUERUNGSGESUCH) ? 'MENU_ERNEUERUNGSGESUCH' : 'MENU_ERSTGESUCH';\n                return this.$translate.instant(key);\n            }\n        }\n        else {\n            if (this.getDateFromGesuch()) {\n                return this.$translate.instant('MENU_MUTATION_VOM', {\n                    date: this.getDateFromGesuch()\n                });\n            }\n            else {\n                return this.$translate.instant('MENU_MUTATION');\n            }\n        }\n    };\n    GesuchRouteController.prototype.getGesuchName = function () {\n        return this.gesuchModelManager.getGesuchName();\n    };\n    GesuchRouteController.prototype.getActiveElement = function () {\n        return this.wizardStepManager.getCurrentStepName();\n    };\n    GesuchRouteController.prototype.getGesuchstellerTitle = function (gsnumber) {\n        var gs = this.ewkRS.getGesuchsteller(gsnumber).gesuchstellerJA;\n        if (gs) {\n            var title = gs.getFullName();\n            if (gs.ewkPersonId) {\n                return title + ' (' + gs.ewkPersonId + ')';\n            }\n            return title;\n        }\n        return undefined;\n    };\n    GesuchRouteController.prototype.showAbfrageForGesuchsteller = function (n) {\n        return this.ewkRS.ewkSearchAvailable(n);\n    };\n    GesuchRouteController.prototype.getGesuchsteller = function (n) {\n        switch (n) {\n            case 1:\n                if (this.gesuchModelManager.getGesuch() && this.gesuchModelManager.getGesuch().gesuchsteller1) {\n                    return this.gesuchModelManager.getGesuch().gesuchsteller1;\n                }\n                return undefined;\n            case 2:\n                if (this.gesuchModelManager.getGesuch() && this.gesuchModelManager.getGesuch().gesuchsteller2) {\n                    return this.gesuchModelManager.getGesuch().gesuchsteller2;\n                }\n                return undefined;\n            default:\n                return undefined;\n        }\n    };\n    GesuchRouteController.prototype.getEWKResultat = function (n) {\n        switch (n) {\n            case 1:\n                return this.gesuchModelManager.ewkResultatGS1;\n            case 2:\n                return this.gesuchModelManager.ewkResultatGS2;\n            default:\n                return undefined;\n        }\n    };\n    GesuchRouteController.prototype.getEWKPerson = function (n) {\n        switch (n) {\n            case 1:\n                return this.gesuchModelManager.ewkPersonGS1;\n            case 2:\n                return this.gesuchModelManager.ewkPersonGS2;\n            default:\n                return undefined;\n        }\n    };\n    GesuchRouteController.prototype.checkEWKPerson = function (person, n) {\n        switch (n) {\n            case 1:\n                return (person.personID === this.ewkRS.gesuchsteller1.gesuchstellerJA.ewkPersonId);\n            case 2:\n                return (person.personID === this.ewkRS.gesuchsteller2.gesuchstellerJA.ewkPersonId);\n            default:\n                return false;\n        }\n    };\n    GesuchRouteController.prototype.searchGesuchsteller = function (n) {\n        var _this = this;\n        this.errorService.clearAll();\n        this.ewkRS.suchePerson(n).then(function (response) {\n            switch (n) {\n                case 1:\n                    _this.gesuchModelManager.ewkResultatGS1 = response;\n                    if (_this.gesuchModelManager.ewkResultatGS1.anzahlResultate === 1) {\n                        _this.selectPerson(_this.gesuchModelManager.ewkResultatGS1.personen[0], n);\n                    }\n                    else {\n                        _this.setDateEWKAbfrage(n);\n                    }\n                    break;\n                case 2:\n                    _this.gesuchModelManager.ewkResultatGS2 = response;\n                    if (_this.gesuchModelManager.ewkResultatGS2.anzahlResultate === 1) {\n                        _this.selectPerson(_this.gesuchModelManager.ewkResultatGS2.personen[0], n);\n                    }\n                    else {\n                        _this.setDateEWKAbfrage(n);\n                    }\n                    break;\n                default:\n                    break;\n            }\n        }).catch(function (exception) {\n            var bussinesExceptionMitFehlercode = (_this.errorService.getErrors().filter(function filterForBusinessException(e) {\n                return (e.errorCodeEnum === 'ERROR_PERSONENSUCHE_BUSINESS' && e.argumentList[0]);\n            }).length) > 0;\n            if (bussinesExceptionMitFehlercode) {\n                // es war eine Businessexception und der Sercvice hat mit einem ErrorCode geantwortet\n                // Abfrage hat stattgefunden\n                _this.setDateEWKAbfrage(n);\n            }\n            _this.$log.error('there was an error searching the person in EWK ', exception);\n        });\n    };\n    GesuchRouteController.prototype.selectPerson = function (person, n) {\n        this.ewkRS.selectPerson(n, person.personID);\n        switch (n) {\n            case 1:\n                this.gesuchModelManager.ewkPersonGS1 = person;\n                this.$rootScope.$broadcast(TSGesuchEvent_1.TSGesuchEvent[TSGesuchEvent_1.TSGesuchEvent.EWK_PERSON_SELECTED], 1, person.personID);\n                break;\n            case 2:\n                this.gesuchModelManager.ewkPersonGS2 = person;\n                this.$rootScope.$broadcast(TSGesuchEvent_1.TSGesuchEvent[TSGesuchEvent_1.TSGesuchEvent.EWK_PERSON_SELECTED], 2, person.personID);\n                break;\n            default:\n                break;\n        }\n    };\n    GesuchRouteController.prototype.isGesuchGesperrt = function () {\n        if (this.gesuchModelManager.getGesuch()) {\n            return this.gesuchModelManager.getGesuch().gesperrtWegenBeschwerde === true;\n        }\n        return false;\n    };\n    GesuchRouteController.prototype.isSuperAdmin = function () {\n        return this.authServiceRS.isRole(TSRole_1.TSRole.SUPER_ADMIN);\n    };\n    GesuchRouteController.prototype.isDocumentUploaded = function () {\n        return this.getGesuch() && this.getGesuch().dokumenteHochgeladen;\n    };\n    GesuchRouteController.prototype.setDateEWKAbfrage = function (n) {\n        this.ewkRS.selectPerson(n, null);\n        switch (n) {\n            case 1:\n                this.$rootScope.$broadcast(TSGesuchEvent_1.TSGesuchEvent[TSGesuchEvent_1.TSGesuchEvent.EWK_PERSON_SELECTED], 1, null);\n                break;\n            case 2:\n                this.$rootScope.$broadcast(TSGesuchEvent_1.TSGesuchEvent[TSGesuchEvent_1.TSGesuchEvent.EWK_PERSON_SELECTED], 2, null);\n                break;\n            default:\n                break;\n        }\n    };\n    GesuchRouteController.$inject = ['GesuchModelManager', 'BerechnungsManager', 'WizardStepManager', 'EbeguUtil', 'ErrorService',\n        'AntragStatusHistoryRS', '$translate', 'AuthServiceRS', '$mdSidenav', 'CONSTANTS', 'GesuchstellerRS', 'EwkRS', '$log', '$rootScope'];\n    return GesuchRouteController;\n}());\nexports.GesuchRouteController = GesuchRouteController;\n",{"version":3,"file":"/home/imanol/projects/ebegu/ebegu-web/src/gesuch/gesuch.ts","sourceRoot":"","sources":["/home/imanol/projects/ebegu/ebegu-web/src/gesuch/gesuch.ts"],"names":[],"mappings":"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","sourcesContent":["/*\n * Ki-Tax: System for the management of external childcare subsidies\n * Copyright (C) 2017 City of Bern Switzerland\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport AuthServiceRS from '../authentication/service/AuthServiceRS.rest';\nimport ErrorService from '../core/errors/service/ErrorService';\nimport AntragStatusHistoryRS from '../core/service/antragStatusHistoryRS.rest';\nimport EwkRS from '../core/service/ewkRS.rest';\nimport {IN_BEARBEITUNG_BASE_NAME, TSAntragStatus} from '../models/enums/TSAntragStatus';\nimport {TSAntragTyp} from '../models/enums/TSAntragTyp';\nimport {TSGesuchBetreuungenStatus} from '../models/enums/TSGesuchBetreuungenStatus';\nimport {TSGesuchEvent} from '../models/enums/TSGesuchEvent';\nimport {TSRole} from '../models/enums/TSRole';\nimport {TSWizardStepName} from '../models/enums/TSWizardStepName';\nimport {TSWizardStepStatus} from '../models/enums/TSWizardStepStatus';\nimport TSEWKPerson from '../models/TSEWKPerson';\nimport GesuchstellerRS from '../core/service/gesuchstellerRS.rest';\nimport {ILogService, IRootScopeService} from 'angular';\nimport TSEWKResultat from '../models/TSEWKResultat';\nimport TSGesuch from '../models/TSGesuch';\nimport TSGesuchsteller from '../models/TSGesuchsteller';\nimport TSGesuchstellerContainer from '../models/TSGesuchstellerContainer';\nimport DateUtil from '../utils/DateUtil';\nimport EbeguUtil from '../utils/EbeguUtil';\nimport {TSRoleUtil} from '../utils/TSRoleUtil';\nimport BerechnungsManager from './service/berechnungsManager';\nimport GesuchModelManager from './service/gesuchModelManager';\nimport WizardStepManager from './service/wizardStepManager';\nimport ITranslateService = angular.translate.ITranslateService;\n\nexport class GesuchRouteController {\n\n    TSRole: any;\n    TSRoleUtil: any;\n    openEwkSidenav: boolean;\n\n    static $inject: string[] = ['GesuchModelManager', 'BerechnungsManager', 'WizardStepManager', 'EbeguUtil', 'ErrorService',\n        'AntragStatusHistoryRS', '$translate', 'AuthServiceRS', '$mdSidenav', 'CONSTANTS', 'GesuchstellerRS', 'EwkRS', '$log', '$rootScope'];\n\n    /* @ngInject */\n    constructor(private gesuchModelManager: GesuchModelManager, berechnungsManager: BerechnungsManager,\n                private wizardStepManager: WizardStepManager, private ebeguUtil: EbeguUtil,\n                private errorService: ErrorService,\n                private antragStatusHistoryRS: AntragStatusHistoryRS, private $translate: ITranslateService,\n                private authServiceRS: AuthServiceRS, private $mdSidenav: ng.material.ISidenavService, private CONSTANTS: any,\n                private gesuchstellerRS: GesuchstellerRS, private ewkRS: EwkRS,\n                private $log: ILogService, private $rootScope: IRootScopeService) {\n        //super(gesuchModelManager, berechnungsManager, wizardStepManager);\n        this.antragStatusHistoryRS.loadLastStatusChange(this.gesuchModelManager.getGesuch());\n        this.TSRole = TSRole;\n        this.TSRoleUtil = TSRoleUtil;\n    }\n\n    showFinanzielleSituationStart(): boolean {\n        return this.gesuchModelManager.showFinanzielleSituationStart();\n    }\n\n    public getDateFromGesuch(): string {\n        if (this.gesuchModelManager && this.gesuchModelManager.getGesuch()) {\n            return DateUtil.momentToLocalDateFormat(this.gesuchModelManager.getGesuch().eingangsdatum, 'DD.MM.YYYY');\n        }\n        return undefined;\n    }\n\n    public toggleSidenav(componentId: string) {\n        this.$mdSidenav(componentId).toggle();\n    }\n\n    public closeSidenav(componentId: string) {\n        this.$mdSidenav(componentId).close();\n    }\n\n    public getIcon(stepName: TSWizardStepName): string {\n        let step = this.wizardStepManager.getStepByName(stepName);\n        if (step) {\n            let status = step.wizardStepStatus;\n            if (status === TSWizardStepStatus.MUTIERT) {\n                return 'fa-circle green';\n            } else if (status === TSWizardStepStatus.OK) {\n                if (this.getGesuch().isMutation()) {\n                    if (step.wizardStepName === TSWizardStepName.VERFUEGEN) { // Verfuegung auch bei Mutation mit Hacken (falls verfuegt)\n                        return 'fa-check green';\n                    }\n                    return '';\n                } else {\n                    return 'fa-check green';\n                }\n            } else if (status === TSWizardStepStatus.NOK) {\n                return 'fa-close red';\n            } else if (status === TSWizardStepStatus.IN_BEARBEITUNG) {\n                if (step.wizardStepName === TSWizardStepName.DOKUMENTE || step.wizardStepName === TSWizardStepName.FREIGABE) { // Dokumenten haben kein Icon wenn nicht alle hochgeladen wurden\n                    return '';\n                }\n                return 'fa-pencil black';\n            } else if (status === TSWizardStepStatus.PLATZBESTAETIGUNG || status === TSWizardStepStatus.WARTEN) {\n                if (this.getGesuch().isMutation() && this.isWizardStepDisabled(step.wizardStepName)) { // in einer Mutation bekommt icon nur wenn es aktiviert ist\n                    return '';\n                } else {\n                    return 'fa-hourglass orange';\n                }\n            } else if (status === TSWizardStepStatus.UNBESUCHT) {\n                return '';\n            }\n        }\n        return '';\n    }\n\n    /**\n     * Steps are disabled when the field verfuegbar is false or if they are not allowed for the current role\n     * @param stepName\n     * @returns {boolean} Sollte etwas schief gehen, true wird zurueckgegeben\n     */\n    public isWizardStepDisabled(stepName: TSWizardStepName): boolean {\n        let step = this.wizardStepManager.getStepByName(stepName);\n        if (step) {\n            return !this.wizardStepManager.isStepClickableForCurrentRole(step, this.gesuchModelManager.getGesuch());\n        }\n        return true;\n    }\n\n    public isStepVisible(stepName: TSWizardStepName): boolean {\n        if (stepName) {\n            return this.wizardStepManager.isStepVisible(stepName);\n        }\n        return true;\n    }\n\n    public isElementActive(stepName: TSWizardStepName): boolean {\n        return this.wizardStepManager.getCurrentStepName() === stepName;\n    }\n\n    /**\n     * Uebersetzt den Status des Gesuchs und gibt ihn zurueck. Sollte das Gesuch noch keinen Status haben IN_BEARBEITUNG_JA\n     * wird zurueckgegeben\n     * @returns {string}\n     */\n    public getGesuchStatusTranslation(): string {\n        let toTranslate: TSAntragStatus = TSAntragStatus.IN_BEARBEITUNG_JA;\n        if (this.gesuchModelManager.getGesuch() && this.gesuchModelManager.getGesuch().status) {\n            toTranslate = this.gesuchModelManager.calculateNewStatus(this.gesuchModelManager.getGesuch().status);\n        }\n        let isUserGesuchsteller: boolean = this.authServiceRS.isOneOfRoles(TSRoleUtil.getGesuchstellerOnlyRoles());\n        let isUserAmt: boolean = this.authServiceRS.isOneOfRoles(TSRoleUtil.getJugendamtAndSchulamtRole());\n        let isUserSTV: boolean = this.authServiceRS.isOneOfRoles(TSRoleUtil.getSteueramtOnlyRoles());\n\n        if (toTranslate === TSAntragStatus.IN_BEARBEITUNG_GS && isUserGesuchsteller) {\n            if (TSGesuchBetreuungenStatus.ABGEWIESEN === this.gesuchModelManager.getGesuch().gesuchBetreuungenStatus) {\n                return this.ebeguUtil.translateString(TSAntragStatus[TSAntragStatus.PLATZBESTAETIGUNG_ABGEWIESEN]);\n            } else if (TSGesuchBetreuungenStatus.WARTEN === this.gesuchModelManager.getGesuch().gesuchBetreuungenStatus) {\n                return this.ebeguUtil.translateString(TSAntragStatus[TSAntragStatus.PLATZBESTAETIGUNG_WARTEN]);\n            }\n        }\n        if (toTranslate === TSAntragStatus.IN_BEARBEITUNG_JA && isUserAmt) {\n            return this.ebeguUtil.translateString(IN_BEARBEITUNG_BASE_NAME);\n        }\n        switch (toTranslate) {\n            case TSAntragStatus.GEPRUEFT_STV:\n            case TSAntragStatus.IN_BEARBEITUNG_STV:\n            case TSAntragStatus.PRUEFUNG_STV:\n                if (!isUserAmt && !isUserSTV) {\n                    return this.ebeguUtil.translateString('VERFUEGT');\n                }\n                break;\n            default:\n                break;\n\n        }\n\n        if ((toTranslate === TSAntragStatus.NUR_SCHULAMT)\n            && isUserGesuchsteller) {\n            return this.ebeguUtil.translateString('ABGESCHLOSSEN');\n        }\n\n        return this.ebeguUtil.translateString(TSAntragStatus[toTranslate]);\n    }\n\n    public getUserFullname(): string {\n        return this.antragStatusHistoryRS.getUserFullname();\n    }\n\n    public getGesuchId(): string {\n        if (this.getGesuch()) {\n            return this.getGesuch().id;\n        }\n        return undefined;\n    }\n\n    public getGesuch(): TSGesuch {\n        if (this.gesuchModelManager.getGesuch()) {\n            return this.gesuchModelManager.getGesuch();\n        }\n        return undefined;\n    }\n\n    public getGesuchErstellenStepTitle(): string {\n        if (this.gesuchModelManager.isGesuch()) {\n            if (this.getDateFromGesuch()) {\n                let key = (this.gesuchModelManager.getGesuch().typ === TSAntragTyp.ERNEUERUNGSGESUCH) ? 'MENU_ERNEUERUNGSGESUCH_VOM' : 'MENU_ERSTGESUCH_VOM';\n                return this.$translate.instant(key, {\n                    date: this.getDateFromGesuch()\n                });\n            } else {\n                let key = (this.gesuchModelManager.getGesuch().typ === TSAntragTyp.ERNEUERUNGSGESUCH) ? 'MENU_ERNEUERUNGSGESUCH' : 'MENU_ERSTGESUCH';\n                return this.$translate.instant(key);\n            }\n        } else {\n            if (this.getDateFromGesuch()) {\n                return this.$translate.instant('MENU_MUTATION_VOM', {\n                    date: this.getDateFromGesuch()\n                });\n            } else {\n                return this.$translate.instant('MENU_MUTATION');\n            }\n        }\n    }\n\n    public getGesuchName(): string {\n        return this.gesuchModelManager.getGesuchName();\n    }\n\n    public getActiveElement(): TSWizardStepName {\n        return this.wizardStepManager.getCurrentStepName();\n    }\n\n    public getGesuchstellerTitle(gsnumber: number): string {\n        let gs: TSGesuchsteller = this.ewkRS.getGesuchsteller(gsnumber).gesuchstellerJA;\n        if (gs) {\n            let title: string = gs.getFullName();\n            if (gs.ewkPersonId) {\n                return title + ' (' + gs.ewkPersonId + ')';\n            }\n            return title;\n        }\n        return undefined;\n    }\n\n    public showAbfrageForGesuchsteller(n: any): boolean {\n        return this.ewkRS.ewkSearchAvailable(n);\n    }\n\n    public getGesuchsteller(n: number): TSGesuchstellerContainer {\n        switch (n) {\n            case 1:\n                if (this.gesuchModelManager.getGesuch() && this.gesuchModelManager.getGesuch().gesuchsteller1) {\n                    return this.gesuchModelManager.getGesuch().gesuchsteller1;\n                }\n                return undefined;\n            case 2:\n                if (this.gesuchModelManager.getGesuch() && this.gesuchModelManager.getGesuch().gesuchsteller2) {\n                    return this.gesuchModelManager.getGesuch().gesuchsteller2;\n                }\n                return undefined;\n            default:\n                return undefined;\n        }\n    }\n\n    public getEWKResultat(n: number): TSEWKResultat {\n        switch (n) {\n            case 1:\n                return this.gesuchModelManager.ewkResultatGS1;\n            case 2:\n                return this.gesuchModelManager.ewkResultatGS2;\n            default:\n                return undefined;\n        }\n    }\n\n    public getEWKPerson(n: number): TSEWKPerson {\n        switch (n) {\n            case 1:\n                return this.gesuchModelManager.ewkPersonGS1;\n            case 2:\n                return this.gesuchModelManager.ewkPersonGS2;\n            default:\n                return undefined;\n        }\n    }\n\n    public checkEWKPerson(person: TSEWKPerson, n: number): boolean {\n        switch (n) {\n            case 1:\n                return (person.personID === this.ewkRS.gesuchsteller1.gesuchstellerJA.ewkPersonId);\n            case 2:\n                return (person.personID === this.ewkRS.gesuchsteller2.gesuchstellerJA.ewkPersonId);\n            default:\n                return false;\n        }\n    }\n\n    public searchGesuchsteller(n: number): void {\n        this.errorService.clearAll();\n        this.ewkRS.suchePerson(n).then(response => {\n            switch (n) {\n                case 1:\n                    this.gesuchModelManager.ewkResultatGS1 = response;\n                    if (this.gesuchModelManager.ewkResultatGS1.anzahlResultate === 1) {\n                        this.selectPerson(this.gesuchModelManager.ewkResultatGS1.personen[0], n);\n                    } else {\n                        this.setDateEWKAbfrage(n);\n                    }\n                    break;\n                case 2:\n                    this.gesuchModelManager.ewkResultatGS2 = response;\n                    if (this.gesuchModelManager.ewkResultatGS2.anzahlResultate === 1) {\n                        this.selectPerson(this.gesuchModelManager.ewkResultatGS2.personen[0], n);\n                    } else {\n                        this.setDateEWKAbfrage(n);\n                    }\n                    break;\n                default:\n                    break;\n            }\n        }).catch((exception) => {\n            let bussinesExceptionMitFehlercode = (this.errorService.getErrors().filter(\n                    function filterForBusinessException(e) {\n                        return (e.errorCodeEnum === 'ERROR_PERSONENSUCHE_BUSINESS' && e.argumentList[0]);\n                    }).length) > 0;\n\n            if (bussinesExceptionMitFehlercode) {\n                // es war eine Businessexception und der Sercvice hat mit einem ErrorCode geantwortet\n                // Abfrage hat stattgefunden\n                this.setDateEWKAbfrage(n);\n            }\n            this.$log.error('there was an error searching the person in EWK ', exception);\n        });\n    }\n\n    public selectPerson(person: TSEWKPerson, n: number): void {\n        this.ewkRS.selectPerson(n, person.personID);\n        switch (n) {\n            case 1:\n                this.gesuchModelManager.ewkPersonGS1 = person;\n                this.$rootScope.$broadcast(TSGesuchEvent[TSGesuchEvent.EWK_PERSON_SELECTED], 1, person.personID);\n                break;\n            case 2:\n                this.gesuchModelManager.ewkPersonGS2 = person;\n                this.$rootScope.$broadcast(TSGesuchEvent[TSGesuchEvent.EWK_PERSON_SELECTED], 2, person.personID);\n                break;\n            default:\n                break;\n        }\n    }\n\n    public isGesuchGesperrt(): boolean {\n        if (this.gesuchModelManager.getGesuch()) {\n            return this.gesuchModelManager.getGesuch().gesperrtWegenBeschwerde === true;\n        }\n        return false;\n    }\n\n    public isSuperAdmin(): boolean {\n        return this.authServiceRS.isRole(TSRole.SUPER_ADMIN);\n    }\n\n    public isDocumentUploaded(): boolean {\n        return this.getGesuch() && this.getGesuch().dokumenteHochgeladen;\n    }\n\n    private setDateEWKAbfrage(n: number) {\n        this.ewkRS.selectPerson(n, null);\n        switch (n) {\n            case 1:\n                this.$rootScope.$broadcast(TSGesuchEvent[TSGesuchEvent.EWK_PERSON_SELECTED], 1, null);\n                break;\n            case 2:\n                this.$rootScope.$broadcast(TSGesuchEvent[TSGesuchEvent.EWK_PERSON_SELECTED], 2, null);\n                break;\n            default:\n                break;\n        }\n\n    }\n}\n"]}]}