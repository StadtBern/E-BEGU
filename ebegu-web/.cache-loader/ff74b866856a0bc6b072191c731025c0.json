{"remainingRequest":"/home/imanol/projects/ebegu/ebegu-web/node_modules/thread-loader/dist/cjs.js??ref--0-1!/home/imanol/projects/ebegu/ebegu-web/node_modules/ts-loader/index.js??ref--0-2!/home/imanol/projects/ebegu/ebegu-web/src/statistik/component/statistikView/statistikView.ts","cacheIdentifier":"cache-loader:1.1.0 test","dependencies":[{"path":"/home/imanol/projects/ebegu/ebegu-web/src/statistik/component/statistikView/statistikView.ts","mtime":1518535855236},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/cache-loader/dist/cjs.js","mtime":1507514019000},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/thread-loader/dist/cjs.js","mtime":1507523420000},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/ts-loader/index.js","mtime":1508488471000}],"contextDependencies":[],"result":["/*\n * Ki-Tax: System for the management of external childcare subsidies\n * Copyright (C) 2017 City of Bern Switzerland\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n */\ndefine([\"require\", \"exports\", \"../../../models/TSStatistikParameter\", \"../../../models/enums/TSStatistikParameterType\", \"../../../models/enums/TSRole\", \"../../../utils/TSRoleUtil\", \"../../../utils/DateUtil\"], function (require, exports, TSStatistikParameter_1, TSStatistikParameterType_1, TSRole_1, TSRoleUtil_1, DateUtil_1) {\n    \"use strict\";\n    Object.defineProperty(exports, \"__esModule\", { value: true });\n    var template = require('./statistikView.html');\n    require('./statistikView.less');\n    var StatistikViewComponentConfig = /** @class */ (function () {\n        function StatistikViewComponentConfig() {\n            this.transclude = false;\n            this.template = template;\n            this.controller = StatistikViewController;\n            this.controllerAs = 'vm';\n        }\n        return StatistikViewComponentConfig;\n    }());\n    exports.StatistikViewComponentConfig = StatistikViewComponentConfig;\n    var StatistikViewController = /** @class */ (function () {\n        function StatistikViewController($state, gesuchsperiodeRS, $log, reportRS, downloadRS) {\n            this.$state = $state;\n            this.gesuchsperiodeRS = gesuchsperiodeRS;\n            this.$log = $log;\n            this.reportRS = reportRS;\n            this.downloadRS = downloadRS;\n            this.DATE_PARAM_FORMAT = 'YYYY-MM-DD';\n        }\n        StatistikViewController.prototype.$onInit = function () {\n            var _this = this;\n            this._statistikParameter = new TSStatistikParameter_1.default();\n            this.gesuchsperiodeRS.getAllGesuchsperioden().then(function (response) {\n                _this._gesuchsperioden = response;\n                if (_this._gesuchsperioden.length > 0) {\n                    _this.maxDate = _this._gesuchsperioden[0].gueltigkeit.gueltigBis;\n                    _this.minDate = DateUtil_1.default.localDateToMoment('2017-01-01');\n                }\n            });\n            this.TSRole = TSRole_1.TSRole;\n            this.TSRoleUtil = TSRoleUtil_1.TSRoleUtil;\n        };\n        StatistikViewController.prototype.generateStatistik = function (form, type) {\n            var _this = this;\n            if (form.$valid) {\n                var tmpType = TSStatistikParameterType_1.TSStatistikParameterType[type];\n                tmpType ? this.$log.debug('Statistik Type: ' + tmpType) : this.$log.debug('default, Type not recognized');\n                this.$log.debug('Validated Form: ' + form.$name);\n                switch (tmpType) {\n                    case TSStatistikParameterType_1.TSStatistikParameterType.GESUCH_STICHTAG: {\n                        var win_1 = this.downloadRS.prepareDownloadWindow();\n                        this.reportRS.getGesuchStichtagReportExcel(this._statistikParameter.stichtag.format(this.DATE_PARAM_FORMAT), this._statistikParameter.gesuchsperiode ? this._statistikParameter.gesuchsperiode.toString() : null)\n                            .then(function (downloadFile) {\n                            _this.$log.debug('accessToken: ' + downloadFile.accessToken);\n                            _this.downloadRS.startDownload(downloadFile.accessToken, downloadFile.filename, false, win_1);\n                        })\n                            .catch(function (ex) {\n                            win_1.close();\n                            _this.$log.error('An error occurred downloading the document, closing download window.');\n                        });\n                        break;\n                    }\n                    case TSStatistikParameterType_1.TSStatistikParameterType.GESUCH_ZEITRAUM: {\n                        var win_2 = this.downloadRS.prepareDownloadWindow();\n                        this.reportRS.getGesuchZeitraumReportExcel(this._statistikParameter.von.format(this.DATE_PARAM_FORMAT), this._statistikParameter.bis.format(this.DATE_PARAM_FORMAT), this._statistikParameter.gesuchsperiode ? this._statistikParameter.gesuchsperiode.toString() : null)\n                            .then(function (downloadFile) {\n                            _this.$log.debug('accessToken: ' + downloadFile.accessToken);\n                            _this.downloadRS.startDownload(downloadFile.accessToken, downloadFile.filename, false, win_2);\n                        })\n                            .catch(function (ex) {\n                            win_2.close();\n                            _this.$log.error('An error occurred downloading the document, closing download window.');\n                        });\n                        break;\n                    }\n                    case TSStatistikParameterType_1.TSStatistikParameterType.KINDER: {\n                        var win_3 = this.downloadRS.prepareDownloadWindow();\n                        this.reportRS.getKinderReportExcel(this._statistikParameter.von.format(this.DATE_PARAM_FORMAT), this._statistikParameter.bis.format(this.DATE_PARAM_FORMAT), this._statistikParameter.gesuchsperiode ? this._statistikParameter.gesuchsperiode.toString() : null)\n                            .then(function (downloadFile) {\n                            _this.$log.debug('accessToken: ' + downloadFile.accessToken);\n                            _this.downloadRS.startDownload(downloadFile.accessToken, downloadFile.filename, false, win_3);\n                        })\n                            .catch(function (ex) {\n                            win_3.close();\n                            _this.$log.error('An error occurred downloading the document, closing download window.');\n                        });\n                        break;\n                    }\n                    case TSStatistikParameterType_1.TSStatistikParameterType.GESUCHSTELLER: {\n                        var win_4 = this.downloadRS.prepareDownloadWindow();\n                        this.reportRS.getGesuchstellerReportExcel(this._statistikParameter.stichtag.format(this.DATE_PARAM_FORMAT))\n                            .then(function (downloadFile) {\n                            _this.$log.debug('accessToken: ' + downloadFile.accessToken);\n                            _this.downloadRS.startDownload(downloadFile.accessToken, downloadFile.filename, false, win_4);\n                        })\n                            .catch(function (ex) {\n                            win_4.close();\n                            _this.$log.error('An error occurred downloading the document, closing download window.');\n                        });\n                        break;\n                    }\n                    case TSStatistikParameterType_1.TSStatistikParameterType.KANTON: {\n                        var win_5 = this.downloadRS.prepareDownloadWindow();\n                        this.reportRS.getKantonReportExcel(this._statistikParameter.von.format(this.DATE_PARAM_FORMAT), this._statistikParameter.bis.format(this.DATE_PARAM_FORMAT))\n                            .then(function (downloadFile) {\n                            _this.$log.debug('accessToken: ' + downloadFile.accessToken);\n                            _this.downloadRS.startDownload(downloadFile.accessToken, downloadFile.filename, false, win_5);\n                        })\n                            .catch(function (ex) {\n                            win_5.close();\n                            _this.$log.error('An error occurred downloading the document, closing download window.');\n                        });\n                        break;\n                    }\n                    case TSStatistikParameterType_1.TSStatistikParameterType.MITARBEITERINNEN: {\n                        var win_6 = this.downloadRS.prepareDownloadWindow();\n                        this.reportRS.getMitarbeiterinnenReportExcel(this._statistikParameter.von.format(this.DATE_PARAM_FORMAT), this._statistikParameter.bis.format(this.DATE_PARAM_FORMAT))\n                            .then(function (downloadFile) {\n                            _this.$log.debug('accessToken: ' + downloadFile.accessToken);\n                            _this.downloadRS.startDownload(downloadFile.accessToken, downloadFile.filename, false, win_6);\n                        })\n                            .catch(function (ex) {\n                            win_6.close();\n                            _this.$log.error('An error occurred downloading the document, closing download window.');\n                        });\n                        break;\n                    }\n                    case TSStatistikParameterType_1.TSStatistikParameterType.GESUCHSTELLER_KINDER_BETREUUNG: {\n                        var win_7 = this.downloadRS.prepareDownloadWindow();\n                        this.reportRS.getGesuchstellerKinderBetreuungReportExcel(this._statistikParameter.von.format(this.DATE_PARAM_FORMAT), this._statistikParameter.bis.format(this.DATE_PARAM_FORMAT), this._statistikParameter.gesuchsperiode ? this._statistikParameter.gesuchsperiode.toString() : null)\n                            .then(function (downloadFile) {\n                            _this.$log.debug('accessToken: ' + downloadFile.accessToken);\n                            _this.downloadRS.startDownload(downloadFile.accessToken, downloadFile.filename, false, win_7);\n                        })\n                            .catch(function (ex) {\n                            win_7.close();\n                            _this.$log.error('An error occurred downloading the document, closing download window.');\n                        });\n                        break;\n                    }\n                    case TSStatistikParameterType_1.TSStatistikParameterType.ZAHLUNGEN_PERIODE:\n                        if (this._statistikParameter.gesuchsperiode) {\n                            var win_8 = this.downloadRS.prepareDownloadWindow();\n                            this.reportRS.getZahlungPeriodeReportExcel(this._statistikParameter.gesuchsperiode)\n                                .then(function (downloadFile) {\n                                _this.$log.debug('accessToken: ' + downloadFile.accessToken);\n                                _this.downloadRS.startDownload(downloadFile.accessToken, downloadFile.filename, false, win_8);\n                            })\n                                .catch(function (ex) {\n                                win_8.close();\n                                _this.$log.error('An error occurred downloading the document, closing download window.');\n                            });\n                        }\n                        else {\n                            this.$log.warn('gesuchsperiode muss gewählt sein');\n                        }\n                        break;\n                    default:\n                        this.$log.debug('default, Type not recognized');\n                        break;\n                }\n            }\n        };\n        Object.defineProperty(StatistikViewController.prototype, \"statistikParameter\", {\n            get: function () {\n                return this._statistikParameter;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(StatistikViewController.prototype, \"gesuchsperioden\", {\n            get: function () {\n                return this._gesuchsperioden;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        StatistikViewController.$inject = ['$state', 'GesuchsperiodeRS', '$log', 'ReportRS', 'DownloadRS'];\n        return StatistikViewController;\n    }());\n    exports.StatistikViewController = StatistikViewController;\n});\n",{"version":3,"file":"/home/imanol/projects/ebegu/ebegu-web/src/statistik/component/statistikView/statistikView.ts","sourceRoot":"","sources":["/home/imanol/projects/ebegu/ebegu-web/src/statistik/component/statistikView/statistikView.ts"],"names":[],"mappings":"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","sourcesContent":["/*\n * Ki-Tax: System for the management of external childcare subsidies\n * Copyright (C) 2017 City of Bern Switzerland\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport {IComponentOptions} from 'angular';\nimport {IStateService} from 'angular-ui-router';\nimport TSStatistikParameter from '../../../models/TSStatistikParameter';\nimport {TSStatistikParameterType} from '../../../models/enums/TSStatistikParameterType';\nimport TSGesuchsperiode from '../../../models/TSGesuchsperiode';\nimport GesuchsperiodeRS from '../../../core/service/gesuchsperiodeRS.rest';\nimport {TSRole} from '../../../models/enums/TSRole';\nimport {TSRoleUtil} from '../../../utils/TSRoleUtil';\nimport {ReportRS} from '../../../core/service/reportRS.rest';\nimport TSDownloadFile from '../../../models/TSDownloadFile';\nimport {DownloadRS} from '../../../core/service/downloadRS.rest';\nimport * as moment from 'moment';\nimport DateUtil from '../../../utils/DateUtil';\nimport IFormController = angular.IFormController;\nimport ILogService = angular.ILogService;\nimport Moment = moment.Moment;\n\nlet template = require('./statistikView.html');\nrequire('./statistikView.less');\n\nexport class StatistikViewComponentConfig implements IComponentOptions {\n    transclude = false;\n    template = template;\n    controller = StatistikViewController;\n    controllerAs = 'vm';\n}\n\nexport class StatistikViewController {\n    private _statistikParameter: TSStatistikParameter;\n    private _gesuchsperioden: Array<TSGesuchsperiode>;\n    TSRole: any;\n    TSRoleUtil: any;\n    private DATE_PARAM_FORMAT: string = 'YYYY-MM-DD';\n    // Statistiken sind nur moeglich ab Beginn der fruehesten Periode bis Ende der letzten Periode\n    private maxDate: Moment;\n    private minDate: Moment;\n\n    static $inject: string[] = ['$state', 'GesuchsperiodeRS', '$log', 'ReportRS', 'DownloadRS'];\n\n    constructor(private $state: IStateService, private gesuchsperiodeRS: GesuchsperiodeRS, private $log: ILogService, private reportRS: ReportRS, private downloadRS: DownloadRS) {\n    }\n\n    $onInit() {\n        this._statistikParameter = new TSStatistikParameter();\n        this.gesuchsperiodeRS.getAllGesuchsperioden().then((response: any) => {\n            this._gesuchsperioden = response;\n            if (this._gesuchsperioden.length > 0) {\n                this.maxDate = this._gesuchsperioden[0].gueltigkeit.gueltigBis;\n                this.minDate = DateUtil.localDateToMoment('2017-01-01');\n            }\n        });\n        this.TSRole = TSRole;\n        this.TSRoleUtil = TSRoleUtil;\n    }\n\n    public generateStatistik(form: IFormController, type?: TSStatistikParameterType): void {\n        if (form.$valid) {\n            let tmpType = (<any>TSStatistikParameterType)[type];\n            tmpType ? this.$log.debug('Statistik Type: ' + tmpType) : this.$log.debug('default, Type not recognized');\n            this.$log.debug('Validated Form: ' + form.$name);\n\n            switch (tmpType) {\n                case TSStatistikParameterType.GESUCH_STICHTAG: {\n                    let win: Window = this.downloadRS.prepareDownloadWindow();\n                    this.reportRS.getGesuchStichtagReportExcel(this._statistikParameter.stichtag.format(this.DATE_PARAM_FORMAT),\n                        this._statistikParameter.gesuchsperiode ? this._statistikParameter.gesuchsperiode.toString() : null)\n                        .then((downloadFile: TSDownloadFile) => {\n                            this.$log.debug('accessToken: ' + downloadFile.accessToken);\n                            this.downloadRS.startDownload(downloadFile.accessToken, downloadFile.filename, false, win);\n                        })\n                        .catch((ex) => {\n                            win.close();\n                            this.$log.error('An error occurred downloading the document, closing download window.');\n                        });\n                    break;\n                }\n                case TSStatistikParameterType.GESUCH_ZEITRAUM: {\n                    let win: Window = this.downloadRS.prepareDownloadWindow();\n                    this.reportRS.getGesuchZeitraumReportExcel(this._statistikParameter.von.format(this.DATE_PARAM_FORMAT),\n                        this._statistikParameter.bis.format(this.DATE_PARAM_FORMAT),\n                        this._statistikParameter.gesuchsperiode ? this._statistikParameter.gesuchsperiode.toString() : null)\n                        .then((downloadFile: TSDownloadFile) => {\n                            this.$log.debug('accessToken: ' + downloadFile.accessToken);\n                            this.downloadRS.startDownload(downloadFile.accessToken, downloadFile.filename, false, win);\n                        })\n                        .catch((ex) => {\n                            win.close();\n                            this.$log.error('An error occurred downloading the document, closing download window.');\n                        });\n                    break;\n                }\n                case TSStatistikParameterType.KINDER: {\n                    let win: Window = this.downloadRS.prepareDownloadWindow();\n                    this.reportRS.getKinderReportExcel(\n                        this._statistikParameter.von.format(this.DATE_PARAM_FORMAT),\n                        this._statistikParameter.bis.format(this.DATE_PARAM_FORMAT),\n                        this._statistikParameter.gesuchsperiode ? this._statistikParameter.gesuchsperiode.toString() : null)\n                        .then((downloadFile: TSDownloadFile) => {\n                            this.$log.debug('accessToken: ' + downloadFile.accessToken);\n                            this.downloadRS.startDownload(downloadFile.accessToken, downloadFile.filename, false, win);\n                        })\n                        .catch((ex) => {\n                            win.close();\n                            this.$log.error('An error occurred downloading the document, closing download window.');\n                        });\n                    break;\n                }\n                case TSStatistikParameterType.GESUCHSTELLER: {\n                    let win: Window = this.downloadRS.prepareDownloadWindow();\n                    this.reportRS.getGesuchstellerReportExcel(this._statistikParameter.stichtag.format(this.DATE_PARAM_FORMAT))\n                        .then((downloadFile: TSDownloadFile) => {\n                            this.$log.debug('accessToken: ' + downloadFile.accessToken);\n                            this.downloadRS.startDownload(downloadFile.accessToken, downloadFile.filename, false, win);\n                        })\n                        .catch((ex) => {\n                            win.close();\n                            this.$log.error('An error occurred downloading the document, closing download window.');\n                        });\n                    break;\n                }\n                case TSStatistikParameterType.KANTON: {\n                    let win: Window = this.downloadRS.prepareDownloadWindow();\n                    this.reportRS.getKantonReportExcel(this._statistikParameter.von.format(this.DATE_PARAM_FORMAT),\n                        this._statistikParameter.bis.format(this.DATE_PARAM_FORMAT))\n                        .then((downloadFile: TSDownloadFile) => {\n                            this.$log.debug('accessToken: ' + downloadFile.accessToken);\n                            this.downloadRS.startDownload(downloadFile.accessToken, downloadFile.filename, false, win);\n                        })\n                        .catch((ex) => {\n                            win.close();\n                            this.$log.error('An error occurred downloading the document, closing download window.');\n                        });\n                    break;\n                }\n                case TSStatistikParameterType.MITARBEITERINNEN: {\n                    let win: Window = this.downloadRS.prepareDownloadWindow();\n                    this.reportRS.getMitarbeiterinnenReportExcel(this._statistikParameter.von.format(this.DATE_PARAM_FORMAT),\n                        this._statistikParameter.bis.format(this.DATE_PARAM_FORMAT))\n                        .then((downloadFile: TSDownloadFile) => {\n                            this.$log.debug('accessToken: ' + downloadFile.accessToken);\n                            this.downloadRS.startDownload(downloadFile.accessToken, downloadFile.filename, false, win);\n                        })\n                        .catch((ex) => {\n                            win.close();\n                            this.$log.error('An error occurred downloading the document, closing download window.');\n                        });\n                    break;\n                }\n                case TSStatistikParameterType.GESUCHSTELLER_KINDER_BETREUUNG: {\n                    let win: Window = this.downloadRS.prepareDownloadWindow();\n                    this.reportRS.getGesuchstellerKinderBetreuungReportExcel(\n                        this._statistikParameter.von.format(this.DATE_PARAM_FORMAT),\n                        this._statistikParameter.bis.format(this.DATE_PARAM_FORMAT),\n                        this._statistikParameter.gesuchsperiode ? this._statistikParameter.gesuchsperiode.toString() : null)\n                        .then((downloadFile: TSDownloadFile) => {\n                            this.$log.debug('accessToken: ' + downloadFile.accessToken);\n                            this.downloadRS.startDownload(downloadFile.accessToken, downloadFile.filename, false, win);\n                        })\n                        .catch((ex) => {\n                            win.close();\n                            this.$log.error('An error occurred downloading the document, closing download window.');\n                        });\n                    break;\n                }\n                case TSStatistikParameterType.ZAHLUNGEN_PERIODE:\n                    if (this._statistikParameter.gesuchsperiode) {\n                        let win: Window = this.downloadRS.prepareDownloadWindow();\n                        this.reportRS.getZahlungPeriodeReportExcel(\n                            this._statistikParameter.gesuchsperiode)\n                            .then((downloadFile: TSDownloadFile) => {\n                                this.$log.debug('accessToken: ' + downloadFile.accessToken);\n                                this.downloadRS.startDownload(downloadFile.accessToken, downloadFile.filename, false, win);\n                            })\n                            .catch((ex) => {\n                                win.close();\n                                this.$log.error('An error occurred downloading the document, closing download window.');\n                            });\n                    } else {\n                        this.$log.warn('gesuchsperiode muss gewählt sein');\n                    }\n                    break;\n                default:\n                    this.$log.debug('default, Type not recognized');\n                    break;\n            }\n        }\n    }\n\n    get statistikParameter(): TSStatistikParameter {\n        return this._statistikParameter;\n    }\n\n    get gesuchsperioden(): Array<TSGesuchsperiode> {\n        return this._gesuchsperioden;\n    }\n}\n"]}]}