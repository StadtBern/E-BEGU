{"remainingRequest":"/home/imanol/projects/ebegu/ebegu-web/node_modules/thread-loader/dist/cjs.js??ref--0-1!/home/imanol/projects/ebegu/ebegu-web/node_modules/ts-loader/index.js??ref--0-2!/home/imanol/projects/ebegu/ebegu-web/src/pendenzenBetreuungen/component/pendenzenBetreuungenListView/pendenzenBetreuungenListView.ts","cacheIdentifier":"cache-loader:1.1.0 test","dependencies":[{"path":"/home/imanol/projects/ebegu/ebegu-web/src/pendenzenBetreuungen/component/pendenzenBetreuungenListView/pendenzenBetreuungenListView.ts","mtime":1518612532818},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/cache-loader/dist/cjs.js","mtime":1507514019000},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/thread-loader/dist/cjs.js","mtime":1507523420000},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/ts-loader/index.js","mtime":1508488471000}],"contextDependencies":[],"result":["\"use strict\";\n/*\n * Ki-Tax: System for the management of external childcare subsidies\n * Copyright (C) 2017 City of Bern Switzerland\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar template = require('./pendenzenBetreuungenListView.html');\nrequire('./pendenzenBetreuungenListView.less');\nvar PendenzenBetreuungenListViewComponentConfig = /** @class */ (function () {\n    function PendenzenBetreuungenListViewComponentConfig() {\n        this.transclude = false;\n        this.template = template;\n        this.controller = PendenzenBetreuungenListViewController;\n        this.controllerAs = 'vm';\n    }\n    return PendenzenBetreuungenListViewComponentConfig;\n}());\nexports.PendenzenBetreuungenListViewComponentConfig = PendenzenBetreuungenListViewComponentConfig;\nvar PendenzenBetreuungenListViewController = /** @class */ (function () {\n    function PendenzenBetreuungenListViewController(pendenzBetreuungenRS, ebeguUtil, institutionRS, institutionStammdatenRS, gesuchsperiodeRS, gesuchModelManager, berechnungsManager, $state) {\n        this.pendenzBetreuungenRS = pendenzBetreuungenRS;\n        this.ebeguUtil = ebeguUtil;\n        this.institutionRS = institutionRS;\n        this.institutionStammdatenRS = institutionStammdatenRS;\n        this.gesuchsperiodeRS = gesuchsperiodeRS;\n        this.gesuchModelManager = gesuchModelManager;\n        this.berechnungsManager = berechnungsManager;\n        this.$state = $state;\n        this.activeGesuchsperiodenList = [];\n        this.itemsByPage = 20;\n        this.numberOfPages = 1;\n    }\n    PendenzenBetreuungenListViewController.prototype.$onInit = function () {\n        this.updatePendenzenList();\n        this.updateInstitutionenList();\n        this.updateBetreuungsangebotTypList();\n        this.updateActiveGesuchsperiodenList();\n    };\n    PendenzenBetreuungenListViewController.prototype.getTotalResultCount = function () {\n        if (this.pendenzenList && this.pendenzenList.length) {\n            return this.pendenzenList.length;\n        }\n        return 0;\n    };\n    PendenzenBetreuungenListViewController.prototype.updatePendenzenList = function () {\n        var _this = this;\n        this.pendenzBetreuungenRS.getPendenzenBetreuungenList().then(function (response) {\n            _this.pendenzenList = angular.copy(response);\n            _this.numberOfPages = _this.pendenzenList.length / _this.itemsByPage;\n        });\n    };\n    PendenzenBetreuungenListViewController.prototype.updateActiveGesuchsperiodenList = function () {\n        var _this = this;\n        this.gesuchsperiodeRS.getAllNichtAbgeschlosseneGesuchsperioden().then(function (response) {\n            _this.extractGesuchsperiodeStringList(response);\n        });\n    };\n    PendenzenBetreuungenListViewController.prototype.extractGesuchsperiodeStringList = function (allActiveGesuchsperioden) {\n        var _this = this;\n        allActiveGesuchsperioden.forEach(function (gesuchsperiode) {\n            _this.activeGesuchsperiodenList.push(gesuchsperiode.gesuchsperiodeString);\n        });\n    };\n    PendenzenBetreuungenListViewController.prototype.updateInstitutionenList = function () {\n        var _this = this;\n        this.institutionRS.getInstitutionenForCurrentBenutzer().then(function (response) {\n            _this.institutionenList = angular.copy(response);\n        });\n    };\n    PendenzenBetreuungenListViewController.prototype.updateBetreuungsangebotTypList = function () {\n        var _this = this;\n        this.institutionStammdatenRS.getBetreuungsangeboteForInstitutionenOfCurrentBenutzer().then(function (response) {\n            _this.betreuungsangebotTypList = angular.copy(response);\n        });\n    };\n    PendenzenBetreuungenListViewController.prototype.getPendenzenList = function () {\n        return this.pendenzenList;\n    };\n    PendenzenBetreuungenListViewController.prototype.editPendenzBetreuungen = function (pendenz, event) {\n        if (pendenz) {\n            var isCtrlKeyPressed = (event && event.ctrlKey);\n            this.openBetreuung(pendenz, isCtrlKeyPressed);\n        }\n    };\n    PendenzenBetreuungenListViewController.prototype.openBetreuung = function (pendenz, isCtrlKeyPressed) {\n        var numberParts = this.ebeguUtil.splitBetreuungsnummer(pendenz.betreuungsNummer);\n        if (numberParts && pendenz) {\n            var kindNumber = parseInt(numberParts.kindnummer);\n            var betreuungNumber = parseInt(numberParts.betreuungsnummer);\n            if (betreuungNumber > 0) {\n                this.berechnungsManager.clear(); // nur um sicher zu gehen, dass alle alte Werte geloescht sind\n                // Reload Gesuch in gesuchModelManager on Init in fallCreationView because it has been changed since last time\n                this.gesuchModelManager.clearGesuch();\n                var navObj = {\n                    betreuungNumber: betreuungNumber,\n                    kindNumber: kindNumber,\n                    gesuchId: pendenz.gesuchId\n                };\n                if (isCtrlKeyPressed) {\n                    var url = this.$state.href('gesuch.betreuung', navObj);\n                    window.open(url, '_blank');\n                }\n                else {\n                    this.$state.go('gesuch.betreuung', navObj);\n                }\n            }\n        }\n    };\n    PendenzenBetreuungenListViewController.$inject = ['PendenzBetreuungenRS', 'EbeguUtil', 'InstitutionRS', 'InstitutionStammdatenRS', 'GesuchsperiodeRS',\n        'GesuchModelManager', 'BerechnungsManager', '$state'];\n    return PendenzenBetreuungenListViewController;\n}());\nexports.PendenzenBetreuungenListViewController = PendenzenBetreuungenListViewController;\n",{"version":3,"file":"/home/imanol/projects/ebegu/ebegu-web/src/pendenzenBetreuungen/component/pendenzenBetreuungenListView/pendenzenBetreuungenListView.ts","sourceRoot":"","sources":["/home/imanol/projects/ebegu/ebegu-web/src/pendenzenBetreuungen/component/pendenzenBetreuungenListView/pendenzenBetreuungenListView.ts"],"names":[],"mappings":"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","sourcesContent":["/*\n * Ki-Tax: System for the management of external childcare subsidies\n * Copyright (C) 2017 City of Bern Switzerland\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport {IComponentOptions} from 'angular';\nimport TSGesuchsperiode from '../../../models/TSGesuchsperiode';\nimport EbeguUtil from '../../../utils/EbeguUtil';\nimport {TSBetreuungsangebotTyp} from '../../../models/enums/TSBetreuungsangebotTyp';\nimport TSInstitution from '../../../models/TSInstitution';\nimport {InstitutionRS} from '../../../core/service/institutionRS.rest';\nimport GesuchsperiodeRS from '../../../core/service/gesuchsperiodeRS.rest';\nimport GesuchModelManager from '../../../gesuch/service/gesuchModelManager';\nimport {IStateService} from 'angular-ui-router';\nimport BerechnungsManager from '../../../gesuch/service/berechnungsManager';\nimport PendenzBetreuungenRS from '../../service/PendenzBetreuungenRS.rest';\nimport {InstitutionStammdatenRS} from '../../../core/service/institutionStammdatenRS.rest';\nimport TSBetreuungsnummerParts from '../../../models/dto/TSBetreuungsnummerParts';\nimport TSPendenzBetreuung from '../../../models/TSPendenzBetreuung';\nlet template = require('./pendenzenBetreuungenListView.html');\nrequire('./pendenzenBetreuungenListView.less');\n\nexport class PendenzenBetreuungenListViewComponentConfig implements IComponentOptions {\n    transclude = false;\n    template = template;\n    controller = PendenzenBetreuungenListViewController;\n    controllerAs = 'vm';\n}\n\nexport class PendenzenBetreuungenListViewController {\n\n    private pendenzenList: Array<TSPendenzBetreuung>;\n    selectedBetreuungsangebotTyp: string;\n    selectedInstitution: string;\n    selectedGesuchsperiode: string;\n    institutionenList: Array<TSInstitution>;\n    betreuungsangebotTypList: Array<TSBetreuungsangebotTyp>;\n    activeGesuchsperiodenList: Array<string> = [];\n    itemsByPage: number = 20;\n    numberOfPages: number = 1;\n\n\n    static $inject: string[] = ['PendenzBetreuungenRS', 'EbeguUtil', 'InstitutionRS', 'InstitutionStammdatenRS', 'GesuchsperiodeRS',\n        'GesuchModelManager', 'BerechnungsManager', '$state'];\n\n    constructor(public pendenzBetreuungenRS: PendenzBetreuungenRS, private ebeguUtil: EbeguUtil, private institutionRS: InstitutionRS,\n                private institutionStammdatenRS: InstitutionStammdatenRS, private gesuchsperiodeRS: GesuchsperiodeRS,\n                private gesuchModelManager: GesuchModelManager, private berechnungsManager: BerechnungsManager,\n                private $state: IStateService) {\n    }\n\n    $onInit() {\n        this.updatePendenzenList();\n        this.updateInstitutionenList();\n        this.updateBetreuungsangebotTypList();\n        this.updateActiveGesuchsperiodenList();\n    }\n\n    private getTotalResultCount(): number {\n        if (this.pendenzenList && this.pendenzenList.length) {\n            return this.pendenzenList.length;\n        }\n        return 0;\n    }\n\n    private updatePendenzenList() {\n        this.pendenzBetreuungenRS.getPendenzenBetreuungenList().then((response: any) => {\n            this.pendenzenList = angular.copy(response);\n            this.numberOfPages = this.pendenzenList.length / this.itemsByPage;\n        });\n    }\n\n    public updateActiveGesuchsperiodenList(): void {\n        this.gesuchsperiodeRS.getAllNichtAbgeschlosseneGesuchsperioden().then((response: TSGesuchsperiode[]) => {\n            this.extractGesuchsperiodeStringList(response);\n        });\n    }\n\n    private extractGesuchsperiodeStringList(allActiveGesuchsperioden: TSGesuchsperiode[]) {\n        allActiveGesuchsperioden.forEach((gesuchsperiode: TSGesuchsperiode) => {\n            this.activeGesuchsperiodenList.push(gesuchsperiode.gesuchsperiodeString);\n        });\n    }\n\n    public updateInstitutionenList(): void {\n        this.institutionRS.getInstitutionenForCurrentBenutzer().then((response: any) => {\n            this.institutionenList = angular.copy(response);\n        });\n    }\n\n    public updateBetreuungsangebotTypList(): void {\n        this.institutionStammdatenRS.getBetreuungsangeboteForInstitutionenOfCurrentBenutzer().then((response: any) => {\n            this.betreuungsangebotTypList = angular.copy(response);\n        });\n    }\n\n    public getPendenzenList(): Array<TSPendenzBetreuung> {\n        return this.pendenzenList;\n    }\n\n    public editPendenzBetreuungen(pendenz: TSPendenzBetreuung, event: any): void {\n        if (pendenz) {\n            let isCtrlKeyPressed: boolean = (event && event.ctrlKey);\n            this.openBetreuung(pendenz, isCtrlKeyPressed);\n        }\n    }\n\n    private openBetreuung(pendenz: TSPendenzBetreuung, isCtrlKeyPressed: boolean): void {\n        let numberParts: TSBetreuungsnummerParts = this.ebeguUtil.splitBetreuungsnummer(pendenz.betreuungsNummer);\n        if (numberParts && pendenz) {\n            let kindNumber: number = parseInt(numberParts.kindnummer);\n            let betreuungNumber: number = parseInt(numberParts.betreuungsnummer);\n            if (betreuungNumber > 0) {\n                this.berechnungsManager.clear(); // nur um sicher zu gehen, dass alle alte Werte geloescht sind\n\n                // Reload Gesuch in gesuchModelManager on Init in fallCreationView because it has been changed since last time\n                this.gesuchModelManager.clearGesuch();\n                let navObj: any = {\n                    betreuungNumber: betreuungNumber,\n                    kindNumber: kindNumber,\n                    gesuchId: pendenz.gesuchId\n                };\n                if (isCtrlKeyPressed) {\n                    let url = this.$state.href('gesuch.betreuung', navObj);\n                    window.open(url, '_blank');\n                } else {\n                    this.$state.go('gesuch.betreuung', navObj);\n                }\n            }\n        }\n    }\n}\n"]}]}