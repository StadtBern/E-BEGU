map $http_user_agent $log_ua {

  ~DockerHealthCheck 0;

  default 1;
}

upstream apiserver {
  server EBEGU-WILDFLY:8080;
}
server {
  listen 80;
  server_name  ebegu.dvbern.ch localhost "";
  client_max_body_size 11m;
  client_body_timeout 300s;

  add_header X-Frame-Options DENY;
  #This policy allows images, scripts, AJAX, and CSS from the same origin, and does not allow any other resources to
  #load (eg object, frame, media, etc).
  add_header Content-Security-Policy  "default-src 'none'; object-src 'self'; script-src 'self' ajax.googleapis.com; connect-src 'self'; img-src 'self'; style-src 'self' 'unsafe-inline'  https://fonts.googleapis.com; font-src 'self'  https://fonts.googleapis.com https://fonts.gstatic.com;";


  location /ebegu {
    proxy_pass http://apiserver;


      proxy_connect_timeout   5s;
    proxy_send_timeout      300s;
    proxy_read_timeout      300s;

  }

  location /connector {
    proxy_pass http://apiserver;

      proxy_connect_timeout   5s;
    proxy_send_timeout      300s;
    proxy_read_timeout      300s;

  }

  location /web {
    alias   /usr/share/nginx/html/web;
    index  index.html missingapp.html;
  }

  access_log /var/log/nginx/access.log main if=$log_ua;
}


